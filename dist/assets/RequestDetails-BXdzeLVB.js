import{r as o,j as e,B as w,R as U,C as c,F as ce,m as me,y as V,u as oe,a as ue,n as he}from"./index-6YeC_AS5.js";import{a as Q,p as xe,d as _e}from"./serviceRequest-CJ15hpJs.js";import{M as S}from"./Modal-D05P99kH.js";import{A as Y}from"./Alert-D32VqIXN.js";import{F as d}from"./Form-CGCyrcfL.js";import{T as de}from"./Table-WM_kTK7U.js";import{g as pe}from"./packageingTypeRequest-CUTcv2jf.js";import{g as ge}from"./fertilizerTypesRequest-CzftO6V-.js";import{A as je,a as be,E as fe,b as Ne}from"./ExpandMore-BGXL0BaM.js";import{c as W,d as X,a as J,F as Z}from"./formik.esm-C0GtiMNK.js";import{h as ee}from"./uploadFileRequest-j7nqPy1R.js";import{d as ke,p as ye,a as Se,S as se,b as te,c as ae,e as ve}from"./trackingRequest-wN0MMLEF.js";import{F as re,I as ie}from"./FirebaseImage-DiJQPKTY.js";import{B as K}from"./Badge-C_mrIdUk.js";import{B as we,D as Ce}from"./DataGrid-DoczE-38.js";import{g as Te}from"./fertilizerMainRequest-kGbpd_0A.js";import{a as Fe}from"./customerRequest-D-QXhSQD.js";import{g as De}from"./specialConditionsRequest-B-G5iiQh.js";import{C as ne}from"./CountrySelect-DQQwKg9k.js";import{C as R}from"./Card-BhOVTKNa.js";import"./firebaseConfig-pMHECxRz.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";import"./DefaultPropsProvider-2RhE6zQB.js";import"./emotion-element-f0de968e.browser.esm-C-W82wov.js";import"./TextField-DmQ6Lsg1.js";import"./toPropertyKey-CTo9CRTC.js";import"./Divider-mvYdwXE_.js";import"./react-select.esm-jYPj7h1v.js";const qe=({service:m})=>{const[D,_]=o.useState(!1),[b,q]=o.useState(""),[C,f]=o.useState([]);console.log("service :",m);const H=t=>{const i=t.target.value;q(i),f([])},[k,L]=o.useState([]),[T,y]=o.useState(0),$=()=>{const t=k.reduce((s,r)=>s+r.price*r.quantity,0),i=t*(T/100),l=t-i,h=l*.07,j=l+h;return{totalAmount:t,discountAmount:i,netTotal:l,vatAmount:h,grandTotal:j}},{totalAmount:P,discountAmount:v,netTotal:A,vatAmount:E,grandTotal:z}=$(),I=t=>{console.log("item:",t),console.log("item:",k);const i=k.find(h=>h.test_item_id===t.test_item_id);let l;i?l=k.filter(h=>h.test_item_id!==t.test_item_id):l=[...k,{...t}],console.log(l),L(l)},B=t=>{f(i=>i.includes(t)?i.filter(l=>l!==t):[...i,t])},g=m!=null&&m.sample_submissions&&Array.isArray(m.sample_submissions)?m.sample_submissions.find(t=>t.submission_id===parseInt(b)):null,a=t=>{var l;return(l=m.test_items_for_quotation.find(h=>h.test_item_id===t))==null?void 0:l.name_for_quotation},n=()=>{if(!g||C.length===0){alert("กรุณาเลือก Sample Submission และอย่างน้อยหนึ่งรายการทดสอบ");return}let t=[];const i=new Date;i.setDate(i.getDate()+30),m.customer_id,m.request_id,i.toISOString().split("T")[0],parseFloat(P.toFixed(2)),parseFloat(T.toFixed(2)),parseFloat(v.toFixed(2)),parseFloat(A.toFixed(2)),parseFloat(E.toFixed(2)),parseFloat(z.toFixed(2)),createdBy,quotationTypeId;const l={submission_id:b,status:"pending_test",notes:"รอทดสอบบางรายการ"};t.push({...l,id:t.length+1}),console.log("newSampleStatus:",t),console.log("selectedItems:",k),console.log("Selected Submission:",g),console.log("Selected Details:",C),_(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"success",onClick:()=>_(!0),disabled:!m||!m.sample_submissions,children:"เลือกรายการทดสอบ"}),e.jsxs(S,{show:D,onHide:()=>{_(!1),f([])},size:"lg",centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx("h5",{className:"mb-0",children:"เลือกทดสอบบางรายการ"})}),e.jsx(S.Body,{children:!m||!m.sample_submissions||!Array.isArray(m.sample_submissions)?e.jsx(Y,{variant:"warning",children:"ไม่มีข้อมูล Sample Submissions ให้เลือก"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mb-3",children:e.jsx(c,{children:e.jsxs(d.Group,{controlId:"submissionSelect",children:[e.jsx(d.Label,{className:"text-dark",children:"เลือกตัวอย่างปุ๋ย"}),e.jsxs(d.Select,{value:b,onChange:H,children:[e.jsx("option",{children:"เลือกตัวอย่างปุ๋ย"}),m.sample_submissions.map(t=>e.jsxs("option",{value:t.submission_id,children:[t.common_name," (",t.fertilizer_formula,")"]},t.submission_id))]})]})})}),b&&!g?e.jsx(Y,{variant:"danger",children:"ไม่พบข้อมูล Sample Submission ที่เลือก"}):g&&e.jsx(U,{className:"mb-3",children:e.jsxs(c,{children:[e.jsx(d.Label,{className:"text-dark",children:"รายการทดสอบ"}),e.jsxs(de,{bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"50px"},className:"text-center",children:"เลือก"}),e.jsx("th",{className:"text-center",children:"Code"}),e.jsx("th",{children:"ชื่อการทดสอบ"}),e.jsx("th",{className:"text-center",children:"เปอเซ็นต์"})]})}),e.jsx("tbody",{children:g.sample_submission_details&&Array.isArray(g.sample_submission_details)?g.sample_submission_details.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:e.jsx(d.Check,{type:"checkbox",checked:C.includes(t.detail_id),onChange:()=>{B(t.detail_id),I(m.test_items_for_quotation.find(i=>i.test_item_id===t.test_item_id))}})}),e.jsx("td",{className:"text-center",children:t.test_code}),e.jsx("td",{children:a(t.test_item_id)}),e.jsx("td",{className:"text-center",children:t.test_percentage?t.test_percentage+"  %":"-"})]},t.detail_id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"ไม่มีรายการทดสอบ"})})})]})]})})]})}),e.jsxs(S.Footer,{children:[e.jsx(w,{variant:"success",onClick:n,disabled:!b||C.length===0,children:"บันทึก"}),e.jsx(w,{variant:"secondary",onClick:()=>{_(!1),f([])},children:"ยกเลิก"})]})]})]})},Ae=({submissionId:m,handleTracking:D,serviceRequestId:_,sampleSubmissions:b,serviceData:q})=>{const[C,f]=o.useState(!1),[H,k]=o.useState(!1),[L,T]=o.useState([]),[y,$]=o.useState(null);o.useEffect(()=>{var a,n;if(b&&b.length>0){const t=((n=(a=b.find(i=>i.submission_id===m))==null?void 0:a.sample_tracking)==null?void 0:n.map(i=>({tracking_id:i.tracking_id,carrier_name:i.carrier_name,tracking_number:i.tracking_number,proof_image:i.proof_image,status:i.status})))||[];T(t)}},[m,b]);const P=W({carrier_name:J().required("กรุณาเลือกผู้ให้บริการจัดส่ง"),tracking_number:J().required("กรุณากรอกหมายเลข Tracking"),proof_image:X().required("กรุณาอัปโหลดหลักฐานการส่ง")}),v=W({carrier_name:J().required("กรุณาเลือกผู้ให้บริการจัดส่ง"),tracking_number:J().required("กรุณากรอกหมายเลข Tracking"),proof_image:X().nullable()}),A={carrier_name:"",tracking_number:"",proof_image:null,status:"received"},E=async(a,{setSubmitting:n,resetForm:t,setErrors:i})=>{try{const h=(await ee([a.proof_image],"proof_images","proof_"))[0].fileName,j={submission_id:m,tracking_number:a.tracking_number,carrier_name:a.carrier_name,status:a.status,proof_image:h},s=await ye(j);T(r=>[...r,{tracking_id:s.tracking_id||Date.now(),carrier_name:a.carrier_name,tracking_number:a.tracking_number,proof_image:h,status:"received"}]),await g(),D(!0),f(!1),t()}catch(l){console.error("Error saving tracking data:",l),i({submit:"เกิดข้อผิดพลาดในการบันทึกข้อมูล กรุณาลองใหม่"}),n(!1)}},z=async(a,{setSubmitting:n,setErrors:t})=>{try{let i=y.proof_image;a.proof_image&&(i=(await ee([a.proof_image],"proof_images","proof_"))[0].fileName);const l={submission_id:m,tracking_number:a.tracking_number,carrier_name:a.carrier_name,status:a.status||y.status,proof_image:i};await Se(y.tracking_id,l),T(h=>h.map(j=>j.tracking_id===y.tracking_id?{...j,...l}:j)),D(!0),k(!1)}catch(i){console.error("Error updating tracking data:",i),t({submit:"เกิดข้อผิดพลาดในการแก้ไขข้อมูล กรุณาลองใหม่"}),n(!1)}},I=a=>{const n=L.find(t=>t.tracking_id===a);$(n),k(!0)},B=async a=>{if(window.confirm("คุณต้องการลบข้อมูลการจัดส่งตัวอย่าง หรือไม่?"))try{await ke(a),V.success("ลบข้อมูลการจัดส่งตัวอย่างสำเร็จ!",{autoClose:3e3}),T(t=>t.filter(i=>i.tracking_id!==a)),await g(),D(!0)}catch{V.error("ลบข้อมูลการจัดส่งตัวอย่างไม่สำเร็จ!",{autoClose:3e3})}},g=async()=>{const a=await Q(_),n=a.sample_submissions,i=n.reduce((h,j)=>{const s=j.sample_tracking||[];return h+(s.some(r=>r.submission_id===j.submission_id&&r.status==="received")?1:0)},0)===n.length,l=a.service_status_logs||{};i&&l.sample_sent===null?await xe(_,{newStatusTracking:"sample_sent"}):!i&&l.sample_sent!==null&&await _e(_,{StatusTracking:"sample_sent"})};return e.jsxs(e.Fragment,{children:[e.jsx("h6",{className:"mb-3 mt-3",children:"ข้อมูลการจัดส่งตัวอย่าง"}),e.jsxs(de,{striped:!0,bordered:!0,hover:!0,className:"mt-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{width:80,className:"text-center",children:"#"}),e.jsx("th",{children:"ผู้ให้บริการจัดส่ง"}),e.jsx("th",{children:"หมายเลข Tracking"}),e.jsx("th",{className:"text-center",width:180,children:"สถานะ"}),e.jsx("th",{className:"text-center",children:"หลักฐานการส่ง"}),e.jsx("th",{className:"text-center",children:"Action"})]})}),e.jsx("tbody",{children:L.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:n+1}),e.jsx("td",{children:a.carrier_name}),e.jsx("td",{children:a.tracking_number}),e.jsx("td",{className:"text-center",children:e.jsx(K,{bg:a.status==="received"?"secondary":a.status==="in_processing"?"warning":a.status==="completed"?"primary":"success",children:a.status==="received"?"ดำเนินการจัดส่ง":a.status==="in_processing"?"กำลังทดสอบ":a.status==="completed"?"ทดสอบเสร็จสิ้น":"จัดส่งสำเร็จ"})}),e.jsx("td",{className:"text-center",children:e.jsx(re,{imagePath:a.proof_image,alt:`Proof for ${a.tracking_number}`,style:{maxHeight:"100px"},thumbnail:!0})}),e.jsx("td",{className:"text-center",children:e.jsxs(we,{children:[e.jsx(w,{variant:"info",size:"sm",disabled:a.status!=="received",onClick:()=>I(a.tracking_id),children:e.jsx(ce,{})}),e.jsx(w,{variant:"danger",size:"sm",disabled:a.status!=="received",onClick:()=>B(a.tracking_id),children:e.jsx(me,{})})]})})]},`${a.tracking_number}-${n}`))})]}),!q.service_status_logs.sample_arrived_lab&&e.jsx(w,{variant:"primary",onClick:()=>f(!0),children:"เพิ่มข้อมูลการจัดส่ง"}),e.jsxs(S,{show:C,onHide:()=>f(!1),centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:e.jsx("h5",{children:"รายละเอียดการจัดส่งตัวอย่าง"})})}),e.jsx(Z,{initialValues:A,validationSchema:P,onSubmit:E,children:({values:a,errors:n,touched:t,handleChange:i,handleBlur:l,handleSubmit:h,setFieldValue:j,isSubmitting:s})=>e.jsxs(d,{onSubmit:h,children:[e.jsxs(S.Body,{children:[n.submit&&e.jsx("div",{className:"text-danger mb-3",children:n.submit}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"ผู้ให้บริการจัดส่ง"}),e.jsxs(d.Select,{name:"carrier_name",value:a.carrier_name,onChange:i,onBlur:l,isInvalid:t.carrier_name&&!!n.carrier_name,children:[e.jsx("option",{value:"",children:"เลือกผู้ให้บริการจัดส่ง"}),e.jsx("option",{value:"ไปรษณีย์ไทย",children:"ไปรษณีย์ไทย"}),e.jsx("option",{value:"Kerry Express",children:"Kerry Express"}),e.jsx("option",{value:"J&T Express",children:"J&T Express"}),e.jsx("option",{value:"DHL",children:"DHL"})]}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.carrier_name})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หมายเลข Tracking"}),e.jsx(d.Control,{type:"text",name:"tracking_number",placeholder:"กรอกหมายเลข Tracking",value:a.tracking_number,onChange:i,onBlur:l,isInvalid:t.tracking_number&&!!n.tracking_number}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.tracking_number})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หลักฐานการส่ง"}),e.jsx(d.Control,{type:"file",accept:"image/*",onChange:r=>j("proof_image",r.target.files[0]),isInvalid:t.proof_image&&!!n.proof_image}),a.proof_image&&e.jsx("div",{className:"mt-3",children:e.jsx(ie,{src:URL.createObjectURL(a.proof_image),alt:"Proof",thumbnail:!0,style:{maxHeight:"200px"}})}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.proof_image})]})]}),e.jsxs(S.Footer,{children:[e.jsx(w,{variant:"success",type:"submit",disabled:s,children:"บันทึก"}),e.jsx(w,{variant:"secondary",onClick:()=>f(!1),disabled:s,children:"ยกเลิก"})]})]})})]}),y&&e.jsxs(S,{show:H,onHide:()=>k(!1),centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:e.jsx("h5",{children:"แก้ไขรายละเอียดการจัดส่งตัวอย่าง"})})}),e.jsx(Z,{initialValues:{carrier_name:y.carrier_name,tracking_number:y.tracking_number,proof_image:null,status:y.status},validationSchema:v,onSubmit:z,children:({values:a,errors:n,touched:t,handleChange:i,handleBlur:l,handleSubmit:h,setFieldValue:j,isSubmitting:s})=>e.jsxs(d,{onSubmit:h,children:[e.jsxs(S.Body,{children:[n.submit&&e.jsx("div",{className:"text-danger mb-3",children:n.submit}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"ผู้ให้บริการจัดส่ง"}),e.jsxs(d.Select,{name:"carrier_name",value:a.carrier_name,onChange:i,onBlur:l,isInvalid:t.carrier_name&&!!n.carrier_name,children:[e.jsx("option",{value:"",children:"เลือกผู้ให้บริการจัดส่ง"}),e.jsx("option",{value:"ไปรษณีย์ไทย",children:"ไปรษณีย์ไทย"}),e.jsx("option",{value:"Kerry Express",children:"Kerry Express"}),e.jsx("option",{value:"J&T Express",children:"J&T Express"}),e.jsx("option",{value:"DHL",children:"DHL"})]}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.carrier_name})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หมายเลข Tracking"}),e.jsx(d.Control,{type:"text",name:"tracking_number",placeholder:"กรอกหมายเลข Tracking",value:a.tracking_number,onChange:i,onBlur:l,isInvalid:t.tracking_number&&!!n.tracking_number}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.tracking_number})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หลักฐานการส่ง (ถ้าต้องการเปลี่ยน)"}),e.jsx(d.Control,{type:"file",accept:"image/*",onChange:r=>j("proof_image",r.target.files[0]),isInvalid:t.proof_image&&!!n.proof_image}),e.jsx("div",{className:"mt-3",children:a.proof_image?e.jsx(ie,{src:URL.createObjectURL(a.proof_image),alt:"New Proof",thumbnail:!0,style:{maxHeight:"200px"}}):e.jsx(re,{imagePath:y.proof_image,alt:"Current Proof",style:{maxHeight:"200px"},thumbnail:!0})}),e.jsx(d.Control.Feedback,{type:"invalid",children:n.proof_image})]})]}),e.jsxs(S.Footer,{children:[e.jsx(w,{variant:"success",type:"submit",disabled:s,children:"บันทึกการแก้ไข"}),e.jsx(w,{variant:"secondary",onClick:()=>k(!1),disabled:s,children:"ยกเลิก"})]})]})})]})]})},le=({serviceId:m,handleReload:D})=>{oe();const[_,b]=o.useState({}),[q,C]=o.useState({});o.useEffect(()=>{m&&$(m)},[m]);const[f,H]=o.useState({}),[k,L]=o.useState([]),[T,y]=o.useState([]),$=async s=>{const r=await Q(s);await A(r.customer_id),r.sample_submissions=r.sample_submissions.map(x=>({...x,reportMethod:[x.is_self_pickup?"is_self_pickup":null,x.pdf_email?"pdf_email":null,x.is_mail_delivery?"is_mail_delivery":null].filter(Boolean),sampleDisposal:x.is_lab_dispose_sample?"is_lab_dispose_sample":x.is_collect_within_3_months?"is_collect_within_3_months":"is_return_sample"})),console.log("response.sample_submissions:",r.sample_submissions),L(r.sample_submissions),H(r)},[P,v]=o.useState([]),A=async s=>{try{const r=await Fe(s);console.log("getCustomerByID:",r),await E(s),b(r)}catch(r){console.error(r),b([])}},E=async s=>{try{const r=await De(s);C(Array.isArray(r)?r:[])}catch(r){console.error(r),C([])}};o.useEffect(()=>{a(),z(),g()},[]);const z=async()=>{const s=await pe();v(s)},[I,B]=o.useState([]),g=async()=>{try{const s=await ge();B(s)}catch(s){console.log(s)}},a=async()=>{try{const r=(await Te()).map(x=>({value:x.fertilizer_main_id,label:x.fertilizer_main_name_th}));console.log("formattedOptions",r),y(r)}catch(s){console.error("Error fetching fertilizer formulas:",s),y([])}},n=[{value:"g",label:"กรัม"},{value:"kg",label:"กิโลกรัม"},{value:"oz",label:"ออนซ์"},{value:"ml",label:"มิลลิลิตร"},{value:"L",label:"ลิตร"}],t=[{field:"no",headerName:"#",width:90,headerAlign:"center",align:"center"},{field:"test_code",headerName:"ทดสอบ",flex:1,renderCell:s=>{if(!s||!s.row)return"-";const{test_code:r,test_percentage:x}=s.row;return`${r||""}${x?` (${x})`:""}`.trim()}},{field:"status",headerName:"สถานะ",headerAlign:"center",align:"center",flex:1,renderCell:s=>e.jsx(K,{pill:!0,bg:s.row.status==="pending"?"warning":s.row.status==="rejected"?"danger":"success",children:s.row.status==="pending"?"รออนุมัติ":s.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"test_value",headerName:"ผลที่ได้",flex:1,renderCell:s=>{var r;return((r=s==null?void 0:s.row)==null?void 0:r.test_value)||"-"}},{field:"test_date",headerName:"วันที่ทดสอบ",flex:1,valueGetter:s=>{var r;return((r=s==null?void 0:s.row)==null?void 0:r.created_at)||"-"}}],i=s=>s.map((x,F)=>({id:x.detail_id,no:F+1,...x})),l=[{value:"is_self_pickup",label:"รับด้วยตนเอง"},{value:"pdf_email",label:"ต้องการไฟล์ pdf เพิ่มเติมทาง E-mail"},{value:"is_mail_delivery",label:"ส่งทางไปรษณีย์"}],h=s=>s.map(r=>{var x;return((x=l.find(F=>F.value===r))==null?void 0:x.label)||r}).join(", "),j=[{value:"is_lab_dispose_sample",label:"ให้ห้องปฏิบัติการจำหน่ายตัวอย่าง"},{value:"is_collect_within_3_months",label:"มารับตัวอย่างคืนภายใน 3 เดือน"},{value:"is_return_sample",label:"ให้ห้องปฏิบัติการจัดส่งตัวอย่างคืน"}];return e.jsx("div",{children:e.jsx(R,{style:{borderRadius:10,marginBottom:0},children:e.jsxs(R.Body,{style:{paddingBottom:20,paddingTop:20},children:[e.jsxs(U,{children:[e.jsx(c,{md:12,children:e.jsxs("h5",{className:"mb-4",children:["เลขที่คำขอรับบริการ : ",e.jsx("span",{style:{fontSize:18},children:f.request_no||"-"})]})}),e.jsx(c,{md:12,children:e.jsx("h6",{className:"mb-3",children:"ข้อมูลผู้ขอขึ้นทะเบียน"})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["รหัสลูกค้า : ",e.jsx("strong",{className:"text-dark",children:_.company_code})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อบริษัท : ",e.jsx("strong",{className:"text-dark",children:_.company_name})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เลขที่ผู้เสียภาษี : ",e.jsx("strong",{className:"text-dark",children:_.tax_id})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ที่อยู่ : ",e.jsx("strong",{className:"text-dark",children:_.company_address})]})}),e.jsx(c,{md:6,children:e.jsxs("p",{className:"mb-0",children:["เงื่อนไขพิเศษ :"," ",e.jsx("strong",{className:"text-dark",children:q.length>0?q.map((s,r)=>`${s.description}${r<q.length-1?", ":""}`):"-"})]})}),f.sample_type_id===1&&e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วัตถุประสงค์การขอรับบริการ :"," ",e.jsx("strong",{className:"text-dark",children:f.is_quality_check_analysis===1?"วิเคราะห์เพื่อตรวจสอบคุณภาพ":"วิเคราะห์ขึ้นทะเบียน"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทคำขอ : ",e.jsx("strong",{className:"text-dark",children:f.sample_type_name})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["คำขอเพิ่มเติม : ",e.jsx("strong",{className:"text-dark",children:f.notes})]})})]}),e.jsx("h6",{className:"mt-3 mb-2",children:"ข้อมูลตัวอย่างปุ๋ย"}),k.map((s,r)=>{var x,F,G,p,N;return e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs(c,{md:12,className:"ms-2 ps-0 pe-0",style:{border:"1px solid #f8f9fa"},children:[e.jsxs(je,{className:"mb-0",sx:{boxShadow:"none"},children:[e.jsx(be,{expandIcon:e.jsx(fe,{}),"aria-controls":`panel${r}-content`,id:`panel${r}-header`,sx:{backgroundColor:"#f8f9fa",borderRadius:0},children:e.jsxs("p",{className:"mb-0",children:["ตัวอย่างที่ ",r+1," หมายเลขตัวอย่าง :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:s.submission_no||"-"})," ",s.sample_type_id===2&&e.jsxs(e.Fragment,{children:["สูตรปุ๋ย : ",e.jsx("strong",{className:"text-dark",children:s.fertilizer_formula||"-"})," ( ชื่อสามัญ :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:s.common_name||"-"}),")"," "]}),"สถานะ :",e.jsx(K,{pill:!0,bg:s.verification_status==="No"&&s.is_job_accepted||s.verification_status==="No"&&!s.is_job_accepted||s.verification_status==="Yes"&&!s.is_job_accepted?"warning":s.verification_status==="Yes"&&s.is_job_accepted?"success":"danger",style:{marginLeft:12},children:s.verification_status==="No"&&s.is_job_accepted||s.verification_status==="No"&&!s.is_job_accepted||s.verification_status==="Yes"&&!s.is_job_accepted?"รอการตรวจสอบ":s.verification_status==="Yes"&&s.is_job_accepted?"รับงาน":" ไม่อนุมัติ"})]})}),e.jsx(Ne,{className:"pb-0",children:e.jsxs(U,{children:[s.fertilizer_main_id&&e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทของปุ๋ย :"," ",e.jsx("strong",{className:"text-dark",children:(x=T.find(u=>u.value===s.fertilizer_main_id))==null?void 0:x.label})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ลักษณะปุ๋ย :"," ",e.jsxs("strong",{className:"text-dark",children:[((F=I.find(u=>u.fertilizer_type_id===s.fertilizer_type_id))==null?void 0:F.fertilizer_type_name)||"-",s.fertilizer_other&&` (${s.fertilizer_other})`]})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สี : ",e.jsx("strong",{className:"text-dark",children:s.color||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อการค้า : ",e.jsx("strong",{className:"text-dark",children:s.trade_name||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เครื่องหมายการค้า : ",e.jsx("strong",{className:"text-dark",children:s.trademark||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ผู้ผลิต (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:s.manufacturer||"-"})," ประเทศ :"," ",e.jsx(ne,{name:"country",label:"ประเทศ",value:s.manufacturer_country||"-",onChange:(u,M)=>console.log(u,M),showText:!0})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สั่งจาก (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:s.supplier||"-"})," ประเทศ :"," ",e.jsx(ne,{name:"country",label:"ประเทศ",value:s.supplier_country||"-",onChange:(u,M)=>console.log(u,M),showText:!0})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วัตถุส่วนประกอบของปุ๋ย : ",e.jsx("strong",{className:"text-dark",children:s.composition||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ปริมาณ : ",e.jsx("strong",{className:"text-dark",children:s.sample_weight||"-"})," ",e.jsx("strong",{className:"text-dark",children:((G=n.find(u=>u.value===s.sample_weight_unit))==null?void 0:G.label)||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ภาชนะบรรจุ :"," ",e.jsxs("strong",{className:"text-dark",children:[((p=P.find(u=>u.packaging_type_id===s.packaging_id))==null?void 0:p.packaging_type_name)||"-",s.packaging_other&&` (${s.packaging_other})`]})]})}),e.jsx(c,{md:12,className:"mb-4",children:e.jsxs(c,{children:["รายการทดสอบ :"," ",e.jsx("div",{style:{width:"100%"},children:e.jsx(Ce,{rows:i(s.sample_submission_details),columns:t,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})})]})}),e.jsxs(c,{md:12,className:"mb-2 ",children:[e.jsxs("p",{className:"mb-1",children:["การรับรายงานผล : ",e.jsx("strong",{className:"text-dark",children:h(s.reportMethod)})]}),s.reportMethod.includes("pdf_email")&&e.jsxs("p",{className:"mb-1",children:["E-mail สำหรับรับผลตรวจ : ",e.jsx("strong",{className:"text-dark",children:s.pdf_email||"-"})]}),s.reportMethod.includes("is_mail_delivery")&&e.jsxs("p",{className:"mb-1",children:["ที่อยู่จัดส่ง : ",e.jsx("strong",{className:"text-dark",children:s.mail_delivery_location||"-"})]})]}),e.jsxs(c,{md:6,className:"mb-1",children:["วิธีการจำหน่ายตัวอย่าง :"," ",e.jsx("strong",{className:"text-dark",children:((N=j.find(u=>u.value===s.sampleDisposal))==null?void 0:N.label)||"-"})]}),e.jsxs(c,{md:12,className:"mb-1",children:["ความต้องการอื่น : ",e.jsx("strong",{className:"text-dark",children:s.other_requirements||"-"})]}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ผู้ส่งตัวอย่าง : ",e.jsx("strong",{className:"text-dark",children:s.submitted_by||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เบอร์โทรศัพท์ผู้ส่ง : ",e.jsx("strong",{className:"text-dark",children:s.phone||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วันที่ส่ง : ","",e.jsx("strong",{className:"text-dark",children:new Date(s.submission_date).toLocaleDateString("th-TH")||"-"})]})})]})})]}),e.jsx(c,{style:{padding:"0 16px 16px"},children:e.jsx(c,{children:e.jsx(Ae,{submissionId:s.submission_id,handleTracking:D,trackingData:s.sample_tracking,serviceRequestId:m,serviceData:f,sampleSubmissions:k})})})]})},`Accordion-${r}`),r<k.length-1&&e.jsx("hr",{className:"mt-4 mb-2"})]})})})]})})})},Ee=({title:m})=>{var x,F,G;const _=((x=ue().state)==null?void 0:x.id)||null;console.log("id",_);const b=oe(),[q,C]=o.useState(2),[f,H]=o.useState(!1),[k,L]=o.useState(!1),[T,y]=o.useState(!1),[$,P]=o.useState(!1),[v,A]=o.useState("horizontal"),[E,z]=o.useState(0),[I,B]=o.useState(!0);o.useEffect(()=>{_?i(_):b("/request/")},[_,b]);const[g,a]=o.useState({}),[n,t]=o.useState([]),i=async p=>{try{B(!0);const N=await Q(p);t(N.sample_submissions||[]),a(N),l(N,{})}catch(N){console.error("Error fetching service request:",N)}finally{B(!1)}},l=(p,N)=>{const u=p.sample_submissions||[],M=p.service_status_logs||{};for(let O=0;O<s.length;O++)if(r(O,u,M))z(O+1);else{z(O);break}};o.useEffect(()=>{const p=()=>{window.innerWidth<=768?A("vertical"):A("horizontal")};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),o.useEffect(()=>{},[]);const h=p=>{b("/request/edit/",{state:{id:p}})},j=p=>{p&&i(_)},s=[{label:"คำขอรับบริการ",status:"requested"},{label:"ลูกค้าส่งตัวอย่าง",status:"sample_sent"},{label:"ทบทวนคำขอ",status:"request_reviewed"},{label:"ตัวอย่างจัดส่งถึงแล็บ",status:"sample_arrived_lab"},{label:"รับตัวอย่างเข้าระบบ",status:"sample_received"},{label:"รอทดสอบบางรายการ",status:"partial_testing"},{label:"ออกใบเสนอราคา",status:"quotation_issued"},{label:"ขอใบแจ้งหนี้",status:"invoice_requested"},{label:"รับชำระเงิน",status:"payment_received"},{label:"หัก ณ ที่จ่าย",status:"tax_withheld"},{label:"ออกใบเสร็จรับเงิน/ใบกำกับภาษี",status:"receipt_issued"}],r=(p,N,u)=>{const M=N.length;switch(s[p].status,p){case 0:return u.requested!==null;case 1:return M===0?!1:u.sample_sent!==null;case 2:return u.request_reviewed!==null;case 3:return u.sample_arrived_lab!==null;case 4:return u.sample_received!==null;case 5:return u.partial_testing!==null;case 6:return u.quotation_issued!==null;case 7:return u.invoice_requested!==null;case 8:return u.payment_received!==null;case 9:return u.tax_withheld!==null;case 10:return u.receipt_issued!==null;default:return!1}};return e.jsx("div",{children:e.jsxs(R,{children:[e.jsx(R.Header,{children:e.jsx("h5",{children:m})}),e.jsx(R.Body,{children:e.jsx("div",{children:I?e.jsxs("div",{className:"text-center",children:[e.jsx(he,{animation:"border",variant:"primary"}),e.jsx("p",{children:"กำลังโหลดข้อมูล..."})]}):v==="vertical"?e.jsx(se,{activeStep:E,orientation:v,alternativeLabel:v==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:s.map((p,N)=>e.jsxs(te,{completed:r(N,n,g.service_status_logs||{}),children:[e.jsx(ae,{children:p.label}),v==="vertical"&&e.jsx(ve,{children:e.jsx(le,{serviceId:_,handleReload:j})})]},N))}):e.jsxs(e.Fragment,{children:[e.jsx(R,{style:{borderRadius:10,marginBottom:10},children:e.jsx(R.Body,{style:{padding:"8px 20px 3px"},children:e.jsx(se,{activeStep:E,orientation:v,alternativeLabel:v==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:s.map((p,N)=>e.jsx(te,{completed:r(N,n,g.service_status_logs||{}),children:e.jsx(ae,{children:p.label})},N))})})}),e.jsx(le,{serviceId:_,handleReload:j})]})})}),e.jsxs(R.Footer,{className:"text-start",children:[((F=g.service_status_logs)==null?void 0:F.partial_testing)&&e.jsx(qe,{service:g}),e.jsxs(w,{variant:"primary",disabled:((G=g.service_status_logs)==null?void 0:G.quotation_issued)||g.status==="rejected",onClick:()=>h(_),children:[e.jsx(ce,{style:{marginRight:8}})," แก้ไขข้อมูล"]}),e.jsxs(w,{variant:"danger",onClick:()=>b("/request/"),children:[e.jsx("i",{className:"feather icon-corner-up-left"})," กลับหน้าหลัก"]})]})]})})},ds=()=>e.jsx(Ee,{title:"รายละเอียดข้อมูลนำส่งตัวอย่างปุ๋ย"});export{ds as default};
