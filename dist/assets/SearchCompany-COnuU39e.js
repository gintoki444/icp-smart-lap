import{r as n,u as v,h as D,ar as f,y as c,j as t,B as l,i as L,aA as R}from"./index-Bq0BSIrC.js";import{g as E}from"./customerRequest-CvJAP-BQ.js";import{C as d}from"./Card-C7kDYjR9.js";import{S as F}from"./Stack-fH19WBfQ.js";import{F as T}from"./Form-C1nYDdO8.js";import{B as b}from"./ButtonGroup-bg4r2ah8.js";import{D as z}from"./DataGrid-CHhOcfGb.js";import"./DefaultPropsProvider-CMzRgkCO.js";import"./emotion-element-f0de968e.browser.esm-xSVEHtue.js";import"./TextField-BqqrABCd.js";import"./toPropertyKey-KGmwFxs9.js";import"./Transition-DABJrq3x.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-31lZdKBP.js";const X=()=>{const[h,g]=n.useState([]),[A,B]=n.useState(null),[u,x]=n.useState([]),[i,m]=n.useState(()=>localStorage.getItem("filterText")||""),[y,_]=n.useState(u),p=v();n.useEffect(()=>{const e=localStorage.getItem("authToken");e&&D(e).then(a=>{g(a.user)}),C()},[]);const C=async()=>{try{const e=await E();if(e){const a=await f();console.log("checkData:",a);const r=e.filter(o=>{const s=!a.some(N=>N.company_id===o.company_id);return console.log(`company_id: ${o.company_id}, isNotRegistered: ${s}`),s}).map((o,s)=>({id:o.company_id,No:s+1,company_name:o.company_name,company_code:o.company_code,company_address:o.company_address,document_address:o.document_address,tax_id:o.tax_id,email:o.email,phone:o.phone,special_conditions:o.special_conditions,created_at:new Date(o.created_at).toLocaleString()}));console.log("rows:",r),x(r),_(r)}}catch(e){console.error("Error in getCustomers:",e),c.error(`เกิดข้อผิดพลาดในการโหลดข้อมูล: ${e.message}`,{autoClose:3e3})}},S=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"company_name",headerName:"ชื่อบริษัท",flex:1.2},{field:"tax_id",headerName:"เลขที่ผู้เสียภาษี",flex:1},{field:"company_address",headerName:"ที่อยู่บริษัท",flex:3},{field:"actions",headerName:"การจัดการ",flex:1,headerAlign:"center",align:"center",renderCell:e=>t.jsx(b,{children:t.jsx(l,{variant:"info",size:"sm",onClick:()=>k(e.row),children:"เลือก"})})}],w=y.filter(e=>Object.values(e).some(a=>a&&a.toString().toLowerCase().includes(i.toLowerCase())));n.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const j=()=>{m(""),localStorage.removeItem("filterText")},k=async e=>{if(window.confirm(`คุณต้องการลงทะเบียนข้อมูลลูกค้า/บริษัท "${e.company_name}" หรือไม่?`))try{if((await f()).find(s=>s.company_id===e.id))c.warning("บริษัทนี้ถูกลงทะเบียนแล้ว!",{autoClose:3e3});else{const s={user_id:h.user_id,company_id:e.id,approved_by:null,status:"pending"};await R(s),c.success("ลงทะเบียนข้อมูลลูกค้า/บริษัทสำเร็จ!",{autoClose:3e3}),p("/company")}}catch(r){console.error("Error saving data:",r),c.error(`ลงทะเบียนข้อมูลลูกค้า/บริษัทไม่สำเร็จ: ${r.message}`,{autoClose:3e3})}};return t.jsx(t.Fragment,{children:t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsx("h5",{children:"ค้นหาข้อมูลลูกค้า/บริษัท"})}),t.jsxs(d.Body,{children:[t.jsxs(F,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(T.Control,{type:"text",placeholder:"Search",value:i,onChange:e=>m(e.target.value)}),t.jsx(l,{variant:"primary",size:"sm",onClick:j,disabled:!i,children:t.jsx(L,{style:{fontSize:20}})}),t.jsxs(l,{variant:"success",size:"sm",onClick:()=>p("/company/select"),children:[t.jsx("i",{className:"feather icon-plus-circle"})," เพิ่ม"]})]}),t.jsx(z,{rows:w,columns:S,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{X as default};
