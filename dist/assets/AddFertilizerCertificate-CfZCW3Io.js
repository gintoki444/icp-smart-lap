import{u as C,r as l,j as e,R as y,C as o,B as p,y as F}from"./index-6YeC_AS5.js";import{p as N}from"./fertilizerCertificateRequest-DsyareGj.js";import{g as E}from"./fertilizerMainRequest-kGbpd_0A.js";import{C as m}from"./Card-BhOVTKNa.js";import{A as I}from"./Alert-D32VqIXN.js";import{F as r}from"./Form-CGCyrcfL.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";const R=()=>{const u=C(),[n,x]=l.useState({fertilizer_main_id:"",nutrient_name:"",min_value:"",unit:"",legal_reference:""}),[j,v]=l.useState([]),[t,_]=l.useState({}),[f,d]=l.useState(null),[c,h]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const a=await E();v(a)}catch(a){d("เกิดข้อผิดพลาดในการดึงข้อมูลหมวดหมู่ปุ๋ย"),console.error("Error fetching fertilizer mains:",a)}})()},[]);const g=()=>{const i={};return n.fertilizer_main_id||(i.fertilizer_main_id="กรุณาเลือกหมวดหมู่ปุ๋ย"),n.nutrient_name.trim()||(i.nutrient_name="กรุณากรอกชื่อธาตุอาหาร"),(!n.min_value||isNaN(n.min_value)||Number(n.min_value)<0)&&(i.min_value="กรุณากรอกค่าต่ำสุดที่ถูกต้อง (มากกว่าหรือเท่ากับ 0)"),n.unit.trim()||(i.unit="กรุณากรอกหน่วย"),n.legal_reference.trim()||(i.legal_reference="กรุณากรอกข้อมูลอ้างอิงทางกฎหมาย"),_(i),Object.keys(i).length===0},s=i=>{const{name:a,value:b}=i.target;x({...n,[a]:b}),_({...t,[a]:""})},z=async i=>{if(i.preventDefault(),!!g()){h(!0),d(null);try{if((await N({...n,fertilizer_main_id:Number(n.fertilizer_main_id),min_value:Number(n.min_value)})).standard_id)F.success("เพิ่มใบรับรองปุ๋ยสำเร็จ!",{autoClose:3e3}),u("/admin/fertilizer-certificate");else throw new Error("No standard_id returned")}catch(a){d("เกิดข้อผิดพลาดในการเพิ่มใบรับรองปุ๋ย กรุณาลองใหม่"),console.error("Error adding fertilizer certificate:",a)}finally{h(!1)}}};return e.jsx("div",{children:e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx("h5",{children:"เพิ่มใบรับรองปุ๋ย"})}),e.jsxs(m.Body,{children:[f&&e.jsx(I,{variant:"danger",children:f}),e.jsxs(r,{onSubmit:z,children:[e.jsxs(y,{children:[e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"fertilizer_main_id",children:[e.jsx(r.Label,{children:"หมวดหมู่ปุ๋ย"}),e.jsxs(r.Select,{name:"fertilizer_main_id",style:{padding:"10.5px 22px",fontSize:14},value:n.fertilizer_main_id,onChange:s,isInvalid:!!t.fertilizer_main_id,children:[e.jsx("option",{value:"",children:"เลือกหมวดหมู่ปุ๋ย"}),j.map(i=>e.jsxs("option",{value:i.fertilizer_main_id,children:[i.fertilizer_main_name_th," (",i.fertilizer_main_name_en,")"]},i.fertilizer_main_id))]}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.fertilizer_main_id})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"nutrient_name",children:[e.jsx(r.Label,{children:"ชื่อธาตุอาหาร"}),e.jsx(r.Control,{type:"text",name:"nutrient_name",value:n.nutrient_name,placeholder:"กรอกชื่อธาตุอาหาร",onChange:s,isInvalid:!!t.nutrient_name}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.nutrient_name})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"min_value",children:[e.jsx(r.Label,{children:"ค่าต่ำสุด"}),e.jsx(r.Control,{type:"number",name:"min_value",value:n.min_value,placeholder:"กรอกค่าต่ำสุด",onChange:s,isInvalid:!!t.min_value,step:"0.01"}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.min_value})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"unit",children:[e.jsx(r.Label,{children:"หน่วย"}),e.jsx(r.Control,{type:"text",name:"unit",value:n.unit,onChange:s,placeholder:"กรอกหน่วย (%)",isInvalid:!!t.unit}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.unit})]})}),e.jsx(o,{md:12,className:"mb-3",children:e.jsxs(r.Group,{controlId:"legal_reference",children:[e.jsx(r.Label,{children:"ข้อมูลอ้างอิงทางกฎหมาย"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"legal_reference",value:n.legal_reference,placeholder:"กรอกข้อมูลอ้างอิงทางกฎหมาย",onChange:s,isInvalid:!!t.legal_reference}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.legal_reference})]})})]}),e.jsx(p,{variant:"primary",type:"submit",disabled:c,children:c?"กำลังบันทึก...":"บันทึก"}),e.jsx(p,{variant:"danger",className:"ms-2",onClick:()=>u("/admin/fertilizer-certificate"),disabled:c,children:"กลับ"})]})]})]})})};export{R as default};
