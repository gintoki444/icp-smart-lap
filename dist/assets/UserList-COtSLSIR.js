import{r as i,u as A,h as E,D as T,j as t,B as h,i as k,E as b,k as D,F,w as I,H as L,y as v,J as R}from"./index-6YeC_AS5.js";import{a as B}from"./emailRequest-DbDPYP9A.js";import{p as z}from"./telegramNotifyRequest-BwpORK4f.js";import{C as _}from"./Card-BhOVTKNa.js";import{S as P}from"./Stack-DS5MSRky.js";import{F as O}from"./Form-CGCyrcfL.js";import{B as G}from"./Badge-C_mrIdUk.js";import{D as H,B as Y}from"./DataGrid-DoczE-38.js";import"./DefaultPropsProvider-2RhE6zQB.js";import"./emotion-element-f0de968e.browser.esm-C-W82wov.js";import"./TextField-DmQ6Lsg1.js";import"./toPropertyKey-CTo9CRTC.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-mvYdwXE_.js";const J=async(r,l,g)=>{const c=r.fullName||`${r.first_name} ${r.last_name}`,s=r.email||"-",f=r.phone||"-",p=r.role_name||"-",w=l.username||"-",u=l.email||"-",d=l.role||"-",x=new Date().toLocaleString("th-TH",{dateStyle:"long",timeStyle:"short"}),n=g==="Y",j=`
${n?"✅ *ระบบแจ้งเตือนการอนุมัติผู้ใช้งาน*":"⚠️ *ระบบแจ้งเตือนยกเลิกอนุมัติผู้ใช้งาน*"}
--------------------------------------
👤 *ชื่อผู้ใช้งาน:* ${c}
📧 *อีเมล:* ${s}
📱 *เบอร์โทร:* ${f}
🛡️ *สิทธิ์ผู้ใช้งาน:* ${p}

📝 *ผู้${n?"อนุมัติ":"ดำเนินการ"}:* ${w} (${d})
📧 *อีเมลผู้${n?"อนุมัติ":"ดำเนินการ"}:* ${u}
📅 *วันที่${n?"อนุมัติ":"ดำเนินการ"}:* ${x}
`.trim();if(n){const m={toEmail:r.email,subject:"แจ้งอนุมัติผู้ใช้งานระบบ ICP Smart Lab",message:`
เรียนคุณ ${c},

บัญชีของคุณได้รับการ *อนุมัติ* ให้เข้าใช้งานระบบ ICP Smart Lab แล้วเรียบร้อย

คุณสามารถเข้าสู่ระบบเพื่อใช้งานได้ทันทีผ่านลิงก์:
🌐 https://icp-smartlab.com/login

หากคุณมีคำถามหรือต้องการความช่วยเหลือ กรุณาติดต่อผู้ดูแลระบบของคุณ

ขอขอบคุณ,
ทีมงาน ICP Smart Lab
      `.trim(),username:c};try{await B({textMail:m}),console.log("📧 ส่งอีเมลแจ้งเตือนผู้ใช้งานเรียบร้อยแล้ว")}catch(S){console.error("❌ ส่งอีเมลไม่สำเร็จ:",S)}}try{await z({message:j}),console.log("📨 ส่งข้อความแจ้งเตือน Telegram สำเร็จ")}catch(m){console.error("❌ เกิดข้อผิดพลาดในการส่งข้อความ Telegram:",m)}},ne=()=>{const[r,l]=i.useState([]),[g,c]=i.useState([]),[s,f]=i.useState(()=>localStorage.getItem("filterText")||""),[p,w]=i.useState(g),u=A();i.useEffect(()=>{const e=localStorage.getItem("authToken");e&&E(e).then(a=>{l(a.user)}),d()},[]),i.useEffect(()=>{},[p]);const d=()=>{T().then(e=>{if(e){const a=e.map((o,N)=>({id:o.user_id,No:N+1,first_name:o.first_name,last_name:o.last_name,fullName:`${o.first_name} ${o.last_name}`,email:o.email,phone:o.phone,role_id:o.role_id,role_name:o.role_name,dept_id:o.dept_id,dept_name:o.dept_name,createdAt:new Date(o.created_at).toLocaleString(),status:o.status}));c(a),w(a)}})},x=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"fullName",headerName:"ชื่อ-นามสกุล",flex:1},{field:"email",headerName:"E-mail",flex:1},{field:"phone",headerName:"เบอร์โทรศัพท์",flex:1},{field:"role_name",headerName:"Roles",width:120,headerAlign:"center",align:"center"},{field:"createdAt",headerName:"วันที่สร้าง",flex:1},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:e=>t.jsx(G,{pill:!0,style:{},bg:e.row.status==="pending"?"warning":e.row.status==="rejected"?"danger":"success",children:e.row.status==="pending"?"รออนุมัติ":e.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"Action",width:200,headerAlign:"center",align:"center",renderCell:e=>t.jsxs(Y,{children:[t.jsx(h,{variant:e.row.status==="pending"||e.row.status==="rejected"?"outline-success":"outline-warning",size:"sm",onClick:()=>m(e.row.id,e.row.status==="pending"||e.row.status==="rejected"?"Y":"N",e.row),children:e.row.status==="pending"||e.row.status==="rejected"?t.jsx(b,{}):t.jsx(D,{})}),t.jsx(h,{variant:"info",size:"sm",onClick:()=>j(e.row),children:t.jsx(F,{})}),t.jsx(h,{variant:"outline-danger",size:"sm",onClick:()=>S(e.row.id),children:t.jsx(I,{})})]})}],n=p.filter(e=>Object.values(e).some(a=>a&&a.toString().toLowerCase().includes(s.toLowerCase())));i.useEffect(()=>{localStorage.setItem("filterText",s)},[s]);const C=()=>{f(""),localStorage.removeItem("filterText")},j=e=>{u("/admin/user/edit",{state:{users:e}})},m=(e,a,o)=>{if(window.confirm("คุณต้องการอนุมัติผู้ใช้ หรือไม่?")){const $={approver_id:r.user_id,is_approved_user:a==="Y"};try{L($,e).then(()=>{v.success("อนุมัติสำเร็จ!",{autoClose:3e3}),J(o,r,a),d()})}catch(y){v.error(`อนุมัติไม่สำเร็จ: ${y}`,{autoClose:3e3})}}},S=e=>{if(window.confirm(`คุณต้องการลบข้อมูลผู้ใช้หมายเลข ${e} หรือไม่?`))try{R(e).then(()=>{d()})}catch(o){alert("ลบข้อมูลไม่สำเร็จ:",o)}};return t.jsx("div",{className:"",children:t.jsxs(_,{children:[t.jsx(_.Header,{children:t.jsx("h5",{children:"ข้อมูลรายการข้อมูลผู้ใช้งาน"})}),t.jsxs(_.Body,{className:"p-10",children:[t.jsxs(P,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(O.Control,{type:"text",placeholder:"Search",value:s,onChange:e=>f(e.target.value)}),t.jsx(h,{variant:"primary",size:"sm",color:"secondary",onClick:C,disabled:!s,children:t.jsx(k,{style:{fontSize:20}})}),t.jsxs(h,{variant:"success",size:"sm",onClick:()=>u("/admin/user/add"),children:[t.jsx("i",{className:"feather icon-plus-circle"}),"เพิ่ม"]})]}),t.jsx(H,{rows:n,columns:x,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{ne as default};
