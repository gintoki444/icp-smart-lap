import{u as k,a as P,r as u,j as s,I as A,b as C,C as x,R as E,B as F,s as R,y as c,g as L,c as B,l as T,N as p}from"./index-6YeC_AS5.js";import{F as q,c as O,a as g}from"./formik.esm-C0GtiMNK.js";import{F as r}from"./Form-CGCyrcfL.js";import{A as U}from"./Alert-D32VqIXN.js";import{C as j}from"./Card-BhOVTKNa.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";const V=()=>{const m=k(),b=P(),[d,f]=u.useState(!1),[h,w]=u.useState(!!localStorage.getItem("authToken"));u.useEffect(()=>{const a=localStorage.getItem("authToken"),t=localStorage.getItem("userRole");a&&t&&h&&m(t==="user"?"/dashboard":"/admin/dashboard",{replace:!0})},[h,m]);const N={email:"",password:"",submit:null},v=()=>O().shape({email:g().email("Must be a valid email").max(255).required("Email is required"),password:g().max(255).required("Password is required")}),y=async(a,{setErrors:t,setSubmitting:o})=>{var i,n;o(!0);try{const e=await R(a);if(e&&e.token){localStorage.setItem("authToken",e.token),localStorage.setItem("userRole",e.user.role),e.user.position&&localStorage.setItem("userPosition",e.user.position),await I(e.user.role_id),w(!0);const l=e.user.role,S=((n=(i=b.state)==null?void 0:i.from)==null?void 0:n.pathname)||(l==="user"?"/dashboard":"/admin/dashboard");m(S,{replace:!0}),c.success("Login successful")}else console.warn("ðŸ”´ Login failed:",e.message),t({submit:e.message||"Login failed"}),c.error(e.message||"Login failed")}catch(e){console.error("ðŸ”´ Error logging in:",e),t({submit:e.message||"An error occurred. Please try again."}),c.error(e.message||"An error occurred. Please try again.")}finally{o(!1)}},I=async a=>{try{const t=await L(a);localStorage.setItem("permissions",JSON.stringify(t||[]))}catch(t){console.error("Error fetching permissions:",t),c.error("Failed to fetch permissions")}};return s.jsx(q,{initialValues:N,validationSchema:v(),onSubmit:y,children:({errors:a,handleBlur:t,handleChange:o,handleSubmit:i,isSubmitting:n,touched:e,values:l})=>s.jsxs(r,{noValidate:!0,onSubmit:i,children:[s.jsxs(r.Group,{className:"mb-3 text-start",controlId:"email",children:[s.jsx(r.Control,{placeholder:"Email Address / Username",name:"email",onBlur:t,onChange:o,type:"email",value:l.email,isInvalid:e.email&&!!a.email}),s.jsx(r.Control.Feedback,{type:"invalid",children:a.email})]}),s.jsxs(r.Group,{className:"mb-4 text-start position-relative",controlId:"password",children:[s.jsx(r.Control,{placeholder:"Password",name:"password",onBlur:t,onChange:o,type:d?"text":"password",value:l.password,isInvalid:e.password&&!!a.password}),s.jsx("span",{className:"position-absolute",style:{right:a.password?30:"10px",top:a.password?"30%":"50%",transform:"translateY(-50%)",cursor:"pointer"},onClick:()=>f(!d),children:d?s.jsx(A,{size:20}):s.jsx(C,{size:20})}),s.jsx(r.Control.Feedback,{type:"invalid",children:a.password})]}),a.submit&&s.jsx(x,{sm:12,children:s.jsx(U,{variant:"danger",children:a.submit})}),s.jsx(E,{children:s.jsx(x,{mt:2,children:s.jsx(F,{className:"btn-block mb-4",variant:"primary",disabled:n,type:"submit",children:"Sign In"})})})]})})},_=()=>s.jsx(B.Fragment,{children:s.jsx("div",{className:"auth-wrapper",children:s.jsxs("div",{className:"auth-content",children:[s.jsxs("div",{className:"auth-bg",children:[s.jsx("span",{className:"r"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r"})]}),s.jsx(j,{className:"borderless text-center",children:s.jsxs(j.Body,{children:[s.jsx("div",{className:"mb-0",children:s.jsx("img",{className:"img-fluid",src:T,alt:"logo",width:120})}),s.jsx(V,{}),s.jsxs("p",{className:"mb-1 text-muted",children:["Forgot password?"," ",s.jsx(p,{to:"/auth/reset-password#",className:"f-w-400",children:"Reset"})]}),s.jsxs("p",{className:"mb-1 text-muted",children:["Activate E-mail?"," ",s.jsx(p,{to:"/auth/activate-token",className:"f-w-400",children:"Activate"})]}),s.jsxs("p",{className:"mb-1 text-muted",children:["Donâ€™t have an account?"," ",s.jsx(p,{to:"/auth/signup-1",className:"f-w-400",children:"Sign Up"})]})]})})]})})});export{_ as default};
