import{r,u as S,h as j,j as e,R as y,C as q,B as d,i as C}from"./index-CMKGjvil.js";import{g as N}from"./serviceRequest-CJ15hpJs.js";import{C as o}from"./Card-ltuRbL1m.js";import{S as R}from"./Stack-_RiFjssk.js";import{F as k}from"./Form-XAT3KesX.js";import{B as b}from"./Badge-Degbu7BZ.js";import{D as B,B as T}from"./DataGrid-BSrFaLwh.js";import"./DefaultPropsProvider-7CXMMYWk.js";import"./emotion-element-f0de968e.browser.esm-D2ySOhvj.js";import"./TextField-l4tn0KBj.js";import"./toPropertyKey-BZFHAmHd.js";import"./Transition-CvY6YelV.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-Rbts8ePN.js";const M=()=>{const[F,m]=r.useState([]),[c,u]=r.useState([]),[i,n]=r.useState(()=>localStorage.getItem("filterText")||""),[l,_]=r.useState(c),h=S();r.useEffect(()=>{const t=localStorage.getItem("authToken");t&&j(t).then(a=>{m(a.user),f(a.user.user_id)})},[]),r.useEffect(()=>{},[l]);const f=()=>{N().then(t=>{if(t){const a=t.map((s,w)=>({id:s.request_id,No:w+1,request_date:new Date(s.request_date).toLocaleString(),request_no:s.request_no||"-",user_id:s.user_id,user_name:s.user_name,customer_id:s.customer_id,customer_name:s.customer_name,sample_type_name:s.sample_type_name,is_registration_analysis:s.is_registration_analysis,is_quality_check_analysis:s.is_quality_check_analysis,sample_type_id:s.sample_type_id,notes:s.notes||"-",created_at:new Date(s.created_at).toLocaleString(),status:s.status,sample_submissions:s.sample_submissions,service_request_documents:s.service_request_documents}));u(a),_(a)}})},p=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"customer_name",headerName:"บริษัท",flex:1},{field:"user_name",headerName:"ผู้ขอรับบริการ",flex:1},{field:"request_no",headerName:"เลขที่คำขอ",flex:.8},{field:"sample_type_name",headerName:"ประเภทคำขอ",flex:.7},{field:"request_date",headerName:"วันที่สร้าง",flex:1},{field:"notes",headerName:"โน้ต",flex:1.2},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:t=>e.jsx(b,{pill:!0,style:{},bg:t.row.status==="pending"?"warning":t.row.status==="rejected"?"danger":"success",children:t.row.status==="pending"?"รออนุมัติ":t.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:t=>e.jsx(T,{children:e.jsx(d,{variant:"primary",size:"sm",onClick:()=>{h("/admin/sample-receiving/add",{state:{id:t.row.id}})},children:e.jsx("i",{className:"feather icon-file-text m-0"})})})}],g=l.filter(t=>Object.values(t).some(a=>a&&a.toString().toLowerCase().includes(i.toLowerCase())));r.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const x=()=>{n(""),localStorage.removeItem("filterText")};return e.jsx(e.Fragment,{children:e.jsxs(o,{children:[e.jsx(o.Header,{children:e.jsx(y,{children:e.jsx(q,{children:e.jsx(o.Title,{as:"h5",children:"รายการคำขอรับบริการ"})})})}),e.jsxs(o.Body,{children:[e.jsxs(R,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(k.Control,{type:"text",placeholder:"Search",value:i,onChange:t=>n(t.target.value)}),e.jsx(d,{variant:"primary",size:"sm",color:"secondary",onClick:x,disabled:!i,children:e.jsx(C,{style:{fontSize:20}})})]}),e.jsx(B,{rows:g,columns:p,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{M as default};
