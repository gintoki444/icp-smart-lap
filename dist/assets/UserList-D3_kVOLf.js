import{r as a,u as k,h as y,A as D,j as t,B as o,i as E,D as B,k as F,F as z,v as R,E as U,y as f,H as I}from"./index-CMKGjvil.js";import{C as d}from"./Card-ltuRbL1m.js";import{S as T}from"./Stack-_RiFjssk.js";import{F as b}from"./Form-XAT3KesX.js";import{B as L}from"./Badge-Degbu7BZ.js";import{D as O,B as $}from"./DataGrid-BSrFaLwh.js";import"./DefaultPropsProvider-7CXMMYWk.js";import"./emotion-element-f0de968e.browser.esm-D2ySOhvj.js";import"./TextField-l4tn0KBj.js";import"./toPropertyKey-BZFHAmHd.js";import"./Transition-CvY6YelV.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-Rbts8ePN.js";const ee=()=>{const[u,p]=a.useState([]),[g,x]=a.useState([]),[i,c]=a.useState(()=>localStorage.getItem("filterText")||""),[m,w]=a.useState(g),h=k();a.useEffect(()=>{const e=localStorage.getItem("authToken");e&&y(e).then(s=>{p(s.user)}),n()},[]),a.useEffect(()=>{},[m]);const n=()=>{D().then(e=>{if(e){const s=e.map((r,l)=>({id:r.user_id,No:l+1,first_name:r.first_name,last_name:r.last_name,fullName:`${r.first_name} ${r.last_name}`,email:r.email,phone:r.phone,role_id:r.role_id,role_name:r.role_name,dept_id:r.dept_id,dept_name:r.dept_name,createdAt:new Date(r.created_at).toLocaleString(),status:r.status}));x(s),w(s)}})},j=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"fullName",headerName:"ชื่อ-นามสกุล",flex:1},{field:"email",headerName:"E-mail",flex:1},{field:"phone",headerName:"เบอร์โทรศัพท์",flex:1},{field:"role_name",headerName:"Roles",width:120,headerAlign:"center",align:"center"},{field:"createdAt",headerName:"วันที่สร้าง",flex:1},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:e=>t.jsx(L,{pill:!0,style:{},bg:e.row.status==="pending"?"warning":e.row.status==="rejected"?"danger":"success",children:e.row.status==="pending"?"รออนุมัติ":e.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:e=>t.jsxs($,{children:[t.jsx(o,{variant:e.row.status==="pending"||e.row.status==="rejected"?"outline-success":"outline-warning",size:"sm",onClick:()=>N(e.row.id,e.row.status==="pending"||e.row.status==="rejected"?"Y":"N"),children:e.row.status==="pending"||e.row.status==="rejected"?t.jsx(B,{}):t.jsx(F,{})}),t.jsx(o,{variant:"info",size:"sm",onClick:()=>v(e.row),children:t.jsx(z,{})}),t.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>S(e.row.id),children:t.jsx(R,{})})]})}],_=m.filter(e=>Object.values(e).some(s=>s&&s.toString().toLowerCase().includes(i.toLowerCase())));a.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const C=()=>{c(""),localStorage.removeItem("filterText")},v=e=>{h("/admin/user/edit",{state:{users:e}})},N=(e,s)=>{if(window.confirm("คุณต้องการอนุมัติผู้ใช้ หรือไม่?")){const l={approver_id:u.user_id,is_approved_user:s==="Y"};try{U(l,e).then(()=>{f.success("อนุมัติสำเร็จ!",{autoClose:3e3}),n()})}catch(A){f.error(`อนุมัติไม่สำเร็จ: ${A}`,{autoClose:3e3})}}},S=e=>{if(window.confirm(`คุณต้องการลบข้อมูลผู้ใช้หมายเลข ${e} หรือไม่?`))try{I(e).then(()=>{n()})}catch(r){alert("ลบข้อมูลไม่สำเร็จ:",r)}};return t.jsx("div",{className:"",children:t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsx("h5",{children:"ข้อมูลรายการข้อมูลผู้ใช้งาน"})}),t.jsxs(d.Body,{className:"p-10",children:[t.jsxs(T,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(b.Control,{type:"text",placeholder:"Search",value:i,onChange:e=>c(e.target.value)}),t.jsx(o,{variant:"primary",size:"sm",color:"secondary",onClick:C,disabled:!i,children:t.jsx(E,{style:{fontSize:20}})}),t.jsxs(o,{variant:"success",size:"sm",onClick:()=>h("/admin/user/add"),children:[t.jsx("i",{className:"feather icon-plus-circle"}),"เพิ่ม"]})]}),t.jsx(O,{rows:_,columns:j,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{ee as default};
