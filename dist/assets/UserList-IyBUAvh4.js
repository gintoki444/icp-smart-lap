import{r as a,d as k,q as y,E,j as t,F as B,B as o,I as D,H as R,J as z,p as F,K as I,y as h,M as U}from"./index-Dtqx7INH.js";import{R as T}from"./index-CGFydlFf.js";import{C as d}from"./Card-Bkd81iOt.js";import{S as b}from"./Stack-zE8jHDBo.js";import{B as L}from"./Badge-BWqEdNOE.js";import{B as O}from"./ButtonGroup-BNqkzXuK.js";import{D as $}from"./DataGrid-BczdgceL.js";import"./memoTheme-Doo5A3zk.js";import"./TextField-CWSlrGbD.js";import"./Transition-Bp0H6M_d.js";import"./Divider-CXGzUZDp.js";const X=()=>{const[u,p]=a.useState([]),[g,x]=a.useState([]),[i,c]=a.useState(()=>localStorage.getItem("filterText")||""),[m,w]=a.useState(g),f=k();a.useEffect(()=>{const e=localStorage.getItem("authToken");e&&y(e).then(s=>{p(s.user)}),n()},[]),a.useEffect(()=>{},[m]);const n=()=>{E().then(e=>{if(e){const s=e.map((r,l)=>({id:r.user_id,No:l+1,first_name:r.first_name,last_name:r.last_name,fullName:`${r.first_name} ${r.last_name}`,email:r.email,phone:r.phone,role_id:r.role_id,role_name:r.role_name,dept_id:r.dept_id,dept_name:r.dept_name,createdAt:new Date(r.created_at).toLocaleString(),status:r.status}));x(s),w(s)}})},j=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"fullName",headerName:"ชื่อ-นามสกุล",flex:1},{field:"email",headerName:"E-mail",flex:1},{field:"phone",headerName:"เบอร์โทรศัพท์",flex:1},{field:"role_name",headerName:"Roles",width:120,headerAlign:"center",align:"center"},{field:"createdAt",headerName:"วันที่สร้าง",flex:1},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:e=>t.jsx(L,{pill:!0,style:{},bg:e.row.status==="pending"?"warning":e.row.status==="rejected"?"danger":"success",children:e.row.status==="pending"?"รออนุมัติ":e.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:e=>t.jsxs(O,{children:[t.jsx(o,{variant:e.row.status==="pending"||e.row.status==="rejected"?"outline-success":"outline-warning",size:"sm",onClick:()=>v(e.row.id,e.row.status==="pending"||e.row.status==="rejected"?"Y":"N"),children:e.row.status==="pending"||e.row.status==="rejected"?t.jsx(R,{}):t.jsx(z,{})}),t.jsx(o,{variant:"info",size:"sm",onClick:()=>N(e.row),children:t.jsx(F,{})}),t.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>S(e.row.id),children:t.jsx(T,{})})]})}],_=m.filter(e=>Object.values(e).some(s=>s&&s.toString().toLowerCase().includes(i.toLowerCase())));a.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const C=()=>{c(""),localStorage.removeItem("filterText")},N=e=>{f("/admin/user/edit",{state:{users:e}})},v=(e,s)=>{if(window.confirm("คุณต้องการอนุมัติผู้ใช้ หรือไม่?")){const l={approver_id:u.user_id,is_approved_user:s==="Y"};try{I(l,e).then(()=>{h.success("อนุมัติสำเร็จ!",{autoClose:3e3}),n()})}catch(A){h.error(`อนุมัติไม่สำเร็จ: ${A}`,{autoClose:3e3})}}},S=e=>{if(window.confirm(`คุณต้องการลบข้อมูลผู้ใช้หมายเลข ${e} หรือไม่?`))try{U(e).then(()=>{n()})}catch(r){alert("ลบข้อมูลไม่สำเร็จ:",r)}};return t.jsx("div",{className:"",children:t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsx("h5",{children:"ข้อมูลรายการตัวอย่าง"})}),t.jsxs(d.Body,{className:"p-10",children:[t.jsxs(b,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(B.Control,{type:"text",placeholder:"Search",value:i,onChange:e=>c(e.target.value)}),t.jsx(o,{variant:"primary",size:"sm",color:"secondary",onClick:C,disabled:!i,children:t.jsx(D,{style:{fontSize:20}})}),t.jsxs(o,{variant:"success",size:"sm",onClick:()=>f("/admin/user/add"),children:[t.jsx("i",{className:"feather icon-plus-circle"}),"เพิ่ม"]})]}),t.jsx($,{rows:_,columns:j,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{X as default};
