import{r as o,j as e,B as C,R as U,C as c,F as ce,m as me,y as V,u as oe,a as ue,n as he}from"./index-CMKGjvil.js";import{a as Q,p as xe,d as _e}from"./serviceRequest-CJ15hpJs.js";import{M as S}from"./Modal-KDP3gSJa.js";import{A as Y}from"./Alert-CaEs9ZRl.js";import{F as d}from"./Form-XAT3KesX.js";import{T as de}from"./Table-Co_68gz0.js";import{g as pe}from"./packageingTypeRequest-CUTcv2jf.js";import{g as ge}from"./fertilizerTypesRequest-CzftO6V-.js";import{A as je,a as be,E as fe,b as Ne}from"./ExpandMore-CBhrzDGN.js";import{c as W,d as X,a as J,F as Z}from"./formik.esm-PXS3-tw9.js";import{h as ee}from"./uploadFileRequest-j7nqPy1R.js";import{d as ke,p as ye,a as Se,S as se,b as te,c as ae,e as ve}from"./trackingRequest-nQukaRQe.js";import{F as re,I as ie}from"./FirebaseImage-D-uA0S8P.js";import{B as K}from"./Badge-Degbu7BZ.js";import{B as we,D as Ce}from"./DataGrid-BSrFaLwh.js";import{g as Te}from"./fertilizerMainRequest-kGbpd_0A.js";import{a as Fe}from"./customerRequest-D-QXhSQD.js";import{g as De}from"./specialConditionsRequest-B-G5iiQh.js";import{C as ne}from"./CountrySelect-5rKmeoAR.js";import{C as L}from"./Card-ltuRbL1m.js";import"./firebaseConfig-pMHECxRz.js";import"./CloseButton-DXA2z1Sn.js";import"./Transition-CvY6YelV.js";import"./setPrototypeOf-DgZC2w_0.js";import"./DefaultPropsProvider-7CXMMYWk.js";import"./emotion-element-f0de968e.browser.esm-D2ySOhvj.js";import"./TextField-l4tn0KBj.js";import"./toPropertyKey-BZFHAmHd.js";import"./Divider-Rbts8ePN.js";import"./react-select.esm-Df4SyQAq.js";const qe=({service:m})=>{const[A,p]=o.useState(!1),[j,E]=o.useState(""),[v,N]=o.useState([]);console.log("service :",m);const F=t=>{const n=t.target.value;E(n),N([])},[k,D]=o.useState([]),[f,H]=o.useState(0),P=()=>{const t=k.reduce((s,r)=>s+r.price*r.quantity,0),n=t*(f/100),l=t-n,_=l*.07,y=l+_;return{totalAmount:t,discountAmount:n,netTotal:l,vatAmount:_,grandTotal:y}},{totalAmount:$,discountAmount:w,netTotal:z,vatAmount:B,grandTotal:R}=P(),I=t=>{console.log("item:",t),console.log("item:",k);const n=k.find(_=>_.test_item_id===t.test_item_id);let l;n?l=k.filter(_=>_.test_item_id!==t.test_item_id):l=[...k,{...t}],console.log(l),D(l)},q=t=>{N(n=>n.includes(t)?n.filter(l=>l!==t):[...n,t])},a=m!=null&&m.sample_submissions&&Array.isArray(m.sample_submissions)?m.sample_submissions.find(t=>t.submission_id===parseInt(j)):null,i=t=>{var l;return(l=m.test_items_for_quotation.find(_=>_.test_item_id===t))==null?void 0:l.name_for_quotation},h=()=>{if(!a||v.length===0){alert("กรุณาเลือก Sample Submission และอย่างน้อยหนึ่งรายการทดสอบ");return}let t=[];const n=new Date;n.setDate(n.getDate()+30),m.customer_id,m.request_id,n.toISOString().split("T")[0],parseFloat($.toFixed(2)),parseFloat(f.toFixed(2)),parseFloat(w.toFixed(2)),parseFloat(z.toFixed(2)),parseFloat(B.toFixed(2)),parseFloat(R.toFixed(2)),createdBy,quotationTypeId;const l={submission_id:j,status:"pending_test",notes:"รอทดสอบบางรายการ"};t.push({...l,id:t.length+1}),console.log("newSampleStatus:",t),console.log("selectedItems:",k),console.log("Selected Submission:",a),console.log("Selected Details:",v),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"success",onClick:()=>p(!0),disabled:!m||!m.sample_submissions,children:"เลือกรายการทดสอบ"}),e.jsxs(S,{show:A,onHide:()=>{p(!1),N([])},size:"lg",centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx("h5",{className:"mb-0",children:"เลือกทดสอบบางรายการ"})}),e.jsx(S.Body,{children:!m||!m.sample_submissions||!Array.isArray(m.sample_submissions)?e.jsx(Y,{variant:"warning",children:"ไม่มีข้อมูล Sample Submissions ให้เลือก"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mb-3",children:e.jsx(c,{children:e.jsxs(d.Group,{controlId:"submissionSelect",children:[e.jsx(d.Label,{className:"text-dark",children:"เลือกตัวอย่างปุ๋ย"}),e.jsxs(d.Select,{value:j,onChange:F,children:[e.jsx("option",{children:"เลือกตัวอย่างปุ๋ย"}),m.sample_submissions.map(t=>e.jsxs("option",{value:t.submission_id,children:[t.common_name," (",t.fertilizer_formula,")"]},t.submission_id))]})]})})}),j&&!a?e.jsx(Y,{variant:"danger",children:"ไม่พบข้อมูล Sample Submission ที่เลือก"}):a&&e.jsx(U,{className:"mb-3",children:e.jsxs(c,{children:[e.jsx(d.Label,{className:"text-dark",children:"รายการทดสอบ"}),e.jsxs(de,{bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"50px"},className:"text-center",children:"เลือก"}),e.jsx("th",{className:"text-center",children:"Code"}),e.jsx("th",{children:"ชื่อการทดสอบ"}),e.jsx("th",{className:"text-center",children:"เปอเซ็นต์"})]})}),e.jsx("tbody",{children:a.sample_submission_details&&Array.isArray(a.sample_submission_details)?a.sample_submission_details.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:e.jsx(d.Check,{type:"checkbox",checked:v.includes(t.detail_id),onChange:()=>{q(t.detail_id),I(m.test_items_for_quotation.find(n=>n.test_item_id===t.test_item_id))}})}),e.jsx("td",{className:"text-center",children:t.test_code}),e.jsx("td",{children:i(t.test_item_id)}),e.jsx("td",{className:"text-center",children:t.test_percentage?t.test_percentage+"  %":"-"})]},t.detail_id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"ไม่มีรายการทดสอบ"})})})]})]})})]})}),e.jsxs(S.Footer,{children:[e.jsx(C,{variant:"success",onClick:h,disabled:!j||v.length===0,children:"บันทึก"}),e.jsx(C,{variant:"secondary",onClick:()=>{p(!1),N([])},children:"ยกเลิก"})]})]})]})},Ae=({submissionId:m,handleTracking:A,serviceRequestId:p,sampleSubmissions:j})=>{const[E,v]=o.useState(!1),[N,F]=o.useState(!1),[k,D]=o.useState([]),[f,H]=o.useState(null);o.useEffect(()=>{var a,i;if(j&&j.length>0){const h=((i=(a=j.find(t=>t.submission_id===m))==null?void 0:a.sample_tracking)==null?void 0:i.map(t=>({tracking_id:t.tracking_id,carrier_name:t.carrier_name,tracking_number:t.tracking_number,proof_image:t.proof_image,status:t.status})))||[];D(h)}},[m,j]);const P=W({carrier_name:J().required("กรุณาเลือกผู้ให้บริการจัดส่ง"),tracking_number:J().required("กรุณากรอกหมายเลข Tracking"),proof_image:X().required("กรุณาอัปโหลดหลักฐานการส่ง")}),$=W({carrier_name:J().required("กรุณาเลือกผู้ให้บริการจัดส่ง"),tracking_number:J().required("กรุณากรอกหมายเลข Tracking"),proof_image:X().nullable()}),w={carrier_name:"",tracking_number:"",proof_image:null,status:"received"},z=async(a,{setSubmitting:i,resetForm:h,setErrors:t})=>{try{const l=(await ee([a.proof_image],"proof_images","proof_"))[0].fileName,_={submission_id:m,tracking_number:a.tracking_number,carrier_name:a.carrier_name,status:a.status,proof_image:l},y=await ye(_);D(s=>[...s,{tracking_id:y.tracking_id||Date.now(),carrier_name:a.carrier_name,tracking_number:a.tracking_number,proof_image:l,status:"received"}]),await q(),A(!0),v(!1),h()}catch(n){console.error("Error saving tracking data:",n),t({submit:"เกิดข้อผิดพลาดในการบันทึกข้อมูล กรุณาลองใหม่"}),i(!1)}},B=async(a,{setSubmitting:i,setErrors:h})=>{try{let t=f.proof_image;a.proof_image&&(t=(await ee([a.proof_image],"proof_images","proof_"))[0].fileName);const n={submission_id:m,tracking_number:a.tracking_number,carrier_name:a.carrier_name,status:a.status||f.status,proof_image:t};await Se(f.tracking_id,n),D(l=>l.map(_=>_.tracking_id===f.tracking_id?{..._,...n}:_)),A(!0),F(!1)}catch(t){console.error("Error updating tracking data:",t),h({submit:"เกิดข้อผิดพลาดในการแก้ไขข้อมูล กรุณาลองใหม่"}),i(!1)}},R=a=>{const i=k.find(h=>h.tracking_id===a);H(i),F(!0)},I=async a=>{if(window.confirm("คุณต้องการลบข้อมูลการจัดส่งตัวอย่าง หรือไม่?"))try{await ke(a),V.success("ลบข้อมูลการจัดส่งตัวอย่างสำเร็จ!",{autoClose:3e3}),D(h=>h.filter(t=>t.tracking_id!==a)),await q(),A(!0)}catch{V.error("ลบข้อมูลการจัดส่งตัวอย่างไม่สำเร็จ!",{autoClose:3e3})}},q=async()=>{const a=await Q(p),i=a.sample_submissions,t=i.reduce((l,_)=>{const y=_.sample_tracking||[];return l+(y.some(s=>s.submission_id===_.submission_id&&s.status==="received")?1:0)},0)===i.length,n=a.service_status_logs||{};t&&n.sample_sent===null?await xe(p,{newStatusTracking:"sample_sent"}):!t&&n.sample_sent!==null&&await _e(p,{StatusTracking:"sample_sent"})};return e.jsxs(e.Fragment,{children:[e.jsx("h6",{className:"mb-3 mt-3",children:"ข้อมูลการจัดส่งตัวอย่าง"}),e.jsxs(de,{striped:!0,bordered:!0,hover:!0,className:"mt-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{width:80,className:"text-center",children:"#"}),e.jsx("th",{children:"ผู้ให้บริการจัดส่ง"}),e.jsx("th",{children:"หมายเลข Tracking"}),e.jsx("th",{className:"text-center",width:180,children:"สถานะ"}),e.jsx("th",{className:"text-center",children:"หลักฐานการส่ง"}),e.jsx("th",{className:"text-center",children:"Action"})]})}),e.jsx("tbody",{children:k.map((a,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:i+1}),e.jsx("td",{children:a.carrier_name}),e.jsx("td",{children:a.tracking_number}),e.jsx("td",{className:"text-center",children:e.jsx(K,{bg:a.status==="received"?"secondary":a.status==="in_processing"?"warning":a.status==="completed"?"primary":"success",children:a.status==="received"?"ดำเนินการจัดส่ง":a.status==="in_processing"?"กำลังตรวจสอบ/ทดสอบ":a.status==="completed"?"ทดสอบเสร็จสิ้น":"จัดส่งสำเร็จ"})}),e.jsx("td",{className:"text-center",children:e.jsx(re,{imagePath:a.proof_image,alt:`Proof for ${a.tracking_number}`,style:{maxHeight:"100px"},thumbnail:!0})}),e.jsx("td",{className:"text-center",children:e.jsxs(we,{children:[e.jsx(C,{variant:"info",size:"sm",disabled:a.status!=="received",onClick:()=>R(a.tracking_id),children:e.jsx(ce,{})}),e.jsx(C,{variant:"danger",size:"sm",disabled:a.status!=="received",onClick:()=>I(a.tracking_id),children:e.jsx(me,{})})]})})]},`${a.tracking_number}-${i}`))})]}),e.jsx(C,{variant:"primary",onClick:()=>v(!0),children:"เพิ่มข้อมูลการจัดส่ง"}),e.jsxs(S,{show:E,onHide:()=>v(!1),centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:e.jsx("h5",{children:"รายละเอียดการจัดส่งตัวอย่าง"})})}),e.jsx(Z,{initialValues:w,validationSchema:P,onSubmit:z,children:({values:a,errors:i,touched:h,handleChange:t,handleBlur:n,handleSubmit:l,setFieldValue:_,isSubmitting:y})=>e.jsxs(d,{onSubmit:l,children:[e.jsxs(S.Body,{children:[i.submit&&e.jsx("div",{className:"text-danger mb-3",children:i.submit}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"ผู้ให้บริการจัดส่ง"}),e.jsxs(d.Select,{name:"carrier_name",value:a.carrier_name,onChange:t,onBlur:n,isInvalid:h.carrier_name&&!!i.carrier_name,children:[e.jsx("option",{value:"",children:"เลือกผู้ให้บริการจัดส่ง"}),e.jsx("option",{value:"ไปรษณีย์ไทย",children:"ไปรษณีย์ไทย"}),e.jsx("option",{value:"Kerry Express",children:"Kerry Express"}),e.jsx("option",{value:"J&T Express",children:"J&T Express"}),e.jsx("option",{value:"DHL",children:"DHL"})]}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.carrier_name})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หมายเลข Tracking"}),e.jsx(d.Control,{type:"text",name:"tracking_number",placeholder:"กรอกหมายเลข Tracking",value:a.tracking_number,onChange:t,onBlur:n,isInvalid:h.tracking_number&&!!i.tracking_number}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.tracking_number})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หลักฐานการส่ง"}),e.jsx(d.Control,{type:"file",accept:"image/*",onChange:s=>_("proof_image",s.target.files[0]),isInvalid:h.proof_image&&!!i.proof_image}),a.proof_image&&e.jsx("div",{className:"mt-3",children:e.jsx(ie,{src:URL.createObjectURL(a.proof_image),alt:"Proof",thumbnail:!0,style:{maxHeight:"200px"}})}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.proof_image})]})]}),e.jsxs(S.Footer,{children:[e.jsx(C,{variant:"success",type:"submit",disabled:y,children:"บันทึก"}),e.jsx(C,{variant:"secondary",onClick:()=>v(!1),disabled:y,children:"ยกเลิก"})]})]})})]}),f&&e.jsxs(S,{show:N,onHide:()=>F(!1),centered:!0,children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:e.jsx("h5",{children:"แก้ไขรายละเอียดการจัดส่งตัวอย่าง"})})}),e.jsx(Z,{initialValues:{carrier_name:f.carrier_name,tracking_number:f.tracking_number,proof_image:null,status:f.status},validationSchema:$,onSubmit:B,children:({values:a,errors:i,touched:h,handleChange:t,handleBlur:n,handleSubmit:l,setFieldValue:_,isSubmitting:y})=>e.jsxs(d,{onSubmit:l,children:[e.jsxs(S.Body,{children:[i.submit&&e.jsx("div",{className:"text-danger mb-3",children:i.submit}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"ผู้ให้บริการจัดส่ง"}),e.jsxs(d.Select,{name:"carrier_name",value:a.carrier_name,onChange:t,onBlur:n,isInvalid:h.carrier_name&&!!i.carrier_name,children:[e.jsx("option",{value:"",children:"เลือกผู้ให้บริการจัดส่ง"}),e.jsx("option",{value:"ไปรษณีย์ไทย",children:"ไปรษณีย์ไทย"}),e.jsx("option",{value:"Kerry Express",children:"Kerry Express"}),e.jsx("option",{value:"J&T Express",children:"J&T Express"}),e.jsx("option",{value:"DHL",children:"DHL"})]}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.carrier_name})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หมายเลข Tracking"}),e.jsx(d.Control,{type:"text",name:"tracking_number",placeholder:"กรอกหมายเลข Tracking",value:a.tracking_number,onChange:t,onBlur:n,isInvalid:h.tracking_number&&!!i.tracking_number}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.tracking_number})]}),e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"หลักฐานการส่ง (ถ้าต้องการเปลี่ยน)"}),e.jsx(d.Control,{type:"file",accept:"image/*",onChange:s=>_("proof_image",s.target.files[0]),isInvalid:h.proof_image&&!!i.proof_image}),e.jsx("div",{className:"mt-3",children:a.proof_image?e.jsx(ie,{src:URL.createObjectURL(a.proof_image),alt:"New Proof",thumbnail:!0,style:{maxHeight:"200px"}}):e.jsx(re,{imagePath:f.proof_image,alt:"Current Proof",style:{maxHeight:"200px"},thumbnail:!0})}),e.jsx(d.Control.Feedback,{type:"invalid",children:i.proof_image})]})]}),e.jsxs(S.Footer,{children:[e.jsx(C,{variant:"success",type:"submit",disabled:y,children:"บันทึกการแก้ไข"}),e.jsx(C,{variant:"secondary",onClick:()=>F(!1),disabled:y,children:"ยกเลิก"})]})]})})]})]})},le=({serviceId:m,handleReload:A})=>{oe();const[p,j]=o.useState({}),[E,v]=o.useState({});o.useEffect(()=>{m&&P(m)},[m]);const[N,F]=o.useState({}),[k,D]=o.useState([]),[f,H]=o.useState([]),P=async s=>{const r=await Q(s);await z(r.customer_id),r.sample_submissions=r.sample_submissions.map(x=>({...x,reportMethod:[x.is_self_pickup?"is_self_pickup":null,x.pdf_email?"pdf_email":null,x.is_mail_delivery?"is_mail_delivery":null].filter(Boolean),sampleDisposal:x.is_lab_dispose_sample?"is_lab_dispose_sample":x.is_collect_within_3_months?"is_collect_within_3_months":"is_return_sample"})),console.log("response.sample_submissions:",r.sample_submissions),D(r.sample_submissions),F(r)},[$,w]=o.useState([]),z=async s=>{try{const r=await Fe(s);console.log("getCustomerByID:",r),await B(s),j(r)}catch(r){console.error(r),j([])}},B=async s=>{try{const r=await De(s);v(Array.isArray(r)?r:[])}catch(r){console.error(r),v([])}};o.useEffect(()=>{i(),R(),a()},[]);const R=async()=>{const s=await pe();w(s)},[I,q]=o.useState([]),a=async()=>{try{const s=await ge();q(s)}catch(s){console.log(s)}},i=async()=>{try{const r=(await Te()).map(x=>({value:x.fertilizer_main_id,label:x.fertilizer_main_name_th}));console.log("formattedOptions",r),H(r)}catch(s){console.error("Error fetching fertilizer formulas:",s),H([])}},h=[{value:"g",label:"กรัม"},{value:"kg",label:"กิโลกรัม"},{value:"oz",label:"ออนซ์"},{value:"ml",label:"มิลลิลิตร"},{value:"L",label:"ลิตร"}],t=[{field:"no",headerName:"#",width:90,headerAlign:"center",align:"center"},{field:"test_code",headerName:"ทดสอบ",flex:1,renderCell:s=>{if(!s||!s.row)return"-";const{test_code:r,test_percentage:x}=s.row;return`${r||""}${x?` (${x})`:""}`.trim()}},{field:"status",headerName:"สถานะ",headerAlign:"center",align:"center",flex:1,renderCell:s=>e.jsx(K,{pill:!0,bg:s.row.status==="pending"?"warning":s.row.status==="rejected"?"danger":"success",children:s.row.status==="pending"?"รออนุมัติ":s.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"test_value",headerName:"ผลที่ได้",flex:1,renderCell:s=>{var r;return((r=s==null?void 0:s.row)==null?void 0:r.test_value)||"-"}},{field:"test_date",headerName:"วันที่ทดสอบ",flex:1,valueGetter:s=>{var r;return((r=s==null?void 0:s.row)==null?void 0:r.created_at)||"-"}}],n=s=>s.map((x,T)=>({id:x.detail_id,no:T+1,...x})),l=[{value:"is_self_pickup",label:"รับด้วยตนเอง"},{value:"pdf_email",label:"ต้องการไฟล์ pdf เพิ่มเติมทาง E-mail"},{value:"is_mail_delivery",label:"ส่งทางไปรษณีย์"}],_=s=>s.map(r=>{var x;return((x=l.find(T=>T.value===r))==null?void 0:x.label)||r}).join(", "),y=[{value:"is_lab_dispose_sample",label:"ให้ห้องปฏิบัติการจำหน่ายตัวอย่าง"},{value:"is_collect_within_3_months",label:"มารับตัวอย่างคืนภายใน 3 เดือน"},{value:"is_return_sample",label:"ให้ห้องปฏิบัติการจัดส่งตัวอย่างคืน"}];return e.jsx("div",{children:e.jsx(L,{style:{borderRadius:10,marginBottom:0},children:e.jsxs(L.Body,{style:{paddingBottom:20,paddingTop:20},children:[e.jsxs(U,{children:[N.request_no&&e.jsx(c,{md:12,children:e.jsxs("h5",{className:"mb-4",children:["เลขที่คำขอบริการ : ",e.jsx("span",{style:{fontSize:18},children:N.request_no})]})}),e.jsx(c,{md:12,children:e.jsx("h6",{className:"mb-3",children:"ข้อมูลผู้ขอขึ้นทะเบียน"})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["รหัสลูกค้า : ",e.jsx("strong",{className:"text-dark",children:p.company_code})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อบริษัท : ",e.jsx("strong",{className:"text-dark",children:p.company_name})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เลขที่ผู้เสียภาษี : ",e.jsx("strong",{className:"text-dark",children:p.tax_id})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ที่อยู่ : ",e.jsx("strong",{className:"text-dark",children:p.company_address})]})}),e.jsx(c,{md:6,children:e.jsxs("p",{className:"mb-0",children:["เงื่อนไขพิเศษ :"," ",e.jsx("strong",{className:"text-dark",children:E.length>0?E.map((s,r)=>`${s.description}${r<E.length-1?", ":""}`):"-"})]})}),N.sample_type_id===1&&e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วัตถุประสงค์การขอรับบริการ :"," ",e.jsx("strong",{className:"text-dark",children:N.is_quality_check_analysis===1?"วิเคราะห์เพื่อตรวจสอบคุณภาพ":"วิเคราะห์ขึ้นทะเบียน"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทคำขอ : ",e.jsx("strong",{className:"text-dark",children:N.sample_type_name})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["คำขอเพิ่มเติม : ",e.jsx("strong",{className:"text-dark",children:N.notes})]})})]}),e.jsx("h6",{className:"mt-3 mb-2",children:"ข้อมูลตัวอย่างปุ๋ย"}),k.map((s,r)=>{var x,T,G,g,b;return e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs(c,{md:12,className:"ms-2 ps-0 pe-0",style:{border:"1px solid #f8f9fa"},children:[e.jsxs(je,{className:"mb-0",sx:{boxShadow:"none"},children:[e.jsx(be,{expandIcon:e.jsx(fe,{}),"aria-controls":`panel${r}-content`,id:`panel${r}-header`,sx:{backgroundColor:"#f8f9fa",borderRadius:0},children:e.jsxs("p",{className:"mb-0",children:["ตัวอย่างที่ ",r+1," ",s.submission_no&&e.jsxs(e.Fragment,{children:["เลขที่ :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:s.submission_no||"-"})," "]}),s.sample_type_id===2&&e.jsxs(e.Fragment,{children:["สูตรปุ๋ย : ",e.jsx("strong",{className:"text-dark",children:s.fertilizer_formula||"-"})," ( ชื่อสามัญ :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:s.common_name||"-"}),")"," "]}),"สถานะ :",e.jsx(K,{pill:!0,bg:s.verification_status==="No"&&s.is_job_accepted||s.verification_status==="No"&&!s.is_job_accepted||s.verification_status==="Yes"&&!s.is_job_accepted?"warning":s.verification_status==="Yes"&&s.is_job_accepted?"success":"danger",style:{marginLeft:12},children:s.verification_status==="No"&&s.is_job_accepted||s.verification_status==="No"&&!s.is_job_accepted||s.verification_status==="Yes"&&!s.is_job_accepted?"รอการตรวจสอบ":s.verification_status==="Yes"&&s.is_job_accepted?"รับงาน":" ไม่อนุมัติ"})]})}),e.jsx(Ne,{className:"pb-0",children:e.jsxs(U,{children:[s.fertilizer_main_id&&e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทของปุ๋ย :"," ",e.jsx("strong",{className:"text-dark",children:(x=f.find(u=>u.value===s.fertilizer_main_id))==null?void 0:x.label})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ลักษณะปุ๋ย :"," ",e.jsx("strong",{className:"text-dark",children:((T=I.find(u=>u.fertilizer_type_id===s.fertilizer_type_id))==null?void 0:T.fertilizer_type_name)||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สี : ",e.jsx("strong",{className:"text-dark",children:s.color||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อการค้า : ",e.jsx("strong",{className:"text-dark",children:s.trade_name||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เครื่องหมายการค้า : ",e.jsx("strong",{className:"text-dark",children:s.trademark||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ผู้ผลิต (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:s.manufacturer||"-"})," ประเทศ :"," ",e.jsx(ne,{name:"country",label:"ประเทศ",value:s.manufacturer_country||"-",onChange:(u,M)=>console.log(u,M),showText:!0})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สั่งจาก (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:s.supplier||"-"})," ประเทศ :"," ",e.jsx(ne,{name:"country",label:"ประเทศ",value:s.supplier_country||"-",onChange:(u,M)=>console.log(u,M),showText:!0})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วัตถุส่วนประกอบของปุ๋ย : ",e.jsx("strong",{className:"text-dark",children:s.composition||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ปริมาณ : ",e.jsx("strong",{className:"text-dark",children:s.sample_weight||"-"})," ",e.jsx("strong",{className:"text-dark",children:((G=h.find(u=>u.value===s.sample_weight_unit))==null?void 0:G.label)||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ภาชนะบรรจุ :"," ",e.jsx("strong",{className:"text-dark",children:((g=$.find(u=>u.packaging_type_id===s.packaging_id))==null?void 0:g.packaging_type_name)||"-"})]})}),e.jsx(c,{md:12,className:"mb-4",children:e.jsxs(c,{children:["รายการทดสอบ :"," ",e.jsx("div",{style:{width:"100%"},children:e.jsx(Ce,{rows:n(s.sample_submission_details),columns:t,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})})]})}),e.jsxs(c,{md:12,className:"mb-2 ",children:[e.jsxs("p",{className:"mb-1",children:["การรับรายงานผล : ",e.jsx("strong",{className:"text-dark",children:_(s.reportMethod)})]}),s.reportMethod.includes("pdf_email")&&e.jsxs("p",{className:"mb-1",children:["E-mail สำหรับรับผลตรวจ : ",e.jsx("strong",{className:"text-dark",children:s.pdf_email||"-"})]}),s.reportMethod.includes("is_mail_delivery")&&e.jsxs("p",{className:"mb-1",children:["ที่อยู่จัดส่ง : ",e.jsx("strong",{className:"text-dark",children:s.mail_delivery_location||"-"})]})]}),e.jsxs(c,{md:6,className:"mb-1",children:["วิธีการจำหน่ายตัวอย่าง :"," ",e.jsx("strong",{className:"text-dark",children:((b=y.find(u=>u.value===s.sampleDisposal))==null?void 0:b.label)||"-"})]}),e.jsxs(c,{md:12,className:"mb-1",children:["ความต้องการอื่น : ",e.jsx("strong",{className:"text-dark",children:s.other_requirements||"-"})]}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ผู้ส่งตัวอย่าง : ",e.jsx("strong",{className:"text-dark",children:s.submitted_by||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เบอร์โทรศัพท์ผู้ส่ง : ",e.jsx("strong",{className:"text-dark",children:s.phone||"-"})]})}),e.jsx(c,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["วันที่ส่ง : ","",e.jsx("strong",{className:"text-dark",children:new Date(s.submission_date).toLocaleDateString("th-TH")||"-"})]})})]})})]}),e.jsx(c,{style:{padding:"0 16px 16px"},children:e.jsx(c,{children:e.jsx(Ae,{submissionId:s.submission_id,handleTracking:A,trackingData:s.sample_tracking,serviceRequestId:m,sampleSubmissions:k})})})]})},`Accordion-${r}`),r<k.length-1&&e.jsx("hr",{className:"mt-4 mb-2"})]})})})]})})})},Ee=({title:m})=>{var G;const p=((G=ue().state)==null?void 0:G.id)||null;console.log("id",p);const j=oe(),[E,v]=o.useState(2),[N,F]=o.useState(!1),[k,D]=o.useState(!1),[f,H]=o.useState(!1),[P,$]=o.useState(!1),[w,z]=o.useState("horizontal"),[B,R]=o.useState(0),[I,q]=o.useState(!0);o.useEffect(()=>{p?n(p):j("/request/")},[p,j]);const[a,i]=o.useState({}),[h,t]=o.useState([]),n=async g=>{try{q(!0);const b=await Q(g);t(b.sample_submissions||[]),i(b),l(b,{})}catch(b){console.error("Error fetching service request:",b)}finally{q(!1)}},l=(g,b)=>{const u=g.sample_submissions||[],M=g.service_status_logs||{};for(let O=0;O<x.length;O++)if(T(O,u,M))R(O+1);else{R(O);break}};o.useEffect(()=>{const g=()=>{window.innerWidth<=768?z("vertical"):z("horizontal")};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const[_,y]=o.useState(!1);o.useEffect(()=>{},[]);const s=g=>{j("/request/edit/",{state:{id:g}})},r=g=>{g&&n(p)},x=[{label:"การขอรับบริการ",status:"requested"},{label:"ลูกค้าส่งตัวอย่าง",status:"sample_sent"},{label:"ทบทวนคำขอ",status:"request_reviewed"},{label:"ตัวอย่างจัดส่งถึงแล็บ",status:"sample_arrived_lab"},{label:"รับตัวอย่างเข้าระบบ",status:"sample_received"},{label:"รอทดสอบบางรายการ",status:"partial_testing"},{label:"ออกใบเสนอราคา",status:"quotation_issued"},{label:"ขอใบแจ้งหนี้",status:"invoice_requested"},{label:"รับชำระเงิน",status:"payment_received"},{label:"หัก ณ ที่จ่าย",status:"tax_withheld"},{label:"ออกใบเสร็จรับเงิน/ใบกำกับภาษี",status:"receipt_issued"}],T=(g,b,u)=>{const M=b.length;switch(x[g].status,g){case 0:return u.requested!==null;case 1:return M===0?!1:u.sample_sent!==null;case 2:return u.request_reviewed!==null;case 3:return u.sample_arrived_lab!==null;case 4:return u.sample_received!==null;case 5:return u.partial_testing!==null;case 6:return u.quotation_issued!==null;case 7:return u.invoice_requested!==null;case 8:return u.payment_received!==null;case 9:return u.tax_withheld!==null;case 10:return u.receipt_issued!==null;default:return!1}};return e.jsx("div",{children:e.jsxs(L,{children:[e.jsx(L.Header,{children:e.jsx("h5",{children:m})}),e.jsx(L.Body,{children:e.jsx("div",{children:I?e.jsxs("div",{className:"text-center",children:[e.jsx(he,{animation:"border",variant:"primary"}),e.jsx("p",{children:"กำลังโหลดข้อมูล..."})]}):w==="vertical"?e.jsx(se,{activeStep:B,orientation:w,alternativeLabel:w==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:x.map((g,b)=>e.jsxs(te,{completed:T(b,h,a.service_status_logs||{}),children:[e.jsx(ae,{children:g.label}),w==="vertical"&&e.jsx(ve,{children:e.jsx(le,{serviceId:p,handleReload:r})})]},b))}):e.jsxs(e.Fragment,{children:[e.jsx(L,{style:{borderRadius:10,marginBottom:10},children:e.jsx(L.Body,{style:{padding:"8px 20px 3px"},children:e.jsx(se,{activeStep:B,orientation:w,alternativeLabel:w==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:x.map((g,b)=>e.jsx(te,{completed:T(b,h,a.service_status_logs||{}),children:e.jsx(ae,{children:g.label})},b))})})}),e.jsx(le,{serviceId:p,handleReload:r})]})})}),e.jsxs(L.Footer,{className:"text-start",children:[e.jsx(qe,{service:a}),e.jsxs(C,{variant:"primary",onClick:()=>s(p),children:[e.jsx(ce,{style:{marginRight:8}})," แก้ไขข้อมูล"]}),e.jsxs(C,{variant:"danger",onClick:()=>j("/request/"),children:[e.jsx("i",{className:"feather icon-corner-up-left"})," กลับหน้าหลัก"]})]})]})})},ds=()=>e.jsx(Ee,{title:"รายละเอียดข้อมูลนำส่งตัวอย่างปุ๋ย"});export{ds as default};
