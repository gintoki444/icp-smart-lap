import{u as N,a as b,r as l,j as s,c as v,l as y,I as u,b as w,B as C,N as P,f as S}from"./index-6YeC_AS5.js";import{u as B,c as E,a as i,b as F}from"./formik.esm-C0GtiMNK.js";import{C as x}from"./Card-BhOVTKNa.js";import{F as r}from"./Form-CGCyrcfL.js";import{A as T}from"./Alert-D32VqIXN.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";const $=()=>{const f=N(),j=b(),[n,g]=l.useState(!1),[t,k]=l.useState(!1),[c,d]=l.useState(null),m=new URLSearchParams(j.search).get("token")||"";console.log("token from URL:",m);const e=B({initialValues:{token:m,password:"",confirmPassword:""},validationSchema:E({token:i().length(6,"Token ต้องมี 6 ตัวอักษร").required("กรุณากรอก Token"),password:i().min(8,"รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร").matches(/[0-9]/,"รหัสผ่านต้องมีตัวเลขอย่างน้อย 1 ตัว").matches(/[A-Z]/,"รหัสผ่านต้องมีตัวอักษรพิมพ์ใหญ่อย่างน้อย 1 ตัว").matches(/[^A-Za-z0-9]/,"รหัสผ่านต้องมีอักขระพิเศษอย่างน้อย 1 ตัว").required("กรุณากรอกรหัสผ่าน"),confirmPassword:i().oneOf([F("password"),null],"รหัสผ่านไม่ตรงกัน").required("กรุณายืนยันรหัสผ่าน")}),onSubmit:async(p,{setSubmitting:h})=>{h(!0),d(null);try{const a={token:p.token,newPassword:p.password};(await S(a)).message!=="Token ไม่ถูกต้องหรือหมดอายุ"&&(alert("รีเซ็ตรหัสผ่านสำเร็จ! กรุณาเข้าสู่ระบบด้วยรหัสผ่านใหม่"),f("/auth/signin"))}catch(a){let o="เกิดข้อผิดพลาดในการรีเซ็ตรหัสผ่าน";a.message==="Token ไม่ถูกต้องหรือหมดอายุ"?o="Token ไม่ถูกต้องหรือหมดอายุแล้ว กรุณาขอใหม่":a.message==="Token ถูกใช้ไปแล้ว"?o="Token นี้ถูกใช้ไปแล้ว กรุณาขอใหม่":a.message.includes("400")?o="ข้อมูลไม่ถูกต้อง กรุณาตรวจสอบอีกครั้ง":a.message.includes("500")&&(o="เกิดข้อผิดพลาดในระบบ กรุณาลองใหม่ภายหลัง"),d(o)}finally{h(!1)}}});return s.jsx(v.Fragment,{children:s.jsx("div",{className:"auth-wrapper",children:s.jsxs("div",{className:"auth-content",children:[s.jsxs("div",{className:"auth-bg",children:[s.jsx("span",{className:"r"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r"})]}),s.jsx(x,{className:"borderless text-center",children:s.jsxs(x.Body,{children:[s.jsx("div",{className:"mb-4",children:s.jsx("img",{className:"img-fluid",src:y,alt:"logo",width:120})}),s.jsx("h3",{className:"mb-4",children:"New Password"}),s.jsxs(r,{onSubmit:e.handleSubmit,children:[s.jsxs(r.Group,{className:"mb-3",children:[s.jsx(r.Control,{type:"text",placeholder:"Enter Token",name:"token",value:e.values.token,onChange:e.handleChange,onBlur:e.handleBlur,isInvalid:!!e.errors.token&&e.touched.token}),s.jsx(r.Control.Feedback,{type:"invalid",children:e.errors.token})]}),s.jsxs(r.Group,{className:"mb-3 position-relative",children:[s.jsx(r.Control,{type:n?"text":"password",placeholder:"Enter new password",name:"password",value:e.values.password,onChange:e.handleChange,onBlur:e.handleBlur,isInvalid:!!e.errors.password&&e.touched.password}),s.jsx("span",{className:"position-absolute",style:{right:e.errors.password?30:"10px",top:e.errors.password?"30%":"50%",transform:"translateY(-50%)",cursor:"pointer"},onClick:()=>g(!n),children:n?s.jsx(u,{size:20}):s.jsx(w,{size:20})}),s.jsx(r.Control.Feedback,{type:"invalid",children:e.errors.password})]}),s.jsxs(r.Group,{className:"mb-3 position-relative",children:[s.jsx(r.Control,{type:t?"text":"password",placeholder:"Confirm new password",name:"confirmPassword",value:e.values.confirmPassword,onChange:e.handleChange,onBlur:e.handleBlur,isInvalid:!!e.errors.confirmPassword&&e.touched.confirmPassword}),s.jsx("span",{className:"position-absolute",style:{right:e.errors.password?30:"10px",top:e.errors.password?"30%":"50%",transform:"translateY(-50%)",cursor:"pointer"},onClick:()=>k(!t),children:t?s.jsx(u,{size:20}):s.jsx(w,{size:20})}),s.jsx(r.Control.Feedback,{type:"invalid",children:e.errors.confirmPassword})]}),c&&s.jsx(T,{variant:"danger",className:"mb-3",children:c}),s.jsx(C,{variant:"primary",type:"submit",className:"btn-block mb-4",disabled:e.isSubmitting,children:"Reset Password"})]}),s.jsxs("p",{className:"mb-1 text-muted",children:["Remember your password?"," ",s.jsx(P,{to:"/auth/signin",className:"f-w-400",children:"Login"})]})]})})]})})})};export{$ as default};
