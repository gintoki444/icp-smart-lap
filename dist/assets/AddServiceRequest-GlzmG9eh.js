import{G as I,u as V,r as o,j as e,B as x,a as A,h as L,R as T,C as N,y as D}from"./index-Bq0BSIrC.js";import{e as O,f as U}from"./serviceRequest-BNwVWIYi.js";import{b as J,c as K}from"./sampleSubmissionsRequest-CTdJwuzW.js";import{h as P}from"./uploadFileRequest-CHVQkj-t.js";import{c as B,g as H,a,h as E,F as Q}from"./formik.esm-BOpZLvMI.js";import{g as W}from"./fertilizerTypesRequest-CzftO6V-.js";import{S as X}from"./StepForm-BIj5QW8J.js";import{F as Y}from"./Form-C1nYDdO8.js";import{C as p}from"./Card-C7kDYjR9.js";import{a as Z}from"./specialConditionsRequest-Dz72CEse.js";import{M as R}from"./Modal-CjqQnpwU.js";import"./react-select.esm-CGHZA8pU.js";import"./toPropertyKey-KGmwFxs9.js";import"./emotion-element-f0de968e.browser.esm-xSVEHtue.js";import"./setPrototypeOf-DgZC2w_0.js";import"./packageingTypeRequest-CUTcv2jf.js";import"./testItemsRequest-CIY3wZGW.js";import"./fertilizerMainRequest-kGbpd_0A.js";import"./TextField-BqqrABCd.js";import"./DefaultPropsProvider-CMzRgkCO.js";import"./Transition-DABJrq3x.js";import"./tslib.es6-RU1n5ZxP.js";import"./CloseButton-DJdHSP0V.js";function ee(c){return I({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M99.5 18.406V92.22h321.594V18.405H99.5zm24.75 92.5v288.531h18.688v-288.53H124.25zm253.406 0v288.531h18.688v-288.53h-18.688zm-216.47 58.53v230l199.033.002v-230h-43.5c-.717 8.933-8.194 15.937-17.314 15.937s-16.596-7.004-17.312-15.938H267.75c.968 3.02 1.5 6.223 1.5 9.563 0 17.317-14.058 31.344-31.375 31.344S206.53 196.317 206.53 179c0-3.34.535-6.542 1.5-9.563h-46.843zm138.095 30.845c24.18 0 43.783 19.603 43.783 43.782 0 24.18-19.602 43.782-43.782 43.782-24.178 0-43.78-19.602-43.78-43.78 0-24.18 19.602-43.783 43.78-43.783zm-81.25 20.814c14.265 0 25.814 11.58 25.814 25.844 0 14.264-11.55 25.812-25.813 25.812-14.263 0-25.843-11.548-25.843-25.813 0-14.264 11.58-25.843 25.844-25.843zm68.564 79.344c14.264 0 25.844 11.58 25.844 25.843 0 14.265-11.58 25.814-25.844 25.814-14.264 0-25.813-11.55-25.813-25.813 0-14.263 11.55-25.842 25.814-25.842zM99.5 418.125v73.844h321.594v-73.845H99.5z"},child:[]}]})(c)}function se(c){return I({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M241.1 21.91c-89.7-.15-172.99 2.47-171.94 8.27l22.08 36.14c59.36-5.1 115.96-6.95 172.66-6.57 53.2.35 106.5 2.67 162.1 6.09l31.2-33.28c-4.5-6.74-114.4-10.48-216.1-10.65zm3.8 55.81c-49.1.12-98.3 1.99-149.69 6.32C73.42 207.7 61.35 358.6 89.71 451.7l-26.43 31c128.12 9.6 258.52 12.7 382.62 6.3L416 453.4c19.3-106.2 13.3-251.2.2-370.12-51.2-3.06-100.3-5.1-149.3-5.49L401.1 201h-71.3c3.8 23.1 20.4 54.3 37.9 83.2 9.9 16.4 20 32.3 27.7 46.3 7.7 14 13.6 25.7 13.6 37.5 0 28-18.9 51-46.7 65.9-27.8 15-65.1 23.1-106.3 23.1s-78.5-8.1-106.3-23.1C121.9 419 103 396 103 368c0-12 6.2-23.7 14.3-37.9 8.1-14.2 18.6-30.2 28.8-46.8 18-29.1 34.4-60.5 36.7-82.3H104zm11 14.37L152 183h48.3l.7 8.2c2.7 31.9-18.9 68-39.6 101.6-10.4 16.8-20.8 32.7-28.4 46.2-7.7 13.4-12 25-12 29 0 14.6 7 27.5 20.1 38.6 54.2-6.8 82-10.6 106.4-11.4.6-8.5 1.7-17 3.1-25.2-36.6 2.3-70.3-7.5-103.5-19.3 14.9-28.8 42.3-48.9 67-48.8 4.6 0 9.1.6 13.4 2.1 11.2 3.6 21.3 23.7 28 40.6 2.2-10.5 4.3-19.5 5.2-26.1v-.1c.9-6.2-1.6-24-4.8-38.7-2.3-10.6-4.7-19.9-5.9-24.3-6.3 0-11.9-1.2-15.6-5-25.4-26.4-8.9-75.2 12.9-102.4 15.5 25.8 35.7 53.6 56 72.8-4.4 14.8-12.4 26.7-27.9 32-2.1.2-4.7.5-7.3.9 1.4 5.2 3.4 13 5.4 22.1 1.3 5.7 2.5 11.6 3.5 17.5 5.3-4.9 11.4-9.4 16.4-9.6h1.1c28 2.6 59.7 29.6 67.7 69-27.5-12.6-59-5.3-83.9-30.2-2.8 18.6-10.6 46.6-12.7 72.8 24.1.8 51.9 4.6 105.3 11.3 13.1-11.1 20.1-24 20.1-38.6 0-4.2-4.1-15.6-11.4-28.8-7.3-13.3-17.2-29-27.3-45.7C332.2 260.3 311 224.2 311 192v-9h43.9zm.1 320.81c-22.3 0-45.9 3-90.7 8.7C189 432.5 220.8 439 256 439s67-6.5 90.7-17.4c-44.8-5.7-68.4-8.7-90.7-8.7z"},child:[]}]})(c)}const ie=({onHandleSave:c,userId:g,sampleType:_,company:j,spacialCon:S})=>{const w=V(),[z,v]=o.useState([]),l={user_id:g,company_id:j.id,analysisMethod:"",spacialCon:"",notes:"",sample_type_id:_,fertilizerRecords:[],files:[]},m=B({analysisMethod:a().test("analysis-method-required","กรุณาเลือกวัตถุประสงค์การขอใช้บริการ",function(t){const{sample_type_id:n}=this.options.context;return n===1?t&&["is_registration_analysis","is_quality_check_analysis"].includes(t):!0}),notes:a().notRequired(),fertilizerRecords:H().min(1,"กรุณาเพิ่มข้อมูลปุ๋ยอย่างน้อยหนึ่งรายการ").of(B({fertilizer_type_id:E().required("กรุณาเลือกประเภทลักษณะปุ๋ย").typeError("กรุณาเลือกประเภทลักษณะปุ๋ย"),packaging_id:E().required("กรุณาเลือกภาชนะบรรจุ").typeError("กรุณาเลือกภาชนะบรรจุ"),color:a().required("กรุณากรอกสี"),fertilizer_formula:a().required("กรุณากรอกสูตรปุ๋ย"),common_name:a().required("กรุณากรอกชื่อสามัญ"),trade_name:a().required("กรุณากรอกชื่อการค้า"),trademark:a().required("กรุณากรอกเครื่องหมายการค้า"),manufacturer:a().required("กรุณากรอกชื่อผู้ผลิต"),manufacturer_country:a().required("กรุณากรอกประเทศของผู้ผลิต"),supplier:a().required("กรุณากรอกชื่อผู้จัดจำหน่าย"),supplier_country:a().required("กรุณากรอกประเทศของผู้จัดจำหน่าย"),composition:a().required("กรุณากรอกวัตถุส่วนประกอบของปุ๋ย"),sample_weight:E().required("กรุณากรอกปริมาณ").typeError("ปริมาณต้องเป็นตัวเลข").positive("ปริมาณต้องมากกว่า 0"),sample_weight_unit:a().required("กรุณากรอกหน่วย")})),files:H().min(1,"กรุณาอัปโหลดเอกสารอย่างน้อยหนึ่งไฟล์").required("กรุณาอัปโหลดเอกสาร")}),b=async(t,{setSubmitting:n,validateForm:f})=>{console.log("Submitting - Values:",t);const u=await f();console.log("Submitting - Errors:",u),Object.keys(u).length===0?(console.log("Form Values:",t),c(t)):console.log("Validation Errors:",u),n(!1)},h=async()=>{try{const t=await W();v(t)}catch(t){console.error("Error fetching fertilizer types:",t)}};return o.useEffect(()=>{h()},[]),e.jsx(Q,{initialValues:l,validationSchema:m,onSubmit:b,validateOnChange:!0,validateOnBlur:!0,validationContext:{sample_type_id:_},children:({values:t,errors:n,touched:f,handleChange:u,handleBlur:k,setFieldValue:q,handleSubmit:i,validateForm:r})=>(console.log("Formik values:",t),console.log("Formik Errors:",n),e.jsx(Y,{onSubmit:i,children:e.jsxs(p,{children:[e.jsx(p.Header,{children:e.jsx("h5",{children:_===1?"ลงทะเบียนใบนำส่งตัวอย่างปุ๋ยอินทรีย์":"ลงทะเบียนใบนำส่งตัวอย่างปุ๋ยเคมี เพื่อขึ้นทะเบียนปุ๋ย"})}),e.jsx(p.Body,{className:"p-0",children:e.jsx(X,{values:t,errors:n,touched:f,handleChange:u,handleBlur:k,setFieldValue:q,company:j,spacialCon:S,fertilizerTypes:z,sampleType:_,validateForm:r})}),e.jsxs(p.Footer,{className:"text-start",children:[e.jsxs(x,{variant:"primary",type:"submit",children:[e.jsx("i",{className:"feather icon-save"})," บันทึก"]}),e.jsxs(x,{variant:"danger",onClick:()=>w("/request"),children:[e.jsx("i",{className:"feather icon-corner-up-left"})," ยกเลิก"]})]})]})}))})},qe=()=>{var k,q;const c=V(),[g,_]=o.useState(null),[j,S]=o.useState(null),[w,z]=o.useState(!1),v=A();(k=v.state)!=null&&k.user;const l=((q=v.state)==null?void 0:q.customer)||null,[m,b]=o.useState({});console.log("customerFromState:",l);const[h,t]=o.useState([]);o.useEffect(()=>{const i=localStorage.getItem("authToken");f(l==null?void 0:l.id),i&&L(i).then(r=>{t(r.user)})},[]);const n=i=>{_(i),i==="organic"?S(1):i==="chemical"&&S(2)},f=async i=>{try{const r=await Z(i);b(Array.isArray(r)?r:[])}catch(r){console.error(r),b([])}},u=async i=>{console.log(i);const r={user_id:h.user_id,customer_id:i.company_id,is_registration_analysis:i.analysisMethod==="is_registration_analysis"?1:0,is_quality_check_analysis:i.analysisMethod==="is_quality_check_analysis"?1:0,sample_type_id:i.sample_type_id,sr_is_self_pickup:(i.reportMethod||[]).includes("is_self_pickup")?1:0,sr_pdf_email:(i.reportMethod||[]).includes("pdf_email")?i.email:"",sr_is_mail_delivery:(i.reportMethod||[]).includes("is_self_pickup")?1:0,sr_mail_delivery_location:"-",notes:i.notes};console.log(r);let C=[];i.fertilizerRecords.forEach(s=>{const F={request_id:null,is_single_fertilizer:s.fertilizer_main_id===1?1:0,is_compound_fertilizer:s.fertilizer_main_id===2?1:0,is_mixed_fertilizer:s.fertilizer_main_id===3?1:0,is_secondary_nutrient_fertilizer:s.fertilizer_main_id===4?1:0,fertilizer_type_id:s.fertilizer_type_id,color:s.color,fertilizer_formula:s.fertilizer_formula,packaging_other:s.packaging_other,common_name:s.common_name,trade_name:s.trade_name,trademark:s.trademark,manufacturer:s.manufacturer,manufacturer_country:s.manufacturer_country,supplier:s.supplier,supplier_country:s.supplier_country,composition:s.composition,sample_weight:s.sample_weight,sample_weight_unit:s.sample_weight_unit,packaging_id:s.packaging_id,is_self_pickup:(s.reportMethod||[]).includes("is_self_pickup")?1:0,pdf_email:(s.reportMethod||[]).includes("pdf_email")?s.email:"",is_self_pickup:(s.reportMethod||[]).includes("is_self_pickup")?1:0,is_mail_delivery:(s.reportMethod||[]).includes("pdf_email")?1:0,test_all_items:s.test_all_items,is_lab_dispose_sample:s.sampleDisposal==="is_lab_dispose_sample"?1:0,is_collect_within_3_months:s.sampleDisposal==="is_collect_within_3_months"?1:0,is_return_sample:s.sampleDisposal==="is_return_sample"?1:0,submitted_by:s.submitted_by,phone:s.submitted_phone,test_items:s.test_items,fertilizer_main_id:s.fertilizer_main_id};C.push(F)}),console.log(C);const $=i.files;try{console.log("step1:",r);const s=await O(r);if(s.request_id){for(const d of C){d.request_id=s.request_id;const y=await J(d);if(console.log("responseSample:",y),y.submission_id){const M={submission_id:y.submission_id,test_items:d.test_items},G=await K(M);console.log("responseTestItem:",G)}}const F=await P($,"service-requests","service_");for(const d of F){const y=d.fileName.split("/").pop(),M={request_id:s.request_id,uploaded_by:h.user_id,file_name:y,file_path:`/${d.fileName}`};await U(M)}D.success("เพิ่มข้อมูลคำขอรับบริการสำเร็จ!",{autoClose:3e3}),z(!0)}}catch(s){console.log("Error:",s),D.error("เพิ่มข้อมูลคำขอรับบริการไม่สำเร็จ!",{autoClose:3e3}),alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล:",s)}};return e.jsxs(e.Fragment,{children:[g===null&&e.jsxs(p,{children:[e.jsx(p.Header,{children:e.jsx("h5",{children:"เลือกการขอรับบริการ"})}),e.jsxs(p.Body,{children:[e.jsxs(T,{className:"mb-4",children:[e.jsx(N,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อบริษัท : ",e.jsx("strong",{className:"text-dark",children:l.company_name})]})}),e.jsx(N,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["เลขที่ผู้เสียภาษี : ",e.jsx("strong",{className:"text-dark",children:l.tax_id})]})}),e.jsx(N,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ที่อยู่ : ",e.jsx("strong",{className:"text-dark",children:l.company_address})]})}),m&&m.length>0&&e.jsx(N,{md:6,children:e.jsxs("p",{className:"mb-0",children:["เงื่อนไขพิเศษ :"," ",e.jsx("strong",{className:"text-dark",children:m.map((i,r)=>r+1<m.length?i.description:` , ${i.description}`)})]})})]}),e.jsxs("div",{className:"d-flex justify-content-center",children:[e.jsxs(x,{variant:"info",className:"w-50 py-4 d-flex align-items-center justify-content-center flex-column",onClick:()=>n("organic"),style:{fontSize:18},children:[e.jsx(se,{size:45,className:"mb-2"}),"แบบฟอร์มนำส่งตัวอย่างปุ๋ยอินทรีย์"]}),e.jsxs(x,{variant:"success",className:"w-50  py-4 d-flex align-items-center justify-content-center flex-column",onClick:()=>n("chemical"),style:{fontSize:18},children:[e.jsx(ee,{size:45,className:"mb-2"}),"แบบฟอร์มนำส่งตัวอย่างปุ๋ยเคมีเพื่อขึ้นทะเบียนปุ๋ย"]})]})]})]}),g!==null&&e.jsx(ie,{userId:h.user_id,onHandleSave:u,sampleType:j,company:l,spacialCon:m}),e.jsxs(R,{show:w,onHide:()=>z(!1),centered:!0,children:[e.jsxs(R.Body,{className:"text-center",children:[e.jsx("i",{className:"text-success",style:{fontSize:"3rem"},children:"✔"}),e.jsx("h5",{className:"mt-3",children:"ลงทะเบียนขอรับบริการสำเร็จ"}),e.jsx("p",{children:"กรุณารอผลการตรวจสอบคำขอใช้บริการ"})]}),e.jsx(R.Footer,{children:e.jsx(x,{variant:"success",onClick:()=>c("/request/"),children:"ปิด"})})]})]})};export{qe as default};
