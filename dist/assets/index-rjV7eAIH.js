import{j as e,R as y,C as v,r as a,u as q,h as I,y as b,c as k,a0 as A}from"./index-6YeC_AS5.js";import{G as F,A as E}from"./index-DiQzpnmj.js";import{a as U,b as H}from"./index-DpgziKTs.js";import{C as u}from"./Card-BhOVTKNa.js";import{e as L}from"./serviceRequest-CJ15hpJs.js";import{A as R}from"./Alert-D32VqIXN.js";import"./resultsTestData-CJN3BdsU.js";import"./format-CBpsKyOP.js";import"./Table-WM_kTK7U.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";const B=()=>{const n=[],i=n.length;return(n.reduce((r,l)=>r+(l.testItems.pH||0),0)/i).toFixed(2),[...n.map(r=>[r.sampleNo,r.testItems.pH||0,r.testItems.MC||0,r.testItems.TN||0])],e.jsx("div",{className:"",children:e.jsxs(u,{children:[e.jsx(u.Header,{children:e.jsx("h5",{children:"ตารางสรุปผลการทดสอบ"})}),e.jsx(u.Body,{children:e.jsx(y,{children:e.jsx(v,{})})})]})})},c=[{title:"จำนวนคำขอใช้บริการทั้งหมด",amount:"0",unit:"รายการ",icon:"",iconNew:e.jsx(F,{className:"text-c-green",style:{marginRight:12}}),value:0,class:"progress-c-theme"},{title:"จำนวนการทดสอบกำลังทดสอบ",amount:"0",unit:"รายการ",icon:"",iconNew:e.jsx(U,{className:"text-c-blue",style:{marginRight:12}}),value:0,class:"progress-c-theme2"},{title:"จำนวนการทดสอบที่ยังไม่ทดสอบ",amount:"0",unit:"รายการ",icon:"",iconNew:e.jsx(H,{className:"text-c-red",style:{marginRight:12}}),value:0,color:"progress-c-theme"}],M=()=>{const[n,i]=a.useState(null),[r,l]=a.useState([]),[$,m]=a.useState(!1),[D,N]=a.useState(c),w=q();a.useEffect(()=>{const s=localStorage.getItem("authToken");s&&(m(!0),I(s).then(t=>{i(t.user),_(t.user.user_id)}).catch(t=>{b.error("ไม่สามารถตรวจสอบผู้ใช้ได้"),console.error(t)}).finally(()=>m(!1)))},[]);const _=async s=>{m(!0);try{const t=await L(s);t.success?l(t.data):l([])}catch(t){b.error("เกิดข้อผิดพลาดในการดึงข้อมูลคำขอ"),console.error(t),l([])}finally{m(!1)}};a.useEffect(()=>{if(r.length>0){const s=r.length,t=r.reduce((d,h)=>{const x=(h.sample_submissions||[]).reduce((g,p)=>{const f=p.sample_submission_details||[];return g+f.filter(j=>j.status==="pending").length},0);return d+x},0),o=r.reduce((d,h)=>{const x=(h.sample_submissions||[]).reduce((g,p)=>{const f=p.sample_submission_details||[];return g+f.filter(j=>j.status==="not-start").length},0);return d+x},0),T=[{...c[0],amount:s.toString(),value:s>0?s/s*100:0},{...c[1],amount:t.toString(),value:t>0?t/(t+o||1)*100:0},{...c[2],amount:o.toString(),value:o>0?o/(t+o||1)*100:0}];N(T)}else N(c)},[r]);const S=r.filter(s=>s.status_tracking==="requested");return e.jsxs(k.Fragment,{children:[S.length>0&&e.jsx(e.Fragment,{children:S.map(s=>e.jsxs(R,{variant:"warning",className:"mb-2 rounded-0",style:{borderLeft:"solid 3px #FFA500"},children:["รหัสลูกค้า : ",s.company_code||"-"," - ",s.customer_name||"-"," ",e.jsx("strong",{style:{color:"#000000"},children:"รอจัดส่งตัวอย่าง"})," ","กรุณาดำเนินการจัดส่งตัวอย่าง","   ",e.jsx(R.Link,{as:A,to:"/request/detial",state:{id:s.request_id},className:"text-primary",onClick:()=>w("/request/detial",{state:{id:s.request_id}}),children:"ดูรายละเอียด"})]}))}),e.jsxs(y,{children:[D.map((s,t)=>e.jsx(v,{xl:6,xxl:4,children:e.jsx(u,{children:e.jsxs(u.Body,{children:[e.jsx("h6",{className:"mb-4",children:s.title}),e.jsxs("div",{className:"row d-flex align-items-center",children:[e.jsx("div",{className:"col-9",children:e.jsxs("h3",{className:"f-w-300 d-flex align-items-center m-b-0",children:[s.icon&&e.jsx("i",{className:`feather ${s.icon} f-30 m-r-5`}),s.iconNew&&s.iconNew,s.amount," ",s.unit]})}),e.jsx("div",{className:"col-3 text-end",children:e.jsxs("p",{className:"m-b-0",children:[Math.round(s.value),"%"]})})]}),e.jsx("div",{className:"progress m-t-30",style:{height:"7px"},children:e.jsx("div",{className:`progress-bar ${s.class}`,role:"progressbar",style:{width:`${s.value}%`},"aria-valuenow":s.value,"aria-valuemin":"0","aria-valuemax":"100"})})]})})},t)),e.jsx(v,{md:12,xl:12,children:e.jsx(B,{})})]})]})};function ee(){const[n,i]=a.useState(localStorage.getItem("userRole"));return a.useEffect(()=>{const r=localStorage.getItem("userRole");r||i(r)},[n]),e.jsx(e.Fragment,{children:n!=="user"?e.jsx(E,{}):e.jsx(M,{})})}export{ee as default};
