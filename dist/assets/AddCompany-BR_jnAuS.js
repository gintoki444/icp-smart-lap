import{r,x as R,d as D,j as e,R as x,C as d,F as n,B as u,ae as $,y as f}from"./index-BnqE3Rwp.js";import{F as A,c as E,a as l}from"./formik.esm-CDJOjLuD.js";import{u as w}from"./index-TizbD2zs.js";import{p as U}from"./customerRequest-BSWKX1-j.js";import{a as V,p as z}from"./specialConditionsRequest-DVpIoZFL.js";import{C as j}from"./Card-BpOPiakr.js";import"./tslib.es6-RU1n5ZxP.js";function Q(){const[b,C]=r.useState([]),[_,v]=r.useState([]);r.useEffect(()=>{const i=localStorage.getItem("authToken");i&&R(i).then(a=>{C(a.user)})},[]),r.useEffect(()=>{N()},[]);const N=()=>{V().then(i=>{i&&v(i)})},g={company_code:"",company_name:"",company_address:"",document_address:"",tax_id:"",email:"",phone:"",condition_id:"",special_conditions:""},k=()=>E({company_code:l().min(3,"รหัสบริษัทต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกรหัสบริษัท"),company_name:l().required("กรุณากรอกชื่อบริษัท"),tax_id:l().matches(/^[0-9]{10,13}$/,"เลขที่ผู้เสียภาษีต้องมี 10 ถึง 13 หลัก").required("กรุณากรอกเลขที่ผู้เสียภาษี"),company_address:l().required("กรุณากรอกที่อยู่บริษัท"),document_address:l().min(3,"ที่อยู่จัดส่งเอกสารต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกที่อยู่จัดส่งเอกสาร"),email:l().email("รูปแบบอีเมล์ไม่ถูกต้อง").required("กรุณากรอกอีเมล์"),phone:l().matches(/^[0-9]{10}$/,"กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง (10 หลัก)").required("กรุณากรอกเบอร์โทรศัพท์"),condition_id:l().required("กรุณาเลือกเงื่อนไขพิเศษ")}),F=async(i,{setErrors:a,setStatus:s,setSubmitting:c})=>{var o;try{i.special_conditions=(o=_.find(m=>m.condition_id===Number(i.condition_id)))==null?void 0:o.description;const t=await U(i);if(t.company_id){await z({company_id:t.company_id,condition_id:i.condition_id});const m={user_id:b.user_id,company_id:t.company_id,approved_by:null,status:"pending"};$(m).then(()=>{f.success("เพิ่มข้อมูลบริษัทสำเร็จ!",{autoClose:3e3}),h("/user/company")})}}catch(t){f.error(`เพิ่มข้อมูลไม่สำเร็จ: ${t.message}`,{autoClose:3e3}),s({success:!1}),a({submit:t.message}),c(!1)}},h=D(),[S,I]=r.useState([]),L=r.useCallback(i=>{I(a=>[...a,...i])},[]),{getRootProps:G,getInputProps:q,isDragActive:y}=w({onDrop:L,accept:"image/*,application/pdf",maxSize:5*1024*1024});return e.jsx(x,{className:"",children:e.jsxs(j,{children:[e.jsx(j.Header,{children:e.jsx(x,{children:e.jsx(d,{children:e.jsx(j.Title,{as:"h5",children:"เพิ่มข้อมูลบริษัท"})})})}),e.jsx(j.Body,{children:e.jsx(A,{initialValues:g,validationSchema:k,onSubmit:F,children:({values:i,errors:a,touched:s,handleChange:c,handleBlur:o,handleSubmit:t,isSubmitting:m})=>e.jsxs(n,{onSubmit:t,children:[e.jsxs(x,{children:[e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"รหัสบริษัท:"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"รหัสบริษัท",name:"company_code",value:i.company_code,onChange:c,onBlur:o,isInvalid:s.company_code&&!!a.company_code}),s.company_code&&a.company_code&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.company_code})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"ชื่อบริษัท :"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"ชื่อบริษัท",name:"company_name",value:i.company_name,onChange:c,onBlur:o,isInvalid:s.company_name&&!!a.company_name}),s.company_name&&a.company_name&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.company_name})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"เลขที่ผู้เสียภาษี :"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"เลขที่ผู้เสียภาษี",name:"tax_id",value:i.tax_id,onChange:c,onBlur:o,isInvalid:s.tax_id&&!!a.tax_id}),s.tax_id&&a.tax_id&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.tax_id})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"ที่อยู่บริษัท :"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"ที่อยู่บริษัท",name:"company_address",value:i.company_address,onChange:c,onBlur:o,isInvalid:s.company_address&&!!a.company_address}),s.company_address&&a.company_address&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.company_address})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"ที่อยู่จัดส่งเอกสาร :"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"ที่อยู่จัดส่งเอกสาร",name:"document_address",value:i.document_address,onChange:c,onBlur:o,isInvalid:s.document_address&&!!a.document_address}),s.document_address&&a.document_address&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.document_address})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"อีเมล์ :"}),e.jsx(n.Control,{type:"email",className:"form-control",placeholder:"อีเมล์",name:"email",value:i.email,onChange:c,onBlur:o,isInvalid:s.email&&!!a.email}),s.email&&a.email&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.email})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"เบอร์โทรศัพท์ :"}),e.jsx(n.Control,{type:"text",className:"form-control",placeholder:"เบอร์โทรศัพท์",name:"phone",value:i.phone,onChange:c,onBlur:o,isInvalid:s.phone&&!!a.phone}),s.phone&&a.phone&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.phone})]})}),e.jsx(d,{md:6,children:e.jsxs(n.Group,{className:"mb-2",children:[e.jsx(n.Label,{children:"เงื่อนไขพิเศษ :"}),e.jsxs(n.Select,{name:"condition_id",style:{padding:"10px 20px"},value:i.condition_id,onChange:c,onBlur:o,isInvalid:s.condition_id&&!!a.condition_id,children:[e.jsx("option",{value:"",children:"เลือกเงื่อนไขพิเศษ"}),_.map(p=>e.jsx("option",{value:p.condition_id,children:p.description},p.condition_id))]}),s.condition_id&&a.condition_id&&e.jsx(n.Control.Feedback,{type:"invalid",children:a.condition_id})]})}),e.jsxs(d,{md:12,children:[e.jsxs(n.Group,{className:"mb-4",children:[e.jsx(n.Label,{children:"อัพโหลดเอกสาร :"}),e.jsxs("div",{...G(),style:{border:"2px dashed #04a9f5",borderRadius:"8px",padding:"50px 20px",textAlign:"center",backgroundColor:y?"#e6f7ff":"#f8f9fa"},children:[e.jsx("input",{...q()}),y?e.jsx("p",{style:{marginBottom:0},children:"Drop your files here..."}):e.jsx("p",{style:{marginBottom:0},children:"Drag and drop files here, or click to select files"})]})]}),e.jsx("ul",{className:"mt-3",children:S.map((p,B)=>e.jsxs("li",{children:[e.jsx("i",{className:"feather icon-file",style:{marginRight:12}}),p.name]},B))})]})]}),e.jsx(x,{className:"mt-3",children:e.jsxs(d,{children:[e.jsx(u,{variant:"primary",type:"submit",disabled:m,children:m?e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"feather icon-save"})," บันทึก"]})}),e.jsxs(u,{variant:"danger",onClick:()=>h("/user/company/select"),className:"ms-2",children:[e.jsx("i",{className:"feather icon-corner-up-left"})," ย้อนกลับ"]})]})})]})})})]})})}export{Q as default};
