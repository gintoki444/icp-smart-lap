import{u as I,r as l,j as e,R as G,C as a,B as x,y as k}from"./index-Bq0BSIrC.js";import{p as F}from"./testItemsRequest-CIY3wZGW.js";import{g as E}from"./testGroupRequest-74lX6Leo.js";import{C as m}from"./Card-C7kDYjR9.js";import{A as S}from"./Alert-C8ltoKJ3.js";import{F as t}from"./Form-C1nYDdO8.js";import"./CloseButton-DJdHSP0V.js";import"./Transition-DABJrq3x.js";import"./setPrototypeOf-DgZC2w_0.js";const H=()=>{const p=I(),[s,j]=l.useState({test_name:"",test_name_th:"",name_for_quotation:"",test_code:"",test_description:"",unit_price:"",test_type:0,is_active:1,group_id:""}),[f,v]=l.useState([]),[n,_]=l.useState({}),[u,d]=l.useState(null),[c,h]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const i=await E();v(i)}catch(i){d("เกิดข้อผิดพลาดในการดึงข้อมูลกลุ่มทดสอบ"),console.error("Error fetching test groups:",i)}})()},[]);const b=()=>{const r={};return s.test_name.trim()||(r.test_name="กรุณากรอกชื่อการทดสอบ (ภาษาอังกฤษ)"),s.test_name_th.trim()||(r.test_name_th="กรุณากรอกชื่อการทดสอบ (ภาษาไทย)"),s.name_for_quotation.trim()||(r.name_for_quotation="กรุณากรอกชื่อสำหรับใบเสนอราคา"),s.test_code.trim()||(r.test_code="กรุณากรอกรหัสการทดสอบ"),s.test_description.trim()||(r.test_description="กรุณากรอกคำอธิบายการทดสอบ"),(!s.unit_price||isNaN(s.unit_price)||Number(s.unit_price)<=0)&&(r.unit_price="กรุณากรอกราคาต่อหน่วยที่ถูกต้อง (มากกว่า 0)"),s.group_id||(r.group_id="กรุณาเลือกกลุ่มทดสอบ"),_(r),Object.keys(r).length===0},o=r=>{const{name:i,value:y,type:C,checked:N}=r.target;j({...s,[i]:C==="checkbox"?N?1:0:y}),_({...n,[i]:""})},g=async r=>{if(r.preventDefault(),!!b()){h(!0),d(null);try{if((await F({...s,unit_price:Number(s.unit_price),test_type:Number(s.test_type),is_active:Number(s.is_active),group_id:Number(s.group_id)})).test_item_id)k.success("เพิ่มรายการทดสอบสำเร็จ!",{autoClose:3e3}),p("/admin/test-items");else throw new Error("No test_item_id returned")}catch(i){d("เกิดข้อผิดพลาดในการเพิ่มรายการทดสอบ กรุณาลองใหม่"),console.error("Error adding test item:",i)}finally{h(!1)}}};return e.jsx("div",{children:e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx("h5",{children:"เพิ่มรายการทดสอบ"})}),e.jsxs(m.Body,{children:[u&&e.jsx(S,{variant:"danger",children:u}),e.jsxs(t,{onSubmit:g,children:[e.jsxs(G,{children:[e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"test_name_th",children:[e.jsx(t.Label,{children:"ชื่อการทดสอบ (ภาษาไทย)"}),e.jsx(t.Control,{type:"text",name:"test_name_th",value:s.test_name_th,placeholder:"กรอกชื่อการทดสอบ (ภาษาไทย)",onChange:o,isInvalid:!!n.test_name_th}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.test_name_th})]})}),e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"test_name",children:[e.jsx(t.Label,{children:"ชื่อการทดสอบ (ภาษาอังกฤษ)"}),e.jsx(t.Control,{type:"text",name:"test_name",value:s.test_name,placeholder:"กรอกชื่อการทดสอบ (ภาษาอังกฤษ)",onChange:o,isInvalid:!!n.test_name}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.test_name})]})}),e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"name_for_quotation",children:[e.jsx(t.Label,{children:"ชื่อสำหรับใบเสนอราคา"}),e.jsx(t.Control,{type:"text",name:"name_for_quotation",value:s.name_for_quotation,placeholder:"กรอกชื่อสำหรับใบเสนอราคา",onChange:o,isInvalid:!!n.name_for_quotation}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.name_for_quotation})]})}),e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"test_code",children:[e.jsx(t.Label,{children:"รหัสการทดสอบ"}),e.jsx(t.Control,{type:"text",name:"test_code",value:s.test_code,placeholder:"กรอกรหัสการทดสอบ",onChange:o,isInvalid:!!n.test_code}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.test_code})]})}),e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"unit_price",children:[e.jsx(t.Label,{children:"ราคาต่อหน่วย (บาท)"}),e.jsx(t.Control,{type:"number",name:"unit_price",value:s.unit_price,placeholder:"กรอกราคาต่อหน่วย (บาท)",onChange:o,isInvalid:!!n.unit_price,step:"0.01"}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.unit_price})]})}),e.jsx(a,{md:6,className:"mb-3",children:e.jsxs(t.Group,{controlId:"group_id",children:[e.jsx(t.Label,{children:"กลุ่มทดสอบ"}),e.jsxs(t.Select,{name:"group_id",style:{padding:"10.5px 22px",fontSize:14},value:s.group_id,onChange:o,isInvalid:!!n.group_id,children:[e.jsx("option",{value:"",children:"เลือกกลุ่มทดสอบ"}),f.map(r=>e.jsxs("option",{value:r.group_id,children:[r.group_name_th," (",r.group_name_en,")"]},r.group_id))]}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.group_id})]})}),e.jsx(a,{md:12,className:"mb-3",children:e.jsxs(t.Group,{controlId:"test_description",children:[e.jsx(t.Label,{children:"คำอธิบายการทดสอบ"}),e.jsx(t.Control,{as:"textarea",rows:3,name:"test_description",value:s.test_description,placeholder:"กรอกคำอธิบายการทดสอบ",onChange:o,isInvalid:!!n.test_description}),e.jsx(t.Control.Feedback,{type:"invalid",children:n.test_description})]})})]}),e.jsx(x,{variant:"primary",type:"submit",disabled:c,children:c?"กำลังบันทึก...":"บันทึก"}),e.jsx(x,{variant:"danger",className:"ms-2",onClick:()=>p("/admin/test-items"),disabled:c,children:"กลับ"})]})]})]})})};export{H as default};
