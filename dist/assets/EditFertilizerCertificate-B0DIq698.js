import{u as E,a as I,r as a,j as e,R as S,C as s,B as p,y as k}from"./index-Bq0BSIrC.js";import{a as L,b as w}from"./fertilizerCertificateRequest-DsyareGj.js";import{g as G}from"./fertilizerMainRequest-kGbpd_0A.js";import{C as _}from"./Card-C7kDYjR9.js";import{A}from"./Alert-C8ltoKJ3.js";import{F as r}from"./Form-C1nYDdO8.js";import"./CloseButton-DJdHSP0V.js";import"./Transition-DABJrq3x.js";import"./setPrototypeOf-DgZC2w_0.js";const Q=()=>{var v;const d=E(),o=((v=I().state)==null?void 0:v.id)||null,[n,f]=a.useState({fertilizer_main_id:"",nutrient_name:"",min_value:"",unit:"",legal_reference:""}),[g,z]=a.useState([]),[t,h]=a.useState({}),[x,c]=a.useState(null),[u,j]=a.useState(!1);a.useEffect(()=>{o?(b(),C()):d("/admin/fertilizer-certificate")},[o]);const b=async()=>{try{const i=await L(o);f({fertilizer_main_id:i.fertilizer_main_id||"",nutrient_name:i.nutrient_name||"",min_value:i.min_value||"",unit:i.unit||"",legal_reference:i.legal_reference||""})}catch(i){c("เกิดข้อผิดพลาดในการดึงข้อมูลใบรับรองปุ๋ย"),console.error("Error fetching fertilizer certificate:",i)}},C=async()=>{try{const i=await G();z(i)}catch(i){c("เกิดข้อผิดพลาดในการดึงข้อมูลหมวดหมู่ปุ๋ย"),console.error("Error fetching fertilizer mains:",i)}},y=()=>{const i={};return n.fertilizer_main_id||(i.fertilizer_main_id="กรุณาเลือกหมวดหมู่ปุ๋ย"),n.nutrient_name.trim()||(i.nutrient_name="กรุณากรอกชื่อธาตุอาหาร"),(!n.min_value||isNaN(n.min_value)||Number(n.min_value)<0)&&(i.min_value="กรุณากรอกค่าต่ำสุดที่ถูกต้อง (มากกว่าหรือเท่ากับ 0)"),n.unit.trim()||(i.unit="กรุณากรอกหน่วย"),n.legal_reference.trim()||(i.legal_reference="กรุณากรอกข้อมูลอ้างอิงทางกฎหมาย"),h(i),Object.keys(i).length===0},l=i=>{const{name:m,value:N}=i.target;f({...n,[m]:N}),h({...t,[m]:""})},F=async i=>{if(i.preventDefault(),!!y()){j(!0),c(null);try{await w(o,{...n,fertilizer_main_id:Number(n.fertilizer_main_id),min_value:Number(n.min_value)}),k.success("แก้ไขใบรับรองปุ๋ยสำเร็จ!",{autoClose:3e3}),d("/admin/fertilizer-certificate")}catch(m){c("เกิดข้อผิดพลาดในการแก้ไขใบรับรองปุ๋ย กรุณาลองใหม่"),console.error("Error updating fertilizer certificate:",m)}finally{j(!1)}}};return e.jsx("div",{children:e.jsxs(_,{children:[e.jsx(_.Header,{children:e.jsx("h5",{children:"แก้ไขใบรับรองปุ๋ย"})}),e.jsxs(_.Body,{children:[x&&e.jsx(A,{variant:"danger",children:x}),e.jsxs(r,{onSubmit:F,children:[e.jsxs(S,{children:[e.jsx(s,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"fertilizer_main_id",children:[e.jsx(r.Label,{children:"หมวดหมู่ปุ๋ย"}),e.jsxs(r.Select,{name:"fertilizer_main_id",value:n.fertilizer_main_id,onChange:l,isInvalid:!!t.fertilizer_main_id,children:[e.jsx("option",{value:"",children:"-- เลือกหมวดหมู่ปุ๋ย --"}),g.map(i=>e.jsxs("option",{value:i.fertilizer_main_id,children:[i.fertilizer_main_name_th," (",i.fertilizer_main_name_en,")"]},i.fertilizer_main_id))]}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.fertilizer_main_id})]})}),e.jsx(s,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"nutrient_name",children:[e.jsx(r.Label,{children:"ชื่อธาตุอาหาร"}),e.jsx(r.Control,{type:"text",name:"nutrient_name",value:n.nutrient_name,onChange:l,isInvalid:!!t.nutrient_name}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.nutrient_name})]})}),e.jsx(s,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"min_value",children:[e.jsx(r.Label,{children:"ค่าต่ำสุด"}),e.jsx(r.Control,{type:"number",name:"min_value",value:n.min_value,onChange:l,isInvalid:!!t.min_value,step:"0.01"}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.min_value})]})}),e.jsx(s,{md:6,className:"mb-3",children:e.jsxs(r.Group,{controlId:"unit",children:[e.jsx(r.Label,{children:"หน่วย"}),e.jsx(r.Control,{type:"text",name:"unit",value:n.unit,onChange:l,isInvalid:!!t.unit}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.unit})]})}),e.jsx(s,{md:12,className:"mb-3",children:e.jsxs(r.Group,{controlId:"legal_reference",children:[e.jsx(r.Label,{children:"ข้อมูลอ้างอิงทางกฎหมาย"}),e.jsx(r.Control,{as:"textarea",rows:3,name:"legal_reference",value:n.legal_reference,onChange:l,isInvalid:!!t.legal_reference}),e.jsx(r.Control.Feedback,{type:"invalid",children:t.legal_reference})]})})]}),e.jsx(p,{variant:"primary",type:"submit",disabled:u,children:u?"กำลังบันทึก...":"บันทึก"}),e.jsx(p,{variant:"danger",className:"ms-2",onClick:()=>d("/admin/fertilizer-certificate"),disabled:u,children:"กลับ"})]})]})]})})};export{Q as default};
