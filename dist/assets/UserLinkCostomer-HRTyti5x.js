import{r as o,u as S,h as k,at as v,j as s,B as i,i as L,au as b,av as D,v as B,aw as U,y as l,ax as z}from"./index-CMKGjvil.js";import{C as m}from"./Card-ltuRbL1m.js";import{S as A}from"./Stack-_RiFjssk.js";import{F as E}from"./Form-XAT3KesX.js";import{B as I}from"./Badge-Degbu7BZ.js";import{D as R,B as T}from"./DataGrid-BSrFaLwh.js";import"./DefaultPropsProvider-7CXMMYWk.js";import"./emotion-element-f0de968e.browser.esm-D2ySOhvj.js";import"./TextField-l4tn0KBj.js";import"./toPropertyKey-BZFHAmHd.js";import"./Transition-CvY6YelV.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-Rbts8ePN.js";const W=()=>{const[u,x]=o.useState([]),[g,_]=o.useState([]),[n,f]=o.useState(()=>localStorage.getItem("filterText")||""),[h,w]=o.useState(g);S(),o.useEffect(()=>{const e=localStorage.getItem("authToken");e&&k(e).then(t=>{x(t.user)}),c()},[]),o.useEffect(()=>{},[h]);const c=()=>{v().then(e=>{if(e){const t=e.map((r,a)=>({id:r.id,No:a+1,user_id:r.user_id,username:r.username,first_name:r.first_name,last_name:r.last_name,fullName:`${r.first_name} ${r.last_name}`,user_email:r.user_email,user_phone:r.user_phone,company_id:r.company_id,company_name:r.company_name,company_address:r.company_address,company_email:r.company_email,company_phone:r.company_phone,createdAt:new Date(r.created_at).toLocaleString(),status:r.status}));_(t),w(t)}})},C=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"fullName",headerName:"ชื่อ-นามสกุลผู้ใช้",flex:1},{field:"user_email",headerName:"E-mail ผู้ใช้",flex:1},{field:"user_phone",headerName:"เบอร์โทรศัพท์",flex:1},{field:"company_name",headerName:"บริษัท",flex:1},{field:"company_email",headerName:"E-mail บริษัท",flex:1},{field:"company_phone",headerName:"เบอร์โทรบริษัท",flex:1},{field:"company_address",headerName:"ที่อยู่บริษัท",flex:1},{field:"createdAt",headerName:"วันที่สร้าง",flex:1},{field:"status",headerName:"สถานะคำขอ",width:120,headerAlign:"center",align:"center",renderCell:e=>s.jsx(I,{pill:!0,style:{},bg:e.row.status==="pending"?"warning":e.row.status==="rejected"?"danger":"success",children:e.row.status==="pending"?"รออนุมัติ":e.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:e=>s.jsxs(T,{style:{fontSize:14},children:[s.jsx(i,{variant:"info",size:"sm",disabled:e.row.status==="approved",onClick:()=>p(e.row.id,"Y"),children:s.jsx(b,{})}),s.jsx(i,{variant:"danger",size:"sm",disabled:e.row.status==="rejected",onClick:()=>p(e.row.id,"N"),children:s.jsx(D,{})}),s.jsx(i,{variant:"outline-danger",size:"sm",color:"secondary",onClick:()=>N(e.row.id),children:s.jsx(B,{})})]})}],y=h.filter(e=>Object.values(e).some(t=>t&&t.toString().toLowerCase().includes(n.toLowerCase())));o.useEffect(()=>{localStorage.setItem("filterText",n)},[n]);const j=()=>{f(""),localStorage.removeItem("filterText")},p=(e,t)=>{if(window.confirm(`คุณต้องการ${t==="N"?"ยกเลิก":""}อนุมัติคำขอใช้บริษัท หรือไม่?`)){const a={approved_by:u.user_id,status:t==="Y"?"approved":"rejected"};console.log(a);try{U(a,e).then(()=>{l.success(t==="N"?"ยกเลิกการอนุมัติสำเร็จ!":"อนุมัติสำเร็จ!",{autoClose:3e3}),c()})}catch(d){l.error(`อนุมัติไม่สำเร็จ: ${d}`,{autoClose:3e3})}}},N=(e,t)=>{if(window.confirm("คุณต้องการลบอนุมัติคำขอใช้บริษัท หรือไม่?")){const a={approved_by:u.user_id,status:"rejected"};console.log(a);try{z(e).then(()=>{l.success("ลบการอนุมัติสำเร็จ!",{autoClose:3e3}),c()})}catch(d){l.error(`ลบการอนุมัติไม่สำเร็จ: ${d}`,{autoClose:3e3})}}};return s.jsx("div",{className:"",children:s.jsxs(m,{children:[s.jsx(m.Header,{children:s.jsx("h5",{children:"ข้อมูลการขอใช้บริษัท"})}),s.jsxs(m.Body,{className:"p-10",children:[s.jsxs(A,{direction:"row",spacing:1,sx:{mb:2},children:[s.jsx(E.Control,{type:"text",placeholder:"Search",value:n,onChange:e=>f(e.target.value)}),s.jsx(i,{variant:"primary",size:"sm",color:"secondary",onClick:j,disabled:!n,children:s.jsx(L,{style:{fontSize:20}})})]}),s.jsx(R,{rows:y,columns:C,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{W as default};
