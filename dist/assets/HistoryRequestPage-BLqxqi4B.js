import{r as a,u as S,h as y,j as e,R as q,C,B as m,i as N}from"./index-Bq0BSIrC.js";import{c as R}from"./serviceRequest-BNwVWIYi.js";import{C as i}from"./Card-C7kDYjR9.js";import{S as k}from"./Stack-fH19WBfQ.js";import{F as B}from"./Form-C1nYDdO8.js";import{B as b}from"./Badge-D-xOYCqC.js";import{B as T}from"./ButtonGroup-bg4r2ah8.js";import{D as F}from"./DataGrid-CHhOcfGb.js";import"./DefaultPropsProvider-CMzRgkCO.js";import"./emotion-element-f0de968e.browser.esm-xSVEHtue.js";import"./TextField-BqqrABCd.js";import"./toPropertyKey-KGmwFxs9.js";import"./Transition-DABJrq3x.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-31lZdKBP.js";const W=()=>{const[E,c]=a.useState([]),[u,_]=a.useState([]),[o,n]=a.useState(()=>localStorage.getItem("filterText")||""),[l,h]=a.useState(u),f=S();a.useEffect(()=>{const s=localStorage.getItem("authToken");s&&y(s).then(r=>{c(r.user),p(r.user.user_id)})},[]),a.useEffect(()=>{},[l]);const p=s=>{R(s).then(r=>{if(r){const d=r.map((t,j)=>({id:t.request_id,No:j+1,request_date:new Date(t.request_date).toLocaleString(),request_no:t.request_no||"-",user_id:t.user_id,user_name:t.user_name,customer_id:t.customer_id,customer_name:t.customer_name,sample_type_name:t.sample_type_name,is_registration_analysis:t.is_registration_analysis,is_quality_check_analysis:t.is_quality_check_analysis,sample_type_id:t.sample_type_id,notes:t.notes||"-",created_at:new Date(t.created_at).toLocaleString(),status:t.status,sample_submissions:t.sample_submissions,service_request_documents:t.service_request_documents}));_(d),h(d)}})},g=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"customer_name",headerName:"บริษัท",flex:1},{field:"request_no",headerName:"เลขที่คำขอ",flex:.8},{field:"sample_type_name",headerName:"ประเภทคำขอ",flex:.7},{field:"request_date",headerName:"วันที่สร้าง",flex:1},{field:"notes",headerName:"โน้ต",flex:1.2},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:s=>e.jsx(b,{pill:!0,style:{},bg:s.row.status==="pending"?"warning":s.row.status==="rejected"?"danger":"success",children:s.row.status==="pending"?"กำลังดำเนินการ":s.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:s=>e.jsx(T,{children:e.jsx(m,{variant:"primary",size:"sm",onClick:()=>{f("/request/detial",{state:{id:s.row.id}})},children:e.jsx("i",{className:"feather icon-file-text m-0"})})})}],x=l.filter(s=>Object.values(s).some(r=>r&&r.toString().toLowerCase().includes(o.toLowerCase())));a.useEffect(()=>{localStorage.setItem("filterText",o)},[o]);const w=()=>{n(""),localStorage.removeItem("filterText")};return e.jsx(e.Fragment,{children:e.jsxs(i,{children:[e.jsx(i.Header,{children:e.jsx(q,{children:e.jsx(C,{children:e.jsx(i.Title,{as:"h5",children:"รายการคำขอรับบริการ"})})})}),e.jsxs(i.Body,{children:[e.jsxs(k,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(B.Control,{type:"text",placeholder:"Search",value:o,onChange:s=>n(s.target.value)}),e.jsx(m,{variant:"primary",size:"sm",color:"secondary",onClick:w,disabled:!o,children:e.jsx(N,{style:{fontSize:20}})})]}),e.jsx(F,{rows:x,columns:g,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{W as default};
