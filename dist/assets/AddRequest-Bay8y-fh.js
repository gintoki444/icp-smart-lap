import { G as I, u as L, r as o, j as e, F as T, B as d, k as G, y as B } from './index-DZpC_pHZ.js';
import { p as O, a as P } from './serviceRequest-D-ZD1URS.js';
import { p as U, a as J } from './sampleSubmissionsRequest-DYxy7UJJ.js';
import { h as K } from './uploadFileRequest-j7nqPy1R.js';
import { c as g, a as r, d as M, e as A, f as H, g as Q, F as W } from './formik.esm-DH0jrOO4.js';
import { g as X } from './specialConditionsRequest-DpcGqaux.js';
import { g as Y } from './testItemsRequest-5XlhAVBO.js';
import { S as Z, a as ee, b as se } from './Step3-DjsIlKed.js';
import { g as te } from './customerRequest-CwUVzGH7.js';
import { C as u } from './Card-ZCMDsCmS.js';
import { M as R } from './Modal-DVn7-Fnl.js';
import './firebaseConfig-pMHECxRz.js';
import './toPropertyKey-COtC2h-V.js';
import './DefaultPropsProvider-LyYhFUFs.js';
import './Transition-DW97tWQD.js';
import './Table-Bs-13SI2.js';
import './ButtonGroup-DLGnQ8T-.js';
import './index-kdHliud_.js';
import './tslib.es6-CTYbIaVE.js';
import './CloseButton-DgEPtGiG.js';
function ie(m) {
  return I({
    attr: { viewBox: '0 0 512 512' },
    child: [
      {
        tag: 'path',
        attr: {
          d: 'M99.5 18.406V92.22h321.594V18.405H99.5zm24.75 92.5v288.531h18.688v-288.53H124.25zm253.406 0v288.531h18.688v-288.53h-18.688zm-216.47 58.53v230l199.033.002v-230h-43.5c-.717 8.933-8.194 15.937-17.314 15.937s-16.596-7.004-17.312-15.938H267.75c.968 3.02 1.5 6.223 1.5 9.563 0 17.317-14.058 31.344-31.375 31.344S206.53 196.317 206.53 179c0-3.34.535-6.542 1.5-9.563h-46.843zm138.095 30.845c24.18 0 43.783 19.603 43.783 43.782 0 24.18-19.602 43.782-43.782 43.782-24.178 0-43.78-19.602-43.78-43.78 0-24.18 19.602-43.783 43.78-43.783zm-81.25 20.814c14.265 0 25.814 11.58 25.814 25.844 0 14.264-11.55 25.812-25.813 25.812-14.263 0-25.843-11.548-25.843-25.813 0-14.264 11.58-25.843 25.844-25.843zm68.564 79.344c14.264 0 25.844 11.58 25.844 25.843 0 14.265-11.58 25.814-25.844 25.814-14.264 0-25.813-11.55-25.813-25.813 0-14.263 11.55-25.842 25.814-25.842zM99.5 418.125v73.844h321.594v-73.845H99.5z'
        },
        child: []
      }
    ]
  })(m);
}
function re(m) {
  return I({
    attr: { viewBox: '0 0 512 512' },
    child: [
      {
        tag: 'path',
        attr: {
          d: 'M241.1 21.91c-89.7-.15-172.99 2.47-171.94 8.27l22.08 36.14c59.36-5.1 115.96-6.95 172.66-6.57 53.2.35 106.5 2.67 162.1 6.09l31.2-33.28c-4.5-6.74-114.4-10.48-216.1-10.65zm3.8 55.81c-49.1.12-98.3 1.99-149.69 6.32C73.42 207.7 61.35 358.6 89.71 451.7l-26.43 31c128.12 9.6 258.52 12.7 382.62 6.3L416 453.4c19.3-106.2 13.3-251.2.2-370.12-51.2-3.06-100.3-5.1-149.3-5.49L401.1 201h-71.3c3.8 23.1 20.4 54.3 37.9 83.2 9.9 16.4 20 32.3 27.7 46.3 7.7 14 13.6 25.7 13.6 37.5 0 28-18.9 51-46.7 65.9-27.8 15-65.1 23.1-106.3 23.1s-78.5-8.1-106.3-23.1C121.9 419 103 396 103 368c0-12 6.2-23.7 14.3-37.9 8.1-14.2 18.6-30.2 28.8-46.8 18-29.1 34.4-60.5 36.7-82.3H104zm11 14.37L152 183h48.3l.7 8.2c2.7 31.9-18.9 68-39.6 101.6-10.4 16.8-20.8 32.7-28.4 46.2-7.7 13.4-12 25-12 29 0 14.6 7 27.5 20.1 38.6 54.2-6.8 82-10.6 106.4-11.4.6-8.5 1.7-17 3.1-25.2-36.6 2.3-70.3-7.5-103.5-19.3 14.9-28.8 42.3-48.9 67-48.8 4.6 0 9.1.6 13.4 2.1 11.2 3.6 21.3 23.7 28 40.6 2.2-10.5 4.3-19.5 5.2-26.1v-.1c.9-6.2-1.6-24-4.8-38.7-2.3-10.6-4.7-19.9-5.9-24.3-6.3 0-11.9-1.2-15.6-5-25.4-26.4-8.9-75.2 12.9-102.4 15.5 25.8 35.7 53.6 56 72.8-4.4 14.8-12.4 26.7-27.9 32-2.1.2-4.7.5-7.3.9 1.4 5.2 3.4 13 5.4 22.1 1.3 5.7 2.5 11.6 3.5 17.5 5.3-4.9 11.4-9.4 16.4-9.6h1.1c28 2.6 59.7 29.6 67.7 69-27.5-12.6-59-5.3-83.9-30.2-2.8 18.6-10.6 46.6-12.7 72.8 24.1.8 51.9 4.6 105.3 11.3 13.1-11.1 20.1-24 20.1-38.6 0-4.2-4.1-15.6-11.4-28.8-7.3-13.3-17.2-29-27.3-45.7C332.2 260.3 311 224.2 311 192v-9h43.9zm.1 320.81c-22.3 0-45.9 3-90.7 8.7C189 432.5 220.8 439 256 439s67-6.5 90.7-17.4c-44.8-5.7-68.4-8.7-90.7-8.7z'
        },
        child: []
      }
    ]
  })(m);
}
const ae = ({ onHandleSave: m, userId: j, sampleType: S }) => {
    const D = L(),
      [n, z] = o.useState(1),
      [q, f] = o.useState([]),
      [b, v] = o.useState([]),
      [F, i] = o.useState({}),
      h = {
        user_id: j,
        company_id: null,
        analysisMethod: 'is_registration_analysis',
        notes: '',
        sample_type_id: S,
        fertilizerRecords: [],
        reportMethod: [],
        email: '',
        sameAddress: !0,
        sr_mail_delivery_location: '',
        phone: '',
        otherRequirements: '',
        files: [],
        sampleDisposal: 'is_lab_dispose_sample',
        is_self_pickup: 0,
        pdf_email: '',
        is_mail_delivery: 0,
        is_lab_dispose_sample: 1,
        is_collect_within_3_months: 0,
        is_return_sample: 0,
        test_all_items: 1,
        submitted_by: '',
        submitted_date: '',
        submitted_phone: ''
      },
      N = [
        g({
          company_id: r().required('กรุณาเลือกบริษัท'),
          analysisMethod: r()
            .required('กรุณาเลือกวัตถุประสงค์การขอใช้บริการ')
            .oneOf(['is_registration_analysis', 'is_quality_check_analysis'], 'กรุณาเลือกวัตถุประสงค์ที่ถูกต้อง'),
          notes: r().max(500, 'ความต้องการอื่นต้องไม่เกิน 500 ตัวอักษร').optional()
        }),
        g({
          fertilizerRecords: M()
            .min(1, 'กรุณาเพิ่มข้อมูลปุ๋ยอย่างน้อยหนึ่งรายการ')
            .of(
              g({
                fertilizerCategory: r()
                  .required('กรุณาเลือกประเภทของปุ๋ย')
                  .oneOf(
                    ['is_single_fertilizer', 'is_compound_fertilizer', 'is_mixed_fertilizer', 'is_secondary_nutrient_fertilizer'],
                    'กรุณาเลือกประเภทปุ๋ยที่ถูกต้อง'
                  ),
                fertilizer_type_id: A().required('กรุณาเลือกประเภทลักษณะปุ๋ย').nullable(),
                packaging_id: A().required('กรุณาเลือกภาชนะบรรจุ').nullable(),
                color: r().required('กรุณากรอกสี'),
                fertilizer_formula: r().required('กรุณากรอกสูตรปุ๋ย'),
                common_name: r().required('กรุณากรอกชื่อสามัญ'),
                trade_name: r().required('กรุณากรอกชื่อการค้า'),
                trademark: r().required('กรุณากรอกเครื่องหมายการค้า'),
                manufacturer: r().required('กรุณากรอกชื่อผู้ผลิต'),
                manufacturer_country: r().required('กรุณากรอกประเทศของผู้ผลิต'),
                supplier: r().required('กรุณากรอกชื่อผู้จัดจำหน่าย'),
                supplier_country: r().required('กรุณากรอกประเทศของผู้จัดจำหน่าย'),
                composition: r().required('กรุณากรอกวัตถุส่วนประกอบของปุ๋ย'),
                sample_weight: A().required('กรุณากรอกปริมาณ').typeError('ปริมาณต้องเป็นตัวเลข'),
                sample_weight_unit: r().required('กรุณากรอกหน่วย'),
                test_items: M()
                  .min(1, 'กรุณาเลือกอย่างน้อยหนึ่งรายการทดสอบ')
                  .of(
                    g({
                      test_item_id: A().required('ต้องระบุรายการทดสอบ'),
                      test_percentage: r().test('requires-percentage', 'กรุณากรอกเปอร์เซ็นต์สำหรับรายการนี้', function (s) {
                        const a = this.parent.test_item_id;
                        return [1, 3, 5, 7, 10, 15].includes(a) ? s != null && s !== '' && /^\d+(\.\d+)?$/.test(s) : !0;
                      })
                    })
                  )
              })
            )
        }),
        g({
          reportMethod: M()
            .min(1, 'กรุณาเลือกวิธีการรับรายงานอย่างน้อยหนึ่งวิธี')
            .of(r().oneOf(['is_self_pickup', 'pdf_email', 'is_mail_delivery'], 'วิธีการรับรายงานไม่ถูกต้อง')),
          email: r().test('email-required', 'กรุณากรอกอีเมลสำหรับรับผลตรวจ', function (s) {
            const a = this.parent.reportMethod;
            return Array.isArray(a) && a.includes('pdf_email') ? r().email('กรุณากรอกอีเมลที่ถูกต้อง').isValidSync(s) : !0;
          }),
          sameAddress: H(),
          sr_mail_delivery_location: r().test('address-required', 'กรุณากรอกที่อยู่จัดส่ง', function (s) {
            const { reportMethod: a, sameAddress: l } = this.parent;
            return Array.isArray(a) && a.includes('is_mail_delivery') && !l ? s != null && s.trim() !== '' : !0;
          }),
          phone: r().test('phone-required', 'กรุณากรอกเบอร์โทรศัพท์ 9-10 หลัก', function (s) {
            const { reportMethod: a, sameAddress: l } = this.parent;
            return Array.isArray(a) && a.includes('is_mail_delivery') && !l ? s != null && s.trim() !== '' && /^\d{9,10}$/.test(s) : !0;
          }),
          sampleDisposal: r()
            .required('กรุณาเลือกวิธีการจำหน่ายตัวอย่าง')
            .oneOf(['is_lab_dispose_sample', 'is_collect_within_3_months', 'is_return_sample'], 'วิธีการจำหน่ายตัวอย่างไม่ถูกต้อง'),
          test_all_items: H().required('กรุณาเลือกขอบเขตการทดสอบ'),
          submitted_by: r().required('กรุณากรอกชื่อผู้ส่งตัวอย่าง'),
          submitted_phone: r()
            .required('กรุณากรอกเบอร์โทรศัพท์ผู้ส่งตัวอย่าง')
            .matches(/^\d{9,10}$/, 'กรุณากรอกเบอร์โทรศัพท์ 9-10 หลัก'),
          submitted_date: r().required('กรุณาเลือกวันที่ส่ง'),
          files: M().min(1, 'กรุณาอัปโหลดเอกสารอย่างน้อยหนึ่งไฟล์').of(Q())
        })
      ][n - 1],
      t = (s, { setErrors: a }) => {
        N.validate(s, { abortEarly: !1 })
          .then(() => {
            z(n + 1);
          })
          .catch((l) => {
            const _ = {};
            l.name === 'ValidationError' && Array.isArray(l.inner)
              ? l.inner.forEach((k) => {
                  _[k.path] = k.message;
                })
              : (_.general = l.message || 'เกิดข้อผิดพลาดในการตรวจสอบข้อมูล'),
              a(_),
              console.log('Validation errors:', _);
          });
      },
      y = () => z(n - 1),
      c = (s, { setSubmitting: a }) => {
        console.log('Form Values from All Steps:', s), m(s), a(!1);
      },
      p = async () => {
        try {
          const s = await Y();
          f(s);
        } catch (s) {
          console.log(s);
        }
      },
      x = async () => {
        try {
          const s = await te();
          console.log('company:', s), v(s);
        } catch (s) {
          console.log(s);
        }
      },
      E = async (s) => {
        try {
          const a = await X(s);
          i(Array.isArray(a) ? a : []);
        } catch (a) {
          console.error(a), i([]);
        }
      };
    return (
      o.useEffect(() => {
        p(), x();
      }, []),
      e.jsx(W, {
        initialValues: h,
        validationSchema: N,
        onSubmit: c,
        children: ({ values: s, errors: a, touched: l, handleChange: _, handleBlur: k, setFieldValue: C, handleSubmit: V }) =>
          e.jsx(T, {
            onSubmit: (w) => {
              w.preventDefault(), n === 3 && V(w);
            },
            children: e.jsxs(u, {
              children: [
                e.jsx(u.Header, {
                  children: e.jsx('h5', {
                    children: S === 1 ? 'ลงทะเบียนใบนำส่งตัวอย่างปุ๋ยอินทรีย์' : 'ลงทะเบียนใบนำส่งตัวอย่างปุ๋ยเคมีเพื่อขึ้นทะเบียนปุ๋ย'
                  })
                }),
                e.jsxs(u.Body, {
                  children: [
                    e.jsxs('ul', {
                      className: 'form-stepper form-stepper-horizontal text-center mx-auto pl-0',
                      children: [
                        e.jsx('li', {
                          className: `form-stepper-list text-center ${n === 1 ? 'form-stepper-active' : n > 1 ? 'form-stepper-completed' : 'form-stepper-unfinished'}`,
                          step: '1',
                          children: e.jsxs('a', {
                            className: 'mx-2',
                            children: [
                              e.jsx('span', {
                                className: 'form-stepper-circle',
                                children: e.jsx('span', {
                                  style: { fontSize: 24 },
                                  children: n > 1 ? e.jsx('i', { className: 'feather icon-check' }) : '1'
                                })
                              }),
                              e.jsx('div', { className: 'label', children: 'ข้อมูลบริษัท' })
                            ]
                          })
                        }),
                        e.jsx('li', {
                          className: `form-stepper-list text-center ${n === 2 ? 'form-stepper-active' : n > 2 ? 'form-stepper-completed' : 'form-stepper-unfinished'}`,
                          step: '2',
                          children: e.jsxs('a', {
                            className: 'mx-2',
                            children: [
                              e.jsx('span', {
                                className: 'form-stepper-circle',
                                children: e.jsx('span', {
                                  style: { fontSize: 24 },
                                  children: n > 2 ? e.jsx('i', { className: 'feather icon-check' }) : '2'
                                })
                              }),
                              e.jsx('div', { className: 'label', children: 'ข้อมูลปุ๋ยเคมี' })
                            ]
                          })
                        }),
                        e.jsx('li', {
                          className: `form-stepper-list text-center ${n === 3 ? 'form-stepper-active' : n > 3 ? 'form-stepper-completed' : 'form-stepper-unfinished'}`,
                          step: '3',
                          children: e.jsxs('a', {
                            className: 'mx-2',
                            children: [
                              e.jsx('span', {
                                className: 'form-stepper-circle',
                                children: e.jsx('span', {
                                  style: { fontSize: 24 },
                                  children: n > 3 ? e.jsx('i', { className: 'feather icon-check' }) : '3'
                                })
                              }),
                              e.jsx('div', { className: 'label', children: 'ที่อยู่การจัดส่ง' })
                            ]
                          })
                        })
                      ]
                    }),
                    n === 1 &&
                      e.jsx(Z, {
                        values: s,
                        errors: a,
                        touched: l,
                        handleChange: _,
                        setFieldValue: C,
                        spacialCon: F,
                        handleGetCusSpacialCon: E
                      }),
                    n === 2 && e.jsx(ee, { values: s, errors: a, touched: l, setFieldValue: C, companyData: b, fertilizerTypes: q }),
                    n === 3 &&
                      e.jsx(se, { values: s, errors: a, touched: l, handleChange: _, handleBlur: k, setFieldValue: C, companyData: b })
                  ]
                }),
                e.jsxs(u.Footer, {
                  className: 'text-start',
                  children: [
                    n > 1 &&
                      e.jsxs(d, {
                        variant: 'secondary',
                        onClick: y,
                        children: [e.jsx('i', { className: 'feather icon-arrow-left' }), ' ย้อนกลับ']
                      }),
                    n < 3
                      ? e.jsxs(d, {
                          variant: 'primary',
                          onClick: (w) => {
                            w.preventDefault(), t(s, { setErrors: C });
                          },
                          children: [
                            'ถัดไป ',
                            e.jsx('i', { className: 'feather icon-arrow-right', style: { marginLeft: 12, marginRight: 0 } })
                          ]
                        })
                      : e.jsxs(d, {
                          variant: 'primary',
                          type: 'submit',
                          children: [e.jsx('i', { className: 'feather icon-save' }), ' บันทึก']
                        }),
                    e.jsxs(d, {
                      variant: 'danger',
                      onClick: () => D('/request'),
                      children: [e.jsx('i', { className: 'feather icon-corner-up-left' }), ' ยกเลิก']
                    })
                  ]
                })
              ]
            })
          })
      })
    );
  },
  Ne = () => {
    const m = L(),
      [j, S] = o.useState(null),
      [D, n] = o.useState(null),
      [z, q] = o.useState(!1),
      [f, b] = o.useState([]);
    o.useEffect(() => {
      const i = localStorage.getItem('authToken');
      i &&
        G(i).then((h) => {
          b(h.user);
        });
    }, []);
    const v = (i) => {
        S(i), i === 'organic' ? n(1) : i === 'chemical' && n(2);
      },
      F = async (i) => {
        const h = {
          user_id: f.user_id,
          customer_id: i.company_id,
          is_registration_analysis: i.analysisMethod === 'is_registration_analysis' ? 1 : 0,
          is_quality_check_analysis: i.analysisMethod === 'is_quality_check_analysis' ? 1 : 0,
          sample_type_id: i.sample_type_id,
          sr_is_self_pickup: i.reportMethod.includes('is_self_pickup') ? 1 : 0,
          sr_pdf_email: i.reportMethod.includes('pdf_email') ? i.email : '',
          sr_is_mail_delivery: i.reportMethod.includes('is_self_pickup') ? 1 : 0,
          sr_mail_delivery_location: i.sr_mail_delivery_location,
          notes: i.notes
        };
        let $ = [];
        i.fertilizerRecords.forEach((t) => {
          const y = {
            request_id: null,
            is_single_fertilizer: t.fertilizerCategory === 'is_single_fertilizer' ? 1 : 0,
            is_compound_fertilizer: t.fertilizerCategory === 'is_compound_fertilizer' ? 1 : 0,
            is_mixed_fertilizer: t.fertilizerCategory === 'is_mixed_fertilizer' ? 1 : 0,
            is_secondary_nutrient_fertilizer: t.fertilizerCategory === 'is_secondary_nutrient_fertilizer' ? 1 : 0,
            fertilizer_type_id: t.fertilizer_type_id,
            color: t.color,
            fertilizer_formula: t.fertilizer_formula,
            packaging_other: t.packaging_other,
            common_name: t.common_name,
            trade_name: t.trade_name,
            trademark: t.trademark,
            manufacturer: t.manufacturer,
            manufacturer_country: t.manufacturer_country,
            supplier: t.supplier,
            supplier_country: t.supplier_country,
            composition: t.composition,
            sample_weight: t.sample_weight,
            sample_weight_unit: t.sample_weight_unit,
            packaging_id: t.packaging_id,
            test_all_items: i.test_all_items,
            is_lab_dispose_sample: i.sampleDisposal === 'is_lab_dispose_sample' ? 1 : 0,
            is_collect_within_3_months: i.sampleDisposal === 'is_collect_within_3_months' ? 1 : 0,
            is_return_sample: i.sampleDisposal === 'is_return_sample' ? 1 : 0,
            submitted_by: i.submitted_by,
            phone: i.submitted_phone,
            test_items: t.test_items
          };
          $.push(y);
        });
        const N = i.files;
        try {
          const t = await O(h);
          if (t.request_id) {
            for (const c of $) {
              c.request_id = t.request_id;
              const p = await U(c);
              if ((console.log('responseSample:', p), p.submission_id)) {
                const x = { submission_id: p.submission_id, test_items: c.test_items },
                  E = await J(x);
                console.log('responseTestItem:', E);
              }
            }
            const y = await K(N, 'service-requests', 'service_');
            for (const c of y) {
              const p = c.fileName.split('/').pop(),
                x = { request_id: t.request_id, uploaded_by: f.user_id, file_name: p, file_path: `/${c.fileName}` };
              await P(x);
            }
            B.success('เพิ่มข้อมูลคำขอรับบริการสำเร็จ!', { autoClose: 3e3 }), q(!0);
          }
        } catch (t) {
          console.log('Error:', t),
            B.error('เพิ่มข้อมูลคำขอรับบริการไม่สำเร็จ!', { autoClose: 3e3 }),
            alert('เกิดข้อผิดพลาดในการบันทึกข้อมูล:', t);
        }
      };
    return e.jsxs(e.Fragment, {
      children: [
        j === null &&
          e.jsxs(u, {
            children: [
              e.jsx(u.Header, { children: e.jsx('h5', { children: 'เลือกการขอรับบริการ' }) }),
              e.jsx(u.Body, {
                children: e.jsxs('div', {
                  className: 'd-flex justify-content-center',
                  children: [
                    e.jsxs(d, {
                      variant: 'info',
                      className: 'w-50 py-4 d-flex align-items-center justify-content-center flex-column',
                      onClick: () => v('organic'),
                      children: [e.jsx(re, { size: 45, className: 'mb-2' }), 'แบบฟอร์มนำส่งตัวอย่างปุ๋ยอินทรีย์']
                    }),
                    e.jsxs(d, {
                      variant: 'success',
                      className: 'w-50  py-4 d-flex align-items-center justify-content-center flex-column',
                      onClick: () => v('chemical'),
                      children: [e.jsx(ie, { size: 45, className: 'mb-2' }), 'แบบฟอร์มนำส่งตัวอย่างปุ๋ยเคมีเพื่อขึ้นทะเบียนปุ๋ย']
                    })
                  ]
                })
              })
            ]
          }),
        j !== null && e.jsx(ae, { userId: f.user_id, onHandleSave: F, sampleType: D }),
        e.jsxs(R, {
          show: z,
          onHide: () => q(!1),
          centered: !0,
          children: [
            e.jsxs(R.Body, {
              className: 'text-center',
              children: [
                e.jsx('i', { className: 'text-success', style: { fontSize: '3rem' }, children: '✔' }),
                e.jsx('h5', { className: 'mt-3', children: 'ลงทะเบียนขอรับบริการสำเร็จ' }),
                e.jsx('p', { children: 'กรุณารอผลการตรวจสอบคำขอใช้บริการ' })
              ]
            }),
            e.jsx(R.Footer, { children: e.jsx(d, { variant: 'success', onClick: () => m('/request/'), children: 'ปิด' }) })
          ]
        })
      ]
    });
  };
export { Ne as default };
