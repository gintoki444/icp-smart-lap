import{r,d as y,x as C,j as t,R,C as N,F as k,B as n,I as b,q as B}from"./index-BnqE3Rwp.js";import{R as D}from"./index-DH1fURYL.js";import{b as z,d as E}from"./serviceRequest-CaLuzo_m.js";import{C as o}from"./Card-BpOPiakr.js";import{S as F,B as T}from"./Stack-BNX9kdqi.js";import{B as I}from"./Badge-BQ9CHBKT.js";import{D as L}from"./DataGrid-C4D0iE54.js";import"./memoTheme-Dygkbaba.js";import"./TextField-B4sAtPJN.js";import"./Transition-C5v-6V12.js";import"./Divider-D2YwwqKL.js";const Q=()=>{const[m,h]=r.useState([]),[f,_]=r.useState([]),[i,d]=r.useState(()=>localStorage.getItem("filterText")||""),[c,x]=r.useState(f),l=y();r.useEffect(()=>{const e=localStorage.getItem("authToken");e&&C(e).then(a=>{h(a.user)}),u()},[]),r.useEffect(()=>{},[c]);const u=()=>{z().then(e=>{if(e){const a=e.map((s,q)=>({id:s.request_id,No:q+1,request_date:new Date(s.request_date).toLocaleString(),request_no:s.request_no||"-",user_id:s.user_id,user_name:s.user_name,customer_id:s.customer_id,customer_name:s.customer_name,sample_type_name:s.sample_type_name,is_registration_analysis:s.is_registration_analysis,is_quality_check_analysis:s.is_quality_check_analysis,sample_type_id:s.sample_type_id,notes:s.notes||"-",created_at:new Date(s.created_at).toLocaleString(),status:s.status,sample_submissions:s.sample_submissions,service_request_documents:s.service_request_documents}));_(a),x(a)}})},g=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"customer_name",headerName:"บริษัท",flex:1},{field:"request_no",headerName:"เลขที่คำขอ",flex:.8},{field:"sample_type_name",headerName:"ประเภทคำขอ",flex:.7},{field:"request_date",headerName:"วันที่สร้าง",flex:1},{field:"notes",headerName:"โน้ต",flex:1.2},{field:"status",headerName:"สถานะ",width:120,headerAlign:"center",align:"center",renderCell:e=>t.jsx(I,{pill:!0,style:{},bg:e.row.status==="pending"?"warning":e.row.status==="rejected"?"danger":"success",children:e.row.status==="pending"?"รออนุมัติ":e.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"actions",headerName:"การจัดการ",width:200,headerAlign:"center",align:"center",renderCell:e=>t.jsxs(T,{children:[t.jsx(n,{variant:"primary",size:"sm",onClick:()=>{l("/user/request/detial",{state:{id:e.row.id}})},children:t.jsx("i",{className:"feather icon-file-text m-0"})}),t.jsx(n,{variant:"info",size:"sm",onClick:()=>w(e.row),children:t.jsx(B,{})}),t.jsx(n,{variant:"outline-danger",size:"sm",onClick:()=>S(e.row.id),children:t.jsx(D,{})})]})}],p=c.filter(e=>Object.values(e).some(a=>a&&a.toString().toLowerCase().includes(i.toLowerCase())));r.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const j=()=>{d(""),localStorage.removeItem("filterText")},w=e=>{l("/user/request/detial",{state:{services:e}})},S=e=>{if(window.confirm(`คุณต้องการลบข้อมูลผู้ใช้หมายเลข ${e} หรือไม่?`))try{E(e).then(()=>{u()})}catch(s){alert("ลบข้อมูลไม่สำเร็จ:",s)}};return t.jsx(t.Fragment,{children:t.jsxs(o,{children:[t.jsx(o.Header,{children:t.jsx(R,{children:t.jsx(N,{children:t.jsx(o.Title,{as:"h5",children:"รายการคำขอรับบริการ"})})})}),t.jsxs(o.Body,{children:[t.jsxs(F,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(k.Control,{type:"text",placeholder:"Search",value:i,onChange:e=>d(e.target.value)}),t.jsx(n,{variant:"primary",size:"sm",color:"secondary",onClick:j,disabled:!i,children:t.jsx(b,{style:{fontSize:20}})}),t.jsxs(n,{variant:"success",size:"sm",onClick:()=>l("/user/request/add",{state:{user:m}}),children:[t.jsx("i",{className:"feather icon-plus-circle"}),"เพิ่ม"]})]}),t.jsx(L,{rows:p,columns:g,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{Q as default};
