import{r as m,h as R,q as P,j as e,R as g,C as r,B as u,F as L,K as U,y as F}from"./index-6YeC_AS5.js";import{c as B,a as x,F as G}from"./formik.esm-C0GtiMNK.js";import{h as q}from"./uploadFileRequest-j7nqPy1R.js";import{I as w,F as $}from"./FirebaseImage-DiJQPKTY.js";import{C as v}from"./Card-BhOVTKNa.js";import{F as a}from"./Form-CGCyrcfL.js";import"./firebaseConfig-pMHECxRz.js";const A=()=>{const[s,y]=m.useState({}),[c,j]=m.useState(!1),[C,p]=m.useState(null),[b,_]=m.useState(null);m.useEffect(()=>{const l=localStorage.getItem("authToken");l&&R(l).then(t=>{P(t.user.user_id).then(n=>{console.log("getUserByID:",n),y(n)})})},[]);const I={id:(s==null?void 0:s.user_id)||"",username:(s==null?void 0:s.username)||"",first_name:(s==null?void 0:s.first_name)||"",last_name:(s==null?void 0:s.last_name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",role_name:(s==null?void 0:s.role_name)||"",profile_picture:(s==null?void 0:s.profile_picture)||"",new_profile_picture:null},k=B({first_name:x().min(3,"ชื่อต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกชื่อ"),last_name:x().min(3,"นามสกุลต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกนามสกุล"),email:x().email("อีเมล์ไม่ถูกต้อง").required("กรุณากรอกอีเมล์"),phone:x().matches(/^[0-9]{10}$/,"กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง (10 หลัก)").required("กรุณากรอกเบอร์โทรศัพท์")}),S=async(l,{setErrors:t,setStatus:n,setSubmitting:d})=>{var o;try{let i={...l};if(console.log("files:",b),b){const h=await q([b],"profile_img","profile_");if(console.log("uploadResult:",h),h&&((o=h[0])!=null&&o.fileName))i.profile_picture=h[0].fileName;else throw new Error("ไม่สามารถอัพโหลดรูปภาพได้")}delete i.username,delete i.email,delete i.new_profile_picture,delete i.role_name,delete i.id,console.log("updatedValues:",i),await U(i,l.id)&&(F.success("แก้ไขข้อมูลโปรไฟล์สำเร็จ!",{autoClose:3e3}),y({...s,...i}),j(!1),p(null),_(null))}catch(i){console.error("Error in handleSubmit:",i),F.error(`แก้ไขข้อมูลไม่สำเร็จ: ${i.message}`,{autoClose:3e3}),n({success:!1}),t({submit:i.message}),d(!1)}},N=()=>{j(!0)},E=()=>{j(!1),p(null),_(null)};return e.jsx("div",{className:"container mt-4",children:e.jsxs(v,{children:[e.jsx(v.Header,{children:e.jsx("h5",{children:"ข้อมูลโปรไฟล์"})}),e.jsx(v.Body,{children:e.jsxs(g,{children:[e.jsx(r,{md:4,children:e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"position-relative d-inline-block",children:c&&C?e.jsx(w,{src:C,alt:"Profile Preview",className:"rounded-circle mb-3",style:{width:"150px",height:"150px",objectFit:"cover"}}):s!=null&&s.profile_picture?e.jsx($,{imagePath:s.profile_picture,alt:"Profile",className:"rounded-circle mb-3",style:{width:"150px",height:"150px",objectFit:"cover"},thumbnail:!0}):e.jsx(w,{src:"https://placehold.co/150",alt:"Profile",className:"rounded-circle mb-3",style:{width:"150px",height:"150px",objectFit:"cover"}})}),c?e.jsx(a.Group,{children:e.jsx(a.Control,{type:"file",accept:"image/*",onChange:l=>{const t=l.target.files[0];t&&(_(t),p(URL.createObjectURL(t)))},className:"mt-2"})}):e.jsx("div",{children:e.jsx(u,{variant:"outline-primary",className:"mt-2",onClick:N,children:"อัปโหลดรูปภาพ"})})]})}),e.jsx(r,{md:8,children:e.jsx(G,{enableReinitialize:!0,initialValues:I,validationSchema:k,onSubmit:S,children:({values:l,errors:t,touched:n,handleChange:d,handleBlur:o,handleSubmit:i,isSubmitting:f})=>e.jsxs(e.Fragment,{children:[e.jsx(a,{onSubmit:i,children:e.jsx(g,{children:e.jsxs(r,{md:12,children:[e.jsxs(g,{children:[e.jsx(r,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"ชื่อ"}),e.jsx(a.Control,{type:"text",name:"first_name",value:l.first_name,onChange:d,onBlur:o,disabled:!c,isInvalid:n.first_name&&!!t.first_name}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.first_name})]})}),e.jsx(r,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"นามสกุล"}),e.jsx(a.Control,{type:"text",name:"last_name",value:l.last_name,onChange:d,onBlur:o,disabled:!c,isInvalid:n.last_name&&!!t.last_name}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.last_name})]})}),e.jsx(r,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"อีเมล์"}),e.jsx(a.Control,{type:"email",name:"email",value:l.email,onChange:d,onBlur:o,disabled:!0,isInvalid:n.email&&!!t.email}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.email})]})}),e.jsx(r,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"บทบาท"}),e.jsx(a.Control,{type:"text",value:l.role_name,disabled:!0})]})}),e.jsx(r,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"เบอร์โทรศัพท์"}),e.jsx(a.Control,{type:"text",name:"phone",value:l.phone,onChange:d,onBlur:o,disabled:!c,isInvalid:n.phone&&!!t.phone}),e.jsx(a.Control.Feedback,{type:"invalid",children:t.phone})]})})]}),c&&e.jsxs("div",{className:"mt-4",children:[e.jsx(u,{variant:"primary",type:"submit",disabled:f,children:f?e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):"บันทึก"}),e.jsx(u,{variant:"danger",className:"ms-2",type:"button",onClick:E,children:"ยกเลิก"})]})]})})}),!c&&e.jsx("div",{className:"mt-4",children:e.jsxs(u,{variant:"primary",type:"button",onClick:N,children:[e.jsx(L,{style:{marginRight:8}}),"แก้ไข"]})})]})})})]})})]})})};export{A as default};
