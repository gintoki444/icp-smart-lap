import{r as h,u as j,j as s,c as N,A as B,a as I,b as F,d as T,C as v,R as $,B as H,s as q,g as D,e as V,l as O,N as f}from"./index-BnqE3Rwp.js";import{F as U,c as J,a as w}from"./formik.esm-CDJOjLuD.js";import{d as M,C as y}from"./Card-BpOPiakr.js";import{F as k,C as P}from"./CloseButton-CTuNyKg7.js";import"./Transition-C5v-6V12.js";const S=M("h4");S.displayName="DivStyledAsH4";const A=h.forwardRef(({className:o,bsPrefix:a,as:l=S,...n},c)=>(a=j(a,"alert-heading"),s.jsx(l,{ref:c,className:N(o,a),...n})));A.displayName="AlertHeading";const C=h.forwardRef(({className:o,bsPrefix:a,as:l=B,...n},c)=>(a=j(a,"alert-link"),s.jsx(l,{ref:c,className:N(o,a),...n})));C.displayName="AlertLink";const R=h.forwardRef((o,a)=>{const{bsPrefix:l,show:n=!0,closeLabel:c="Close alert",closeVariant:p,className:x,children:r,variant:t="primary",onClose:i,dismissible:e,transition:u=k,...d}=I(o,{show:"onClose"}),m=j(l,"alert"),E=F(L=>{i&&i(!1,L)}),g=u===!0?k:u,b=s.jsxs("div",{role:"alert",...g?void 0:d,ref:a,className:N(x,m,t&&`${m}-${t}`,e&&`${m}-dismissible`),children:[e&&s.jsx(P,{onClick:E,"aria-label":c,variant:p}),r]});return g?s.jsx(g,{unmountOnExit:!0,...d,ref:void 0,in:n,children:b}):n?b:null});R.displayName="Alert";const W=Object.assign(R,{Link:C,Heading:A}),z=()=>{const o=T(),a=localStorage.getItem("authToken"),l=localStorage.getItem("userRole");h.useEffect(()=>{a&&l&&(console.log("âœ… Redirecting to dashboard..."),console.log("âœ… authToken",a),console.log("âœ… userRole",l),o(l==="admin"?"/admin/dashboard":"/user/dashboard",{replace:!0}))},[]);const n={email:"",password:"",submit:null},c=()=>J().shape({email:w().email("Must be a valid email").max(255).required("Email is required"),password:w().max(255).required("Password is required")}),p=async(r,{setErrors:t,setSubmitting:i})=>{i(!0);try{const e=await q(r);e&&e.token?(console.log("âœ… Login successful, saving to localStorage..."),localStorage.setItem("authToken",e.token),localStorage.setItem("userRole",e.user.role),await x(e.user.role_id),o(e.user.role==="user"?"/user/dashboard":"/admin/dashboard",{replace:!0})):(console.warn("ðŸ”´ Login failed:",e.message),t({submit:e.message}))}catch(e){console.error("ðŸ”´ Error logging in:",e),t({submit:"An error occurred. Please try again."})}finally{i(!1)}},x=async r=>{try{const t=await D(r);localStorage.setItem("permissions",JSON.stringify(t))}catch(t){console.error("Error fetching permissions:",t)}};return s.jsx(U,{initialValues:n,validationSchema:c,onSubmit:p,children:({errors:r,handleBlur:t,handleChange:i,handleSubmit:e,isSubmitting:u,touched:d,values:m})=>s.jsxs("form",{noValidate:!0,onSubmit:e,children:[s.jsxs("div",{className:"form-group mb-3 text-start",children:[s.jsx("input",{className:"form-control",placeholder:"Email Address / Username",name:"email",onBlur:t,onChange:i,type:"email",value:m.email}),d.email&&r.email&&s.jsx("small",{className:"text-danger form-text",children:r.email})]}),s.jsxs("div",{className:"form-group mb-4 text-start",children:[s.jsx("input",{className:"form-control",placeholder:"Password",name:"password",onBlur:t,onChange:i,type:"password",value:m.password}),d.password&&r.password&&s.jsx("small",{className:"text-danger form-text",children:r.password})]}),r.submit&&s.jsx(v,{sm:12,children:s.jsx(W,{variant:"danger",children:r.submit})}),s.jsx($,{children:s.jsx(v,{mt:2,children:s.jsx(H,{className:"btn-block mb-4",color:"primary",disabled:u,size:"large",type:"submit",variant:"primary",children:"Signin"})})})]})})},Y=()=>s.jsx(V.Fragment,{children:s.jsx("div",{className:"auth-wrapper",children:s.jsxs("div",{className:"auth-content",children:[s.jsxs("div",{className:"auth-bg",children:[s.jsx("span",{className:"r"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r s"}),s.jsx("span",{className:"r"})]}),s.jsx(y,{className:"borderless text-center",children:s.jsxs(y.Body,{children:[s.jsx("div",{className:"mb-0",children:s.jsx("img",{className:"img-fluid",src:O,alt:"logo",width:120})}),s.jsx(z,{}),s.jsxs("p",{className:"mb-1 text-muted",children:["Forgot password?"," ",s.jsx(f,{to:"/auth/reset-password#",className:"f-w-400",children:"Reset"})]}),s.jsxs("p",{className:"mb-1 text-muted",children:["Activate E-mal?"," ",s.jsx(f,{to:"/auth/activate-token",className:"f-w-400",children:"activate"})]}),s.jsxs("p",{className:"mb-1 text-muted",children:["Donâ€™t have an account?"," ",s.jsx(f,{to:"/auth/signup-1",className:"f-w-400",children:"Signup"})]})]})})]})})});export{Y as default};
