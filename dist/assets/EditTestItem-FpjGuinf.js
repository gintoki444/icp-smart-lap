import{u as G,a as q,r as a,j as e,R as L,C as o,B as g,y as S}from"./index-Bq0BSIrC.js";import{a as T,b as w}from"./testItemsRequest-CIY3wZGW.js";import{g as A}from"./testGroupRequest-74lX6Leo.js";import{C as p}from"./Card-C7kDYjR9.js";import{A as B}from"./Alert-C8ltoKJ3.js";import{F as s}from"./Form-C1nYDdO8.js";import"./CloseButton-DJdHSP0V.js";import"./Transition-DABJrq3x.js";import"./setPrototypeOf-DgZC2w_0.js";const U=()=>{var f;const _=G(),c=((f=q().state)==null?void 0:f.id)||null,[n,u]=a.useState({test_name:"",test_name_th:"",name_for_quotation:"",test_code:"",test_description:"",unit_price:"",test_type:0,is_active:1,group_id:""}),[v,b]=a.useState([]),[r,h]=a.useState({}),[x,d]=a.useState(null),[m,j]=a.useState(!1);a.useEffect(()=>{c?(y(),C()):_("/admin/test-items")},[c]);const y=async()=>{try{const t=await T(c);u({test_name:t.test_name||"",test_name_th:t.test_name_th||"",name_for_quotation:t.name_for_quotation||"",test_code:t.test_code||"",test_description:t.test_description||"",unit_price:t.unit_price||"",test_type:t.test_type||0,is_active:t.is_active||1,group_id:t.group_id||""})}catch(t){d("เกิดข้อผิดพลาดในการดึงข้อมูลรายการทดสอบ"),console.error("Error fetching test item:",t)}},C=async()=>{try{const t=await A();b(t)}catch(t){d("เกิดข้อผิดพลาดในการดึงข้อมูลกลุ่มทดสอบ"),console.error("Error fetching test groups:",t)}},I=()=>{const t={};return n.test_name.trim()||(t.test_name="กรุณากรอกชื่อการทดสอบ (ภาษาอังกฤษ)"),n.test_name_th.trim()||(t.test_name_th="กรุณากรอกชื่อการทดสอบ (ภาษาไทย)"),n.name_for_quotation.trim()||(t.name_for_quotation="กรุณากรอกชื่อสำหรับใบเสนอราคา"),n.test_code.trim()||(t.test_code="กรุณากรอกรหัสการทดสอบ"),n.test_description.trim()||(t.test_description="กรุณากรอกคำอธิบายการทดสอบ"),(!n.unit_price||isNaN(n.unit_price)||Number(n.unit_price)<=0)&&(t.unit_price="กรุณากรอกราคาต่อหน่วยที่ถูกต้อง (มากกว่า 0)"),n.group_id||(t.group_id="กรุณาเลือกกลุ่มทดสอบ"),h(t),Object.keys(t).length===0},i=t=>{const{name:l,value:k,type:E,checked:F}=t.target;u({...n,[l]:E==="checkbox"?F?1:0:k}),h({...r,[l]:""})},N=async t=>{if(t.preventDefault(),!!I()){j(!0),d(null);try{await w(c,{...n,unit_price:Number(n.unit_price),test_type:Number(n.test_type),is_active:Number(n.is_active),group_id:Number(n.group_id)}),S.success("แก้ไขรายการทดสอบสำเร็จ!",{autoClose:3e3}),_("/admin/test-items")}catch(l){d("เกิดข้อผิดพลาดในการแก้ไขรายการทดสอบ กรุณาลองใหม่"),console.error("Error updating test item:",l)}finally{j(!1)}}};return e.jsx("div",{children:e.jsxs(p,{children:[e.jsx(p.Header,{children:e.jsx("h5",{children:"แก้ไขรายการทดสอบ"})}),e.jsxs(p.Body,{children:[x&&e.jsx(B,{variant:"danger",children:x}),e.jsxs(s,{onSubmit:N,children:[e.jsxs(L,{children:[e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"test_name",children:[e.jsx(s.Label,{children:"ชื่อการทดสอบ (ภาษาอังกฤษ)"}),e.jsx(s.Control,{type:"text",name:"test_name",value:n.test_name,onChange:i,isInvalid:!!r.test_name}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.test_name})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"test_name_th",children:[e.jsx(s.Label,{children:"ชื่อการทดสอบ (ภาษาไทย)"}),e.jsx(s.Control,{type:"text",name:"test_name_th",value:n.test_name_th,onChange:i,isInvalid:!!r.test_name_th}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.test_name_th})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"name_for_quotation",children:[e.jsx(s.Label,{children:"ชื่อสำหรับใบเสนอราคา"}),e.jsx(s.Control,{type:"text",name:"name_for_quotation",value:n.name_for_quotation,onChange:i,isInvalid:!!r.name_for_quotation}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.name_for_quotation})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"test_code",children:[e.jsx(s.Label,{children:"รหัสการทดสอบ"}),e.jsx(s.Control,{type:"text",name:"test_code",value:n.test_code,onChange:i,isInvalid:!!r.test_code}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.test_code})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"unit_price",children:[e.jsx(s.Label,{children:"ราคาต่อหน่วย (บาท)"}),e.jsx(s.Control,{type:"number",name:"unit_price",value:n.unit_price,onChange:i,isInvalid:!!r.unit_price,step:"0.01"}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.unit_price})]})}),e.jsx(o,{md:6,className:"mb-3",children:e.jsxs(s.Group,{controlId:"group_id",children:[e.jsx(s.Label,{children:"กลุ่มทดสอบ"}),e.jsxs(s.Select,{name:"group_id",style:{padding:"10.5px 22px",fontSize:14},value:n.group_id,onChange:i,isInvalid:!!r.group_id,children:[e.jsx("option",{value:"",children:"เลือกกลุ่มทดสอบ"}),v.map(t=>e.jsxs("option",{value:t.group_id,children:[t.group_name_th," (",t.group_name_en,")"]},t.group_id))]}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.group_id})]})}),e.jsx(o,{md:12,className:"mb-3",children:e.jsxs(s.Group,{controlId:"test_description",children:[e.jsx(s.Label,{children:"คำอธิบายการทดสอบ"}),e.jsx(s.Control,{as:"textarea",rows:3,name:"test_description",value:n.test_description,onChange:i,isInvalid:!!r.test_description}),e.jsx(s.Control.Feedback,{type:"invalid",children:r.test_description})]})})]}),e.jsx(g,{variant:"primary",type:"submit",disabled:m,children:m?"กำลังบันทึก...":"บันทึก"}),e.jsx(g,{variant:"danger",className:"ms-2",onClick:()=>_("/admin/test-items"),disabled:m,children:"กลับ"})]})]})]})})};export{U as default};
