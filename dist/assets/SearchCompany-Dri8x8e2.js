import{r as n,u as v,h as D,at as h,y as c,j as t,B as l,i as L,aB as R}from"./index-CMKGjvil.js";import{g as B}from"./customerRequest-D-QXhSQD.js";import{C as d}from"./Card-ltuRbL1m.js";import{S as E}from"./Stack-_RiFjssk.js";import{F}from"./Form-XAT3KesX.js";import{D as T,B as b}from"./DataGrid-BSrFaLwh.js";import"./DefaultPropsProvider-7CXMMYWk.js";import"./emotion-element-f0de968e.browser.esm-D2ySOhvj.js";import"./TextField-l4tn0KBj.js";import"./toPropertyKey-BZFHAmHd.js";import"./Transition-CvY6YelV.js";import"./setPrototypeOf-DgZC2w_0.js";import"./Divider-Rbts8ePN.js";const W=()=>{const[f,g]=n.useState([]),[z,I]=n.useState(null),[u,x]=n.useState([]),[i,m]=n.useState(()=>localStorage.getItem("filterText")||""),[y,_]=n.useState(u),p=v();n.useEffect(()=>{const e=localStorage.getItem("authToken");e&&D(e).then(o=>{g(o.user)}),C()},[]);const C=async()=>{try{const e=await B();if(e){const o=await h();console.log("checkData:",o);const r=e.filter(a=>{const s=!o.some(N=>N.company_id===a.company_id);return console.log(`company_id: ${a.company_id}, isNotRegistered: ${s}`),s}).map((a,s)=>({id:a.company_id,No:s+1,company_name:a.company_name,company_code:a.company_code,company_address:a.company_address,document_address:a.document_address,tax_id:a.tax_id,email:a.email,phone:a.phone,special_conditions:a.special_conditions,created_at:new Date(a.created_at).toLocaleString()}));console.log("rows:",r),x(r),_(r)}}catch(e){console.error("Error in getCustomers:",e),c.error(`เกิดข้อผิดพลาดในการโหลดข้อมูล: ${e.message}`,{autoClose:3e3})}},S=[{field:"No",headerName:"No.",width:90,headerAlign:"center",align:"center"},{field:"company_name",headerName:"ชื่อบริษัท",flex:1.2},{field:"tax_id",headerName:"เลขที่ผู้เสียภาษี",flex:1},{field:"company_address",headerName:"ที่อยู่บริษัท",flex:3},{field:"actions",headerName:"การจัดการ",flex:1,headerAlign:"center",align:"center",renderCell:e=>t.jsx(b,{children:t.jsx(l,{variant:"info",size:"sm",onClick:()=>k(e.row),children:"เลือก"})})}],w=y.filter(e=>Object.values(e).some(o=>o&&o.toString().toLowerCase().includes(i.toLowerCase())));n.useEffect(()=>{localStorage.setItem("filterText",i)},[i]);const j=()=>{m(""),localStorage.removeItem("filterText")},k=async e=>{if(window.confirm(`คุณต้องการลงทะเบียนข้อมูลลูกค้า/บริษัท "${e.company_name}" หรือไม่?`))try{if((await h()).find(s=>s.company_id===e.id))c.warning("บริษัทนี้ถูกลงทะเบียนแล้ว!",{autoClose:3e3});else{const s={user_id:f.user_id,company_id:e.id,approved_by:null,status:"pending"};await R(s),c.success("ลงทะเบียนข้อมูลลูกค้า/บริษัทสำเร็จ!",{autoClose:3e3}),p("/company")}}catch(r){console.error("Error saving data:",r),c.error(`ลงทะเบียนข้อมูลลูกค้า/บริษัทไม่สำเร็จ: ${r.message}`,{autoClose:3e3})}};return t.jsx(t.Fragment,{children:t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsx("h5",{children:"ค้นหาข้อมูลลูกค้า/บริษัท"})}),t.jsxs(d.Body,{children:[t.jsxs(E,{direction:"row",spacing:1,sx:{mb:2},children:[t.jsx(F.Control,{type:"text",placeholder:"Search",value:i,onChange:e=>m(e.target.value)}),t.jsx(l,{variant:"primary",size:"sm",onClick:j,disabled:!i,children:t.jsx(L,{style:{fontSize:20}})}),t.jsxs(l,{variant:"success",size:"sm",onClick:()=>p("/company/select"),children:[t.jsx("i",{className:"feather icon-plus-circle"})," เพิ่ม"]})]}),t.jsx(T,{rows:w,columns:S,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})]})]})})};export{W as default};
