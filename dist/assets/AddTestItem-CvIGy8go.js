import{u as _e,r as c,j as e,B as q,R as Y,C as b,aB as ve,aC as Te,aD as Ce,w as Fe,y as je,l as ke,a as Ae,h as Re}from"./index-6YeC_AS5.js";import{a as De,b as ze}from"./serviceRequest-CJ15hpJs.js";import{g as qe}from"./packageingTypeRequest-CUTcv2jf.js";import{g as Be}from"./fertilizerTypesRequest-CzftO6V-.js";import{p as Ie,d as Qe,S as He}from"./SampleReceivingModal-B8vlIHN5.js";import{Q as Me}from"./QuotationTypeSelect-D_xhK8U0.js";import{c as Pe}from"./index-DpgziKTs.js";import{g as We,p as Ee,a as Le,d as Oe,b as Ve}from"./quotationRequest-BTgCnPa-.js";import{M as G}from"./Modal-D05P99kH.js";import{T as Se}from"./Table-WM_kTK7U.js";import{F as $}from"./Form-CGCyrcfL.js";import{a as Ge,p as we,D as $e,P as Ye,S as ce,V as h,I as Ue,T as a,F as Xe}from"./react-pdf.browser-C9xYBYWs.js";import{B as se}from"./Badge-C_mrIdUk.js";import{B as Ke,b as te,D as Je}from"./DataGrid-DoczE-38.js";import{A as Ze,a as et,E as tt,b as st}from"./ExpandMore-BGXL0BaM.js";import{C as D}from"./Card-BhOVTKNa.js";import{S as ge,b as fe,c as be,e as ye}from"./trackingRequest-wN0MMLEF.js";import"./formik.esm-C0GtiMNK.js";import"./firebaseConfig-pMHECxRz.js";import"./FirebaseImage-DiJQPKTY.js";import"./sampleSubmissionsRequest-bNYMIj3U.js";import"./CloseButton-BYF_v0Zl.js";import"./Transition-rt6HDaS9.js";import"./setPrototypeOf-DgZC2w_0.js";import"./tslib.es6-RU1n5ZxP.js";import"./TextField-DmQ6Lsg1.js";import"./DefaultPropsProvider-2RhE6zQB.js";import"./emotion-element-f0de968e.browser.esm-C-W82wov.js";import"./toPropertyKey-CTo9CRTC.js";import"./Divider-mvYdwXE_.js";const nt="https://apiav2-jlp2nagalq-as.a.run.app/api",at=async()=>{const s=new Headers;s.append("Content-Type","application/json");const w={method:"GET",headers:s,redirect:"follow"};return await(await fetch(nt+"/sample-receiving",w)).json()},it=({handleBilling:s,testItems:w=[],serviceData:j,createdBy:y,serviceId:N,reloadData:A})=>{_e();const[i,u]=c.useState(!1),[g,R]=c.useState([]),[Q,xe]=c.useState(0),[H,he]=c.useState([]);console.log("testItems:",w);const W=w.map(n=>({id:n.test_item_id,name:n.name_for_quotation,price:parseFloat(n.unit_price),quantity:n.quantity,maxQuantity:n.remain_quantity,summary:parseFloat(n.unit_price)*n.quantity,quotation_type_id:n.quotation_type_id})),[E,B]=c.useState(W),[M,F]=c.useState("");c.useEffect(()=>{P()},[A]);const P=()=>{N&&U(N),B(W),R([]),F("")},U=async n=>{const l=await We(n);console.log("response",l),he(l)},ne=()=>{const n=g.reduce((o,k)=>o+k.price*k.quantity,0),l=n*(Q/100),m=n-l,f=m*.07,v=m+f;return{totalAmount:n,discountAmount:l,netTotal:m,vatAmount:f,grandTotal:v}},{totalAmount:X,discountAmount:S,netTotal:K,vatAmount:I,grandTotal:J}=ne(),L=n=>{console.log("item:",n),console.log("item:",g);const l=g.find(f=>f.id===n.id);let m;l?m=g.filter(f=>f.id!==n.id):m=[...g,{...n}],console.log("updatedItems:",m),R(m)},ae=(n,l)=>{const m=parseInt(l)||0,f=E.map(o=>o.id===n?{...o,quantity:Math.max(1,Math.min(o.maxQuantity,m)),summary:o.price*Math.max(1,Math.min(o.maxQuantity,m))}:o);B(f);const v=g.map(o=>o.id===n?{...o,quantity:Math.max(1,Math.min(o.maxQuantity,m)),summary:o.price*Math.max(1,Math.min(o.maxQuantity,m))}:o);R(v)},ie=(n,l)=>{const m=parseFloat(l)||0,f=E.map(o=>o.id===n?{...o,price:m,summary:m*o.quantity}:o);B(f);const v=g.map(o=>o.id===n?{...o,price:m,summary:m*o.quantity}:o);R(v)},re=n=>{const l=parseFloat(n)||0;xe(Math.max(0,Math.min(100,l)))},le=async()=>{if(g.length===0){alert("กรุณาเลือกอย่างน้อย 1 รายการเพื่อสร้างใบเสนอราคา");return}if(!M){alert("กรุณาเลือกประเภทใบเสนอราคา");return}let n=[];const l=new Date;l.setDate(l.getDate()+30);const m={customer_id:j.customer_id,request_id:j.request_id,valid_until:l.toISOString().split("T")[0],total_amount:parseFloat(X.toFixed(2)),discount_percentage:parseFloat(Q.toFixed(2)),discount_amount:parseFloat(S.toFixed(2)),net_total:parseFloat(K.toFixed(2)),vat_amount:parseFloat(I.toFixed(2)),grand_total:parseFloat(J.toFixed(2)),payment_terms:"30 วัน",status:"pending",created_by:y,quotation_type_id:M,approved_by:null};j.sample_submissions.map(f=>{const v={submission_id:f.submission_id,status:"pending_test",notes:"รอทดสอบบางรายการ"};g.length!==H.length?n.push({...v,id:n.length+1}):(v.status="quotation_issued",v.notes="ออกใบเสนอราคา",n.push({...v,id:n.length+1}))});try{await Ie(n);const f=await Ee(m);if(f&&f.quotation_id){const o={quotation_id:f.quotation_id,test_items_for_quotation:g.map(k=>{const O=k.price*k.quantity,Z=O*(Q/100)/g.length,oe=O-Z;return{test_item_id:k.id,quantity:k.quantity,unit_price:parseFloat(k.price.toFixed(2)),subtotal_price:parseFloat(O.toFixed(2)),discount_amount:parseFloat(Z.toFixed(2)),total_price:parseFloat(oe.toFixed(2))}})};console.log("Quotation Details Data:",o),await Le(o),u(!1),s(!0)}else throw new Error("Failed to get quotation ID")}catch(f){console.error("Error generating quotation:",f),alert("เกิดข้อผิดพลาดในการสร้างใบเสนอราคา กรุณาลองใหม่")}};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{variant:"success",onClick:()=>u(!0),children:[e.jsx(Pe,{className:"me-2",style:{fontSize:16}})," ออกใบเสนอราคา"]}),e.jsxs(G,{show:i,className:"modal-lg",onHide:()=>{u(!1),P()},centered:!0,children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:e.jsx("h5",{children:"สร้างใบเสนอราคา"})})}),e.jsxs(G.Body,{style:{overflowX:"auto"},children:[e.jsx(Y,{children:e.jsx(b,{item:!0,className:"ps-3 pe-3",children:e.jsx(Me,{name:"quotation_type_id",value:M,onSelect:n=>F(n)})})}),e.jsxs(Se,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{width:80,className:"text-center",children:"เลือก"}),e.jsx("th",{children:"ชื่อตัวอย่าง"}),e.jsx("th",{width:100,children:"จำนวน"}),e.jsx("th",{width:120,children:"ราคาต่อหน่วย"}),e.jsx("th",{width:120,className:"text-end",children:"รวม"})]})}),e.jsxs("tbody",{children:[E.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",onChange:()=>L(n),children:e.jsx($.Check,{type:"checkbox",checked:g.some(l=>l.id===n.id),disabled:!H.find(l=>l.test_item_id===n.id)})}),e.jsx("td",{style:{whiteSpace:"normal",wordWrap:"break-word",maxHeight:"100px",overflowY:"auto"},children:n.name}),e.jsx("td",{children:e.jsx($.Control,{type:"number",value:n.quantity,min:1,max:n.maxQuantity,onChange:l=>ae(n.id,l.target.value),disabled:!H.find(l=>l.test_item_id===n.id),style:{width:"80px"}})}),e.jsx("td",{children:e.jsx($.Control,{type:"number",value:n.price,step:"1",onChange:l=>ie(n.id,l.target.value),disabled:!H.find(l=>l.test_item_id===n.id),style:{width:"100px"}})}),e.jsx("td",{className:"text-end",children:n.summary.toFixed(2)})]},n.id)),M==="3"&&e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"ส่วนลด (%)"}),e.jsx("td",{children:e.jsx($.Group,{children:e.jsx($.Control,{type:"number",value:Q,min:0,max:100,step:"0.01",onChange:n=>re(n.target.value),style:{width:"100px"}})})})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:e.jsx("p",{className:"mb-0 text-dark",children:"รวมทั้งหมด:"})}),e.jsx("td",{children:e.jsxs("p",{className:"mb-0 text-dark",children:[X.toFixed(2)," บาท"]})})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:e.jsxs("p",{className:"mb-0 text-dark",children:["ส่วนลด (",Q,"%):"]})}),e.jsx("td",{children:e.jsxs("p",{className:"mb-0 text-dark",children:[S.toFixed(2)," บาท"]})})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:e.jsx("p",{className:"mb-0 text-dark",children:"ราคาสุทธิ :"})}),e.jsx("td",{children:e.jsxs("p",{className:"mb-0 text-dark",children:[K.toFixed(2)," บาท"]})})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:e.jsx("p",{className:"mb-2 text-dark",children:"VAT 7%:"})}),e.jsx("td",{children:e.jsxs("p",{className:"mb-2 text-dark",children:[I.toFixed(2)," บาท"]})})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:e.jsx("h6",{children:"ยอดรวมทั้งสิ้น :"})}),e.jsx("td",{children:e.jsxs("h6",{children:[J.toFixed(2)," บาท"]})})]})]})]})]}),e.jsxs(G.Footer,{children:[e.jsx(q,{variant:"success",onClick:le,disabled:H.length===0,children:"สร้างใบเสนอราคา"}),e.jsx(q,{variant:"danger",onClick:()=>{u(!1),P()},children:"ยกเลิก"})]})]})]})};Xe.register({family:"THSarabunNew",fonts:[{src:"/assets/fonts/THSarabunNew.ttf"},{src:"/assets/fonts/THSarabunNew-Bold.ttf",fontWeight:"bold"}]});const de=({quotation:s})=>e.jsx($e,{children:e.jsxs(Ye,{size:"A4",style:p.page,children:[e.jsx(ct,{quotation:s}),e.jsx(dt,{quotation:s}),e.jsx(xt,{quotation:s})]})}),z=s=>parseFloat(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),rt=async s=>{var A;const w=((A=s.customer_info[0])==null?void 0:A.email)||"ginjung01@gmail.com",j=`ใบเสนอราคา ${s.quotation_no}`,y="นี่คือใบเสนอราคาที่ท่านร้องขอ",N="Chanu";try{const i=await we(e.jsx(de,{quotation:s})).toBlob(),u=new FormData;u.append("toEmail",w),u.append("subject",j),u.append("message",y),u.append("username",N),u.append("file",i,`${s.quotation_no}.pdf`);const R=await(await fetch("https://apiav2-3mp52qu73a-as.a.run.app/api/send-mail-file",{method:"POST",body:u})).json();console.log(R.message)}catch(i){console.error("❌ Failed to send email",i)}},lt=async s=>{const w=await we(e.jsx(de,{quotation:s})).toBlob(),j=URL.createObjectURL(w);window.open(j)},ot=({quotationData:s,onChange:w})=>{const[j,y]=c.useState([]),N=async i=>{try{const u=await Ve(i);return console.log(`getQuotationsByID(${i}):`,u),u}catch(u){return console.error(`Error fetching quotation ${i}:`,u),null}};c.useEffect(()=>{(async()=>{if(s&&s.length>0){const u=await Promise.all(s.map(async g=>{const R=await N(g.quotation_id);return{...g,...R||{}}}));y(u.filter(g=>g!==null))}else y([])})()},[s]);const A=async i=>{if(window.confirm("คุณต้องการลบข้อมูลใบเสนอราคา หรือไม่?"))try{await Qe(),await Oe(i).then(()=>{je.success("ลบข้อมูลใบเสนอราคาสำเร็จ!",{autoClose:3e3}),w(!0)})}catch{je.error("ลบข้อมูลใบเสนอราคาไม่สำเร็จ!",{autoClose:3e3})}};return e.jsx(Y,{className:"mb-2 p-2 pt-0 pb-0",children:e.jsxs(b,{children:[e.jsx("h6",{children:"ข้อมูลใบเสนอราคา"}),e.jsxs(Se,{striped:!0,bordered:!0,hover:!0,className:"mt-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{width:80,children:"#"}),e.jsx("th",{style:{flex:1.3},children:"เลขที่ใบเสนอราคา"}),e.jsx("th",{className:"text-center",style:{flex:1},children:"ประเภท"}),e.jsx("th",{style:{flex:1},children:"วันที่สร้าง"}),e.jsx("th",{style:{flex:1},className:"text-end",children:"จำนวนเงิน"}),e.jsx("th",{className:"text-center",style:{flex:1},children:"สถานะ"}),e.jsx("th",{style:{flex:1},children:"ผู้อนุมัติ"}),e.jsx("th",{className:"text-center",style:{flex:1},children:"Action"})]})}),e.jsx("tbody",{children:j.map((i,u)=>e.jsxs("tr",{children:[e.jsx("td",{children:u+1}),e.jsx("td",{children:i.quotation_no}),e.jsx("td",{className:"text-center",children:i.quotation_type_name||"-"}),e.jsx("td",{children:new Date(i.quotation_date).toLocaleDateString("th-TH")}),e.jsx("td",{className:"text-end",children:z(i.grand_total)}),e.jsx("td",{className:"text-center",children:e.jsx(se,{pill:!0,style:{},bg:i.status==="pending"?"warning":i.status==="rejected"?"danger":"success",children:i.status==="pending"?"รอชำระเงิน":i.status==="rejected"?"ยกเลิก":"ชำระเงินสำเร็จ"})}),e.jsx("td",{children:i.approved_by||"-"}),e.jsx("td",{className:"text-center",style:{flex:1},children:e.jsxs(Ke,{children:[e.jsx(te,{title:"Pre-view",placement:"bottom",arrow:!0,children:e.jsx(q,{variant:"info",size:"sm",onClick:()=>lt(i),children:e.jsx(ve,{style:{fontSize:16}})})}),e.jsx(Ge,{document:e.jsx(de,{quotation:i}),fileName:`${i.quotation_no}.pdf`,children:e.jsx(te,{title:"ดาวน์โหลด PDF",placement:"bottom",arrow:!0,children:e.jsx(q,{variant:"primary",style:{borderRadius:0,padding:"12px",display:"flex",alignItems:"center"},children:e.jsx(Te,{style:{fontSize:16}})})})}),e.jsx(te,{title:"ส่งอีเมล์",placement:"bottom",arrow:!0,children:e.jsx(q,{variant:"info",size:"sm",onClick:()=>rt(i),children:e.jsx(Ce,{style:{fontSize:16}})})}),e.jsx(te,{title:"ลบใบเสนอราคา",placement:"bottom",arrow:!0,children:e.jsx(q,{variant:"danger",size:"sm",onClick:()=>A(i.quotation_id),children:e.jsx(Fe,{style:{fontSize:16}})})})]})})]},i.id))})]})]})})},ct=({quotation:s})=>e.jsxs(h,{children:[e.jsxs(h,{style:p.headerContainer,children:[e.jsx(h,{style:{maxWidth:50},children:e.jsx(Ue,{src:ke,style:p.logo})}),e.jsxs(h,{children:[e.jsx(a,{style:[p.companyInfo,p.boldText,{fontSize:14}],children:"ห้องปฏิบัติการ บริษัท ไอ ซี พี อินเตอร์เนชันแนล จำกัด"}),e.jsx(a,{style:p.companyInfo,children:"307 หมู่ 7 ถ.สุขุมวิท ต.ทุ่งสุขลา อ.ศรีราชา จ.ชลบุรี 20230"}),e.jsx(a,{style:p.companyInfo,children:"โทรศัพท์: 038-352170-3 ต่อ 401, 090-9606091"})]}),e.jsxs(h,{style:p.quotationBox,children:[e.jsx(a,{style:[p.quotationTitle,p.boldText],children:"ใบเสนอราคา /"}),e.jsx(a,{style:[p.quotationTitle,p.boldText],children:"QUOTATION"})]})]}),e.jsx(h,{style:p.sectionDivider}),s.customer_info&&s.customer_info.length>0&&e.jsxs(h,{style:p.infoRow,children:[e.jsxs(h,{children:[e.jsxs(a,{children:[e.jsx(a,{style:p.boldText,children:"เรียน : "}),e.jsx(a,{style:p.normalText,children:s.customer_info[0].company_name})]}),e.jsxs(a,{children:[e.jsx(a,{style:p.boldText,children:"ที่อยู่ : "}),e.jsx(a,{style:p.normalText,children:s.customer_info[0].company_address})]})]}),e.jsxs(h,{children:[e.jsxs(a,{children:[e.jsx(a,{style:p.boldText,children:"วันที่ : "}),new Date(s.quotation_date).toLocaleDateString("th-TH")]}),e.jsxs(a,{children:[e.jsx(a,{style:p.boldText,children:"เลขที่ใบเสนอราคา : "}),s.quotation_no]}),(s==null?void 0:s.quotation_type_id)&&(s==null?void 0:s.quotation_type_id)!==1&&e.jsxs(a,{children:[e.jsx(a,{style:p.boldText,children:"กำหนดวันชำระเงิน : "}),(s==null?void 0:s.quotation_type_id)===2?"7 วันหลังส่งผล":"30 วันหลังส่งผล"]})]})]})]}),dt=({quotation:s})=>{const j=s.quotation_details?[...s.quotation_details.map((y,N)=>[(N+1).toString(),y.name_for_quotation,z(y.unit_price),y.quantity.toString(),z(y.subtotal_price)]),...Array.from({length:15-s.quotation_details.length},()=>["","","","",""])].slice(0,15):Array(15).fill(["","","","",""]);return e.jsxs(h,{children:[e.jsx(a,{style:{fontSize:14,marginTop:0},children:"ห้องปฏิบัติการ บริษัท ไอ ซี พี อินเตอร์เนชั่นแนล จำกัด มีความยินดีในการเสนอราคา เพื่อการพิจารณาของท่าน ดังรายการต่อไปนี้:"}),e.jsxs(h,{style:[x.table,{marginTop:0}],children:[e.jsxs(h,{style:[x.tableRow,x.tableHeader],children:[e.jsx(a,{style:[x.tableCell,{flex:.6,borderRight:2,paddingTop:10}],children:"ลำดับที่"}),e.jsx(a,{style:[x.tableCell,{flex:4,borderRight:2}],children:"รายการทดสอบ"}),e.jsx(a,{style:[x.tableCell,{flex:1,borderRight:2}],children:"ราคาต่ออย่าง (บาท)"}),e.jsx(a,{style:[x.tableCell,{flex:.9,borderRight:2}],children:"จำนวนตัวอย่าง"}),e.jsx(a,{style:[x.tableCell,{flex:1}],children:"ราคารวม (บาท)"})]}),j.map((y,N)=>e.jsx(h,{style:[x.tableRow],children:y.map((A,i)=>{var u;return e.jsx(a,{style:[x.tableCell,{flex:(u=ht[i])==null?void 0:u.width,borderRight:i!==4?2:0,borderBottom:N!==14?1:0},i===1?{textAlign:"left"}:i===2||i===4?x.textRight:{}],children:A},i)})},N)),e.jsxs(h,{style:[x.tableRow,{borderTop:2}],children:[e.jsx(a,{style:[x.tableCell,{flex:7,textAlign:"left"}],children:"ค่าบริการวิเคราะห์ทดสอบ"}),e.jsxs(a,{style:[x.tableCell,{flex:1,textAlign:"right",borderLeft:2}],children:[z(s.total_amount)," บาท"]})]}),s.discount_percentage!=="0.00"&&e.jsxs(h,{style:[x.tableRow,{borderTop:1}],children:[e.jsxs(a,{style:[x.tableCell,{flex:7,textAlign:"left"}],children:["ส่วนลด",e.jsxs(a,{style:{padding:20,borderBottom:2,fontSize:14,fontWeight:"bold"},children:[" ",s.discount_percentage," "]}),"%"]}),e.jsxs(a,{style:[x.tableCell,{flex:1,textAlign:"right",borderLeft:2}],children:[z(s.discount_amount)," บาท"]})]}),e.jsxs(h,{style:[x.tableRow,{borderTop:1}],children:[e.jsx(a,{style:[x.tableCell,{flex:7,textAlign:"left"}],children:"ภาษีมูลค่าเพิ่ม (Vat) 7%"}),e.jsxs(a,{style:[x.tableCell,{flex:1,textAlign:"right",borderLeft:2}],children:[z(s.vat_amount)," บาท"]})]}),e.jsxs(h,{style:[x.tableRow,{borderTop:1}],children:[e.jsx(a,{style:[x.tableCell,{flex:7,textAlign:"left"}],children:"จำนวนเงินรวมทั้งสิ้น"}),e.jsxs(a,{style:[x.tableCell,{flex:1,textAlign:"right",borderLeft:2}],children:[z(s.net_total),"บาท"]})]}),e.jsxs(h,{style:[x.tableRow,{borderTop:1,backgroundColor:"#ababab"}],children:[e.jsx(a,{style:[x.tableCell,{flex:7,textAlign:"left"}],children:"จำนวนเงินรวมทั้งสิ้น"}),e.jsxs(a,{style:[x.tableCell,{flex:1,textAlign:"right",borderLeft:2}],children:[z(s.grand_total)," บาท"]})]})]})]})},xt=({quotation:s})=>e.jsxs(h,{style:_.footerContainer,children:[e.jsx(a,{style:[_.paymentTitle,p.boldText],children:"เงื่อนไขการชำระเงิน :"}),e.jsxs(h,{style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx(a,{style:_.paymentText,children:"1. โอนเงินผ่านบัญชีธนาคาร บริษัท ไอ ซี พี อินเตอร์เนชันแนล จำกัด"}),e.jsx(a,{style:_.taxNumber,children:"(เลขประจำตัวผู้เสียภาษี: 0205547009421)"})]}),e.jsx(a,{style:_.paymentText,children:"2. จัดส่งหลักฐานการโอนเงิน และหนังสือรับรองหักภาษี ณ ที่จ่ายมายัง somluk.meesakun@icpinter.com"}),e.jsx(h,{style:{marginTop:10},children:e.jsxs(h,{style:[_.table,{margin:"auto"}],children:[e.jsxs(h,{style:_.tableRow,children:[e.jsx(a,{style:_.tableHeader,children:"ธนาคาร"}),e.jsx(a,{style:_.tableHeader,children:"สาขา"}),e.jsx(a,{style:_.tableHeader,children:"ประเภทบัญชี"}),e.jsx(a,{style:_.tableHeader,children:"เลขที่บัญชี"})]}),[["ไทยพาณิชย์","ชลบุรี","กระแสรายวัน","001-3-50193-0"],["กสิกรไทย","พัฒนาพงษ์","กระแสรายวัน","018-1-14367-3"],["ทหารไทย","สุรวงศ์","กระแสรายวัน","078-1-18116-9"]].map((w,j)=>e.jsx(h,{style:_.tableRow,children:w.map((y,N)=>e.jsx(a,{style:_.tableCell,children:y},N))},j))]})}),e.jsxs(h,{style:[_.signatureContainer,{marginTop:5}],children:[e.jsx(a,{style:{fontSize:14},children:"ขอแสดงความนับถือ"}),e.jsx(h,{style:_.signatureLine}),e.jsx(a,{style:_.signatureText,children:"( ผู้จัดการห้องปฏิบัติการ )"}),e.jsx(a,{style:_.signatureText,children:"ผู้เสนอราคา"})]})]}),p=ce.create({page:{padding:10,paddingHorizontal:40,fontFamily:"THSarabunNew"},boldText:{fontFamily:"THSarabunNew",fontWeight:"bold"},normalText:{fontFamily:"THSarabunNew"},headerContainer:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},logo:{width:80,height:80},companyInfo:{fontSize:12},quotationBox:{borderWidth:2,borderColor:"#000",borderRadius:10,padding:8,textAlign:"center",width:160,fontSize:14},quotationTitle:{fontSize:18},sectionDivider:{borderBottomWidth:2,borderBottomColor:"#000",marginVertical:2},infoRow:{flexDirection:"row",justifyContent:"space-between",fontSize:14,marginTop:5}}),x=ce.create({table:{display:"table",width:"100%",borderCollapse:"collapse",borderWidth:2,marginVertical:10},tableRow:{flexDirection:"row"},tableCell:{flex:1,fontSize:12,paddingTop:2,paddingHorizontal:4,textAlign:"center",borderColor:"#000",minHeight:18},tableHeader:{backgroundColor:"#f3f3f3",fontWeight:"bold",borderBottomWidth:2,textAlign:"center"},textRight:{textAlign:"right"},summaryRow:{flexDirection:"row",marginTop:5},summaryLabel:{flex:3,fontSize:14,padding:5},summaryValue:{flex:1,textAlign:"right",fontSize:14,padding:5}}),_=ce.create({footerContainer:{position:"absolute",bottom:15,left:40,right:40},paymentTitle:{fontSize:14},paymentText:{fontSize:14,marginBottom:2},taxNumber:{fontSize:14,textAlign:"right"},table:{display:"table",width:"80%",borderWidth:2,marginVertical:10},tableRow:{flexDirection:"row"},tableHeader:{fontSize:14,fontWeight:"bold",borderColor:"#000",paddingTop:2,paddingHorizontal:4,textAlign:"center",flex:1,minHeight:18},tableCell:{fontSize:12,borderTopWidth:1,borderColor:"#000",paddingHorizontal:4,textAlign:"center",flex:1,minHeight:18},signatureContainer:{marginTop:5,marginLeft:"auto",marginRight:"10%",textAlign:"center",width:"30%"},signatureLine:{borderBottomWidth:2,width:"100%",alignSelf:"center",marginBottom:5,marginTop:20},signatureText:{fontSize:12,textAlign:"center"}}),ht=[{width:.6},{width:4},{width:1},{width:.9},{width:1}],ut=({title:s})=>{var me;const j=((me=Ae().state)==null?void 0:me.id)||null,y=_e(),[N,A]=c.useState(2),[i,u]=c.useState(!1),[g,R]=c.useState(!1),[Q,xe]=c.useState(!1),[H,he]=c.useState(!1),[W,E]=c.useState([]),[B,M]=c.useState(!1),[F,P]=c.useState("horizontal"),[U,ne]=c.useState(0);c.useEffect(()=>{const t=localStorage.getItem("authToken");t&&Re(t).then(r=>{E(r.user)})},[]);const X=[{value:"is_single_fertilizer",label:"เชิงเดี่ยว"},{value:"is_compound_fertilizer",label:"เชิงประกอบ"},{value:"is_mixed_fertilizer",label:"เชิงผสม"},{value:"is_secondary_nutrient_fertilizer",label:"ธาตุอาหารรอง-อาหารเสริม"}];c.useEffect(()=>{j?ie(j):y("/admin/sample-receiving/")},[j,B]);const[S,K]=c.useState({}),[I,J]=c.useState([]),[L,ae]=c.useState([]),ie=async t=>{const r=await De(t),d=await ze(t);if(J(r.sample_submissions),K(r),d&&d.request_status_tracking.length>0){const C=d.request_status_tracking[0],pe=ee.map(Ne=>C[Ne.status]==="yes").lastIndexOf(!0);ne(pe>=0?pe+1:0),ae(d)}},[re,le]=c.useState([]),[n,l]=c.useState([]);c.useEffect(()=>{m(),f(),k()},[]);const m=async()=>{const t=await qe();le(t)},f=async()=>{try{const t=await at();l(t)}catch(t){console.error("Error fetching test items:",t),l([])}},[v,o]=c.useState([]),k=async()=>{try{const t=await Be();o(t)}catch(t){console.log(t)}},O=(t,r)=>{const d=Object.keys(t).find(T=>t[T]===1),C=r.find(T=>T.value===d);return C?C.label:null},Z=[{field:"no",headerName:"#",width:90,headerAlign:"center",align:"center"},{field:"test_code",headerName:"ทดสอบ",flex:1,renderCell:t=>{if(!t||!t.row)return"-";const{test_code:r,test_percentage:d}=t.row;return`${r||""}${d?` (${d})`:""}`.trim()}},{field:"status",headerName:"สถานะ",headerAlign:"center",align:"center",flex:1,renderCell:t=>e.jsx(se,{pill:!0,style:{},bg:t.row.status==="pending"?"warning":t.row.status==="rejected"?"danger":"success",children:t.row.status==="pending"?"รออนุมัติ":t.row.status==="rejected"?"ไม่อนุมัติ":"อนุมัติ"})},{field:"test_value",headerName:"ผลที่ได้",flex:1,renderCell:t=>{var r;return((r=t==null?void 0:t.row)==null?void 0:r.test_value)||"-"}},{field:"test_date",headerName:"วันที่ทดสอบ",flex:1,valueGetter:t=>{var r;return((r=t==null?void 0:t.row)==null?void 0:r.created_at)||"-"}}],oe=t=>{const r=t.map((d,C)=>({id:d.detail_id,no:C+1,...d}));return console.log("setData",r),r};c.useEffect(()=>{const t=()=>{window.innerWidth<=768?P("vertical"):P("horizontal")};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const V=t=>{t&&(console.log("handleReload :",t),M(r=>!r))},ee=[{label:"คำขอรับบริการ",status:"requested"},{label:"ลูกค้าส่งตัวอย่าง",status:"sample_sent"},{label:"ทบทวนคำขอ",status:"request_reviewed"},{label:"ตัวอย่างจัดส่งถึงแล็บ",status:"sample_arrived_lab"},{label:"รับตัวอย่างเข้าระบบ",status:"sample_received"},{label:"รอทดสอบบางรายการ",status:"partial_testing"},{label:"ออกใบเสนอราคา",status:"quotation_issued"},{label:"ขอใบแจ้งหนี้",status:"invoice_requested"},{label:"รับชำระเงิน",status:"payment_received"},{label:"หัก ณ ที่จ่าย",status:"tax_withheld"},{label:"ออกใบเสร็จรับเงิน/ใบกำกับภาษี",status:"receipt_issued"}],ue=(t,r,d)=>{const C=r.length;switch(ee[t].status,t){case 0:return d.requested!==null;case 1:return C===0?!1:d.sample_sent!==null;case 2:return d.request_reviewed!==null;case 3:return d.sample_arrived_lab!==null;case 4:return d.sample_received!==null;case 5:return d.partial_testing!==null;case 6:return d.quotation_issued!==null;case 7:return d.invoice_requested!==null;case 8:return d.payment_received!==null;case 9:return d.tax_withheld!==null;case 10:return d.receipt_issued!==null;default:return!1}};return e.jsx("div",{children:e.jsxs(D,{children:[e.jsx(D.Header,{children:e.jsx("h5",{children:s})}),e.jsxs(D.Body,{children:[F==="vertical"?e.jsx(ge,{activeStep:U,orientation:F,alternativeLabel:F==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:ee.map((t,r)=>e.jsxs(fe,{completed:ue(r,I,S.service_status_logs||{}),children:[e.jsx(be,{children:t.label}),F==="vertical"&&e.jsx(ye,{children:e.jsx(ServiceStepContent,{serviceId:j,handleReload:V})})]},r))}):e.jsx(e.Fragment,{children:e.jsx(D,{style:{borderRadius:10,marginBottom:10},children:e.jsx(D.Body,{style:{padding:"8px 20px 3px"},children:e.jsx(ge,{activeStep:U,orientation:F,alternativeLabel:F==="horizontal",sx:{width:"100%",margin:"0 auto",padding:"20px 0"},children:ee.map((t,r)=>e.jsxs(fe,{completed:ue(r,I,S.service_status_logs||{}),children:[e.jsx(be,{children:t.label}),F==="vertical"&&e.jsx(ye,{children:e.jsx(ServiceStepContent,{serviceId:j,handleReload:V})})]},r))})})})}),e.jsx(D,{style:{borderRadius:10,marginBottom:0},children:e.jsx(D.Body,{style:{paddingBottom:20,paddingTop:20},children:e.jsxs(Y,{children:[S.request_no&&e.jsx(b,{md:12,children:e.jsxs("h5",{className:"mb-4",children:["เลขที่คำขอรับบริการ : ",e.jsx("span",{style:{fontSize:18},children:S.request_no||""})]})}),e.jsx(b,{md:12,children:e.jsx("h6",{className:"mb-3",children:"ข้อมูลผู้ขอขึ้นทะเบียน"})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["บริษัท : ",e.jsx("strong",{className:"text-dark",children:S.customer_name})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทคำขอ :",e.jsx("strong",{className:"text-dark",children:S.is_quality_check_analysis===1?"วิเคราะห์เพื่อตรวจสอบคุณภาพ":"วิเคราะห์ขึ้นทะเบียน"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["คำขอเพิ่มเติม : ",e.jsx("strong",{className:"text-dark",children:S.notes})]})}),e.jsx("h6",{className:"mt-3 mb-2",children:"ข้อมูลตัวอย่างปุ๋ย"}),I.map((t,r)=>{var d,C;return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs(b,{md:12,className:"ms-2 ps-0 pe-0",style:{border:"1px solid #f8f9fa"},children:[e.jsxs(Ze,{sx:{boxShadow:"none"},children:[e.jsx(et,{expandIcon:e.jsx(tt,{}),"aria-controls":`panel${r}-content`,id:`panel${r}-header`,sx:{backgroundColor:"#f8f9fa",borderRadius:0},children:e.jsxs("p",{className:"mb-0",children:["ตัวอย่างที่ ",r+1," ",t.submission_no&&e.jsxs(e.Fragment,{children:["เลขที่ :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:t.submission_no||"-"})," "]}),"สูตรปุ๋ย : ",e.jsx("strong",{className:"text-dark",children:t.fertilizer_formula||"-"})," ( ชื่อสามัญ :"," ",e.jsx("strong",{className:"text-dark",style:{fontWeight:"bold"},children:t.common_name||"-"}),") สถานะ :",e.jsx(se,{pill:!0,bg:t.verification_status==="No"&&t.is_job_accepted||t.verification_status==="No"&&!t.is_job_accepted||t.verification_status==="Yes"&&!t.is_job_accepted?"warning":t.verification_status==="Yes"&&t.is_job_accepted?"success":"danger",style:{marginLeft:12},children:t.verification_status==="No"&&t.is_job_accepted||t.verification_status==="No"&&!t.is_job_accepted||t.verification_status==="Yes"&&!t.is_job_accepted?"รอการตรวจสอบ":t.verification_status==="Yes"&&t.is_job_accepted?"รับงาน":" ไม่อนุมัติ"})]})}),e.jsx(st,{children:e.jsxs(Y,{children:[e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ประเภทของปุ๋ย :"," ",e.jsx("strong",{className:"text-dark",children:O(t,X)})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ลักษณะปุ๋ย :"," ",e.jsx("strong",{className:"text-dark",children:((d=v.find(T=>T.fertilizer_type_id===t.fertilizer_type_id))==null?void 0:d.fertilizer_type_name)||"-"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สี : ",e.jsx("strong",{className:"text-dark",children:t.color||"-"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ภาชนะบรรจุ :"," ",e.jsx("strong",{className:"text-dark",children:((C=re.find(T=>T.packaging_type_id===t.packaging_id))==null?void 0:C.packaging_type_name)||"-"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ชื่อการค้า : ",e.jsx("strong",{className:"text-dark",children:t.trade_name||"-"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["ผู้ผลิต (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:t.manufacturer||"-"})," ประเทศ :"," ",e.jsx("strong",{className:"text-dark",children:t.manufacturer_country||"-"})]})}),e.jsx(b,{md:6,className:"mb-2",children:e.jsxs("p",{className:"mb-0",children:["สั่งจาก (บริษัท/ห้าง/ร้าน) : ",e.jsx("strong",{className:"text-dark",children:t.supplier||"-"})," ประเทศ :"," ",e.jsx("strong",{className:"text-dark",children:t.supplier_country||"-"})]})}),e.jsx(b,{md:6,className:"mb-0",children:e.jsxs("p",{className:"mb-0",children:["สถานะ :",e.jsx(se,{pill:!0,bg:t.verification_status==="No"&&t.is_job_accepted||t.verification_status==="No"&&!t.is_job_accepted||t.verification_status==="Yes"&&!t.is_job_accepted?"warning":t.verification_status==="Yes"&&t.is_job_accepted?"success":"danger",style:{marginLeft:12},children:t.verification_status==="No"&&t.is_job_accepted||t.verification_status==="No"&&!t.is_job_accepted||t.verification_status==="Yes"&&!t.is_job_accepted?"รอการตรวจสอบ":t.verification_status==="Yes"&&t.is_job_accepted?"รับงาน":" ไม่อนุมัติ"})]})}),e.jsxs(b,{md:12,className:"mb-2",children:[e.jsx("h6",{className:"mb-3",children:"รายการทดสอบ"}),e.jsx("div",{style:{width:"100%"},children:e.jsx(Je,{rows:oe(t.sample_submission_details),columns:Z,pageSize:5,rowsPerPageOptions:[5,10,20],pagination:!0,disableSelectionOnClick:!0,hideFooterSelectedRowCount:!0})})]})]})})]}),e.jsx(b,{style:{padding:"0 16px 8px"},children:e.jsx(He,{submissionId:t.submission_id,handleTracking:V,trackingData:t.sample_tracking,reviewBy:W.user_id,sampleNo:t.submission_no,reloadData:B,sampleStatus:L.sample_submissions.find(T=>T.submission_id===t.submission_id)})}),S.quotation_data&&S.quotation_data.length>0&&e.jsx(b,{style:{padding:"8px 8px 8px"},children:e.jsx(ot,{quotationData:S.quotation_data,onChange:V,sampleStatus:L.sample_submissions.find(T=>T.submission_id===t.submission_id)})})]})},`Accordion-${r}`),r<I.length-1&&e.jsx("hr",{className:"mt-4 mb-2"})]})})]})})})]}),e.jsxs(D.Footer,{className:"text-start",children:[S.request_no&&e.jsx(it,{serviceId:j,handleBilling:V,testItems:S.test_items_for_quotation,serviceData:S,serviceStatus:L,createdBy:W.user_id,reloadData:B}),e.jsxs(q,{variant:"danger",onClick:()=>y("/admin/request/"),children:[e.jsx("i",{className:"feather icon-corner-up-left"}),"กลับหน้าหลัก"]})]})]})})},Ot=()=>e.jsx(ut,{title:"ข้อมูลการรับตัวอย่างปุ๋ย"});export{Ot as default};
