import{d as L,r as j,t as q,j as n,R as r,C as l,F as i,B as C,y as u}from"./index-Dtqx7INH.js";import{F as G,c as $,a as m}from"./formik.esm-B_wI4ktB.js";import{a as B}from"./customerRequest-BSWKX1-j.js";import{a as E}from"./specialConditionsRequest-DVpIoZFL.js";import{C as x}from"./Card-Bkd81iOt.js";function T(){var b;const y=L(),[f,N]=j.useState({}),[h,v]=j.useState([]),a=((b=q().state)==null?void 0:b.customers)||null;j.useEffect(()=>{g()},[]);const g=()=>{E().then(d=>{var e;d&&(v(d),N({id:a==null?void 0:a.id,company_code:a==null?void 0:a.company_code,company_name:a==null?void 0:a.company_name,company_address:a==null?void 0:a.company_address,document_address:a==null?void 0:a.document_address,tax_id:a==null?void 0:a.tax_id,email:a==null?void 0:a.email,phone:a==null?void 0:a.phone,condition_id:(e=d.find(s=>s.description===a.special_conditions))==null?void 0:e.condition_id,special_conditions:a==null?void 0:a.special_conditions}))})},k=()=>$({company_code:m().min(3,"รหัสบริษัทต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกรหัสบริษัท"),company_name:m().required("กรุณากรอกชื่อบริษัท"),tax_id:m().matches(/^[0-9]{10,13}$/,"เลขที่ผู้เสียภาษีต้องมี 10 ถึง 13 หลัก").required("กรุณากรอกเลขที่ผู้เสียภาษี"),company_address:m().required("กรุณากรอกที่อยู่บริษัท"),document_address:m().min(3,"ที่อยู่จัดส่งเอกสารต้องมีอย่างน้อย 3 ตัวอักษร").required("กรุณากรอกที่อยู่จัดส่งเอกสาร"),email:m().email("รูปแบบอีเมล์ไม่ถูกต้อง").required("กรุณากรอกอีเมล์"),phone:m().matches(/^[0-9]{10}$/,"กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง (10 หลัก)").required("กรุณากรอกเบอร์โทรศัพท์"),condition_id:m().required("กรุณาเลือกเงื่อนไขพิเศษ")}),I=async(d,{setErrors:e,setStatus:s,setSubmitting:c})=>{var o;try{d.special_conditions=(o=h.find(p=>p.condition_id===Number(d.condition_id)))==null?void 0:o.description;const t={company_code:d.company_code,company_name:d.company_name,company_address:d.company_address,document_address:d.document_address,phone:d.phone,special_conditions:d.special_conditions};(await B(t,d.id)).message&&(u.success("แก้ไขข้อมูลบริษัทสำเร็จ!",{autoClose:3e3}),y("/admin/customer/"))}catch(t){u.error(`แก้ไขข้อมูลไม่สำเร็จ: ${t.message}`,{autoClose:3e3}),s({success:!1}),e({submit:t.message}),c(!1)}};return n.jsx(r,{children:n.jsxs(x,{children:[n.jsx(x.Header,{children:n.jsx(r,{children:n.jsx(l,{children:n.jsx(x.Title,{as:"h5",children:"แก้ไขข้อมูลบริษัท"})})})}),n.jsx(x.Body,{children:n.jsx(G,{initialValues:f,validationSchema:k,onSubmit:I,enableReinitialize:!0,children:({values:d,errors:e,touched:s,handleChange:c,handleBlur:o,handleSubmit:t,isSubmitting:_})=>n.jsxs(i,{onSubmit:t,children:[n.jsxs(r,{children:[n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"รหัสบริษัท:"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"รหัสบริษัท",name:"company_code",value:d.company_code,onChange:c,onBlur:o,isInvalid:s.company_code&&!!e.company_code}),s.company_code&&e.company_code&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.company_code})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"ชื่อบริษัท :"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"ชื่อบริษัท",name:"company_name",value:d.company_name,onChange:c,onBlur:o,isInvalid:s.company_name&&!!e.company_name}),s.company_name&&e.company_name&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.company_name})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"เลขที่ผู้เสียภาษี :"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"เลขที่ผู้เสียภาษี",name:"tax_id",disabled:!0,value:d.tax_id,onChange:c,onBlur:o,isInvalid:s.tax_id&&!!e.tax_id}),s.tax_id&&e.tax_id&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.tax_id})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"ที่อยู่บริษัท :"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"ที่อยู่บริษัท",name:"company_address",value:d.company_address,onChange:c,onBlur:o,isInvalid:s.company_address&&!!e.company_address}),s.company_address&&e.company_address&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.company_address})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"ที่อยู่จัดส่งเอกสาร :"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"ที่อยู่จัดส่งเอกสาร",name:"document_address",value:d.document_address,onChange:c,onBlur:o,isInvalid:s.document_address&&!!e.document_address}),s.document_address&&e.document_address&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.document_address})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"อีเมล์ :"}),n.jsx(i.Control,{type:"email",className:"form-control",placeholder:"อีเมล์",disabled:!0,name:"email",value:d.email,onChange:c,onBlur:o,isInvalid:s.email&&!!e.email}),s.email&&e.email&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.email})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"เบอร์โทรศัพท์ :"}),n.jsx(i.Control,{type:"text",className:"form-control",placeholder:"เบอร์โทรศัพท์",name:"phone",value:d.phone,onChange:c,onBlur:o,isInvalid:s.phone&&!!e.phone}),s.phone&&e.phone&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.phone})]})}),n.jsx(l,{md:6,children:n.jsxs(i.Group,{className:"mb-2",children:[n.jsx(i.Label,{children:"เงื่อนไขพิเศษ :"}),n.jsxs(i.Select,{name:"condition_id",style:{padding:"10px 20px"},value:d.condition_id,onChange:c,onBlur:o,isInvalid:s.condition_id&&!!e.condition_id,children:[n.jsx("option",{value:"",children:"เลือกเงื่อนไขพิเศษ"}),h.map(p=>n.jsx("option",{value:p.condition_id,children:p.description},p.condition_id))]}),s.condition_id&&e.condition_id&&n.jsx(i.Control.Feedback,{type:"invalid",children:e.condition_id})]})})]}),n.jsx(r,{className:"mt-3",children:n.jsxs(l,{children:[n.jsx(C,{variant:"primary",type:"submit",disabled:_,children:_?n.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"feather icon-save"})," บันทึก"]})}),n.jsxs(C,{variant:"danger",onClick:()=>y("/admin/customer"),className:"ms-2",children:[n.jsx("i",{className:"feather icon-corner-up-left"})," ย้อนกลับ"]})]})})]})})})]})})}export{T as default};
